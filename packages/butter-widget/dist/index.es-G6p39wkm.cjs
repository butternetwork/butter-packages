"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const q=require("./index-Ds0dnP-7.cjs"),ee=require("./index.es-Wu1MXCbT.cjs"),bo={...q.identityBase,...q.base2,...q.base8,...q.base10,...q.base16,...q.base32,...q.base36,...q.base58,...q.base64,...q.base256emoji},Dw={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};function qw(n,t=[]){const r=[];return Object.keys(n).forEach(s=>{if(t.length&&!t.includes(s))return;const a=n[s];r.push(...a.accounts)}),r}const Uw={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function Mw(n,t){const{message:r,code:s}=Uw[n];return{message:r,code:s}}function Sc(n,t){return!!Array.isArray(n)}const Lw=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,zw=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,kw=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Hw(n,t){if(n==="__proto__"||n==="constructor"&&t&&typeof t=="object"&&"prototype"in t){Kw(n);return}return t}function Kw(n){console.warn(`[destr] Dropping "${n}" key to prevent prototype pollution.`)}function uo(n,t={}){if(typeof n!="string")return n;const r=n.trim();if(n[0]==='"'&&n.endsWith('"')&&!n.includes("\\"))return r.slice(1,-1);if(r.length<=9){const s=r.toLowerCase();if(s==="true")return!0;if(s==="false")return!1;if(s==="undefined")return;if(s==="null")return null;if(s==="nan")return Number.NaN;if(s==="infinity")return Number.POSITIVE_INFINITY;if(s==="-infinity")return Number.NEGATIVE_INFINITY}if(!kw.test(n)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return n}try{if(Lw.test(n)||zw.test(n)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(n,Hw)}return JSON.parse(n)}catch(s){if(t.strict)throw s;return n}}function Vw(n){return!n||typeof n.then!="function"?Promise.resolve(n):n}function kt(n,...t){try{return Vw(n(...t))}catch(r){return Promise.reject(r)}}function Bw(n){const t=typeof n;return n===null||t!=="object"&&t!=="function"}function Fw(n){const t=Object.getPrototypeOf(n);return!t||t.isPrototypeOf(Object)}function yo(n){if(Bw(n))return String(n);if(Fw(n)||Array.isArray(n))return JSON.stringify(n);if(typeof n.toJSON=="function")return yo(n.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Pc="base64:";function Gw(n){return typeof n=="string"?n:Pc+Qw(n)}function Ww(n){return typeof n!="string"||!n.startsWith(Pc)?n:Jw(n.slice(Pc.length))}function Jw(n){return globalThis.Buffer?q.Buffer.from(n,"base64"):Uint8Array.from(globalThis.atob(n),t=>t.codePointAt(0))}function Qw(n){return globalThis.Buffer?q.Buffer.from(n).toString("base64"):globalThis.btoa(String.fromCodePoint(...n))}function lr(n){var t;return n&&((t=n.split("?")[0])==null?void 0:t.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function Yw(...n){return lr(n.join(":"))}function ho(n){return n=lr(n),n?n+":":""}const Zw="memory",Xw=()=>{const n=new Map;return{name:Zw,getInstance:()=>n,hasItem(t){return n.has(t)},getItem(t){return n.get(t)??null},getItemRaw(t){return n.get(t)??null},setItem(t,r){n.set(t,r)},setItemRaw(t,r){n.set(t,r)},removeItem(t){n.delete(t)},getKeys(){return[...n.keys()]},clear(){n.clear()},dispose(){n.clear()}}};function eb(n={}){const t={mounts:{"":n.driver||Xw()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=g=>{for(const b of t.mountpoints)if(g.startsWith(b))return{base:b,relativeKey:g.slice(b.length),driver:t.mounts[b]};return{base:"",relativeKey:g,driver:t.mounts[""]}},s=(g,b)=>t.mountpoints.filter(S=>S.startsWith(g)||b&&g.startsWith(S)).map(S=>({relativeBase:g.length>S.length?g.slice(S.length):void 0,mountpoint:S,driver:t.mounts[S]})),a=(g,b)=>{if(t.watching){b=lr(b);for(const S of t.watchListeners)S(g,b)}},u=async()=>{if(!t.watching){t.watching=!0;for(const g in t.mounts)t.unwatch[g]=await Qh(t.mounts[g],a,g)}},f=async()=>{if(t.watching){for(const g in t.unwatch)await t.unwatch[g]();t.unwatch={},t.watching=!1}},y=(g,b,S)=>{const O=new Map,U=$=>{let B=O.get($.base);return B||(B={driver:$.driver,base:$.base,items:[]},O.set($.base,B)),B};for(const $ of g){const B=typeof $=="string",ie=lr(B?$:$.key),ye=B?void 0:$.value,ue=B||!$.options?b:{...b,...$.options},he=r(ie);U(he).items.push({key:ie,value:ye,relativeKey:he.relativeKey,options:ue})}return Promise.all([...O.values()].map($=>S($))).then($=>$.flat())},w={hasItem(g,b={}){g=lr(g);const{relativeKey:S,driver:O}=r(g);return kt(O.hasItem,S,b)},getItem(g,b={}){g=lr(g);const{relativeKey:S,driver:O}=r(g);return kt(O.getItem,S,b).then(U=>uo(U))},getItems(g,b={}){return y(g,b,S=>S.driver.getItems?kt(S.driver.getItems,S.items.map(O=>({key:O.relativeKey,options:O.options})),b).then(O=>O.map(U=>({key:Yw(S.base,U.key),value:uo(U.value)}))):Promise.all(S.items.map(O=>kt(S.driver.getItem,O.relativeKey,O.options).then(U=>({key:O.key,value:uo(U)})))))},getItemRaw(g,b={}){g=lr(g);const{relativeKey:S,driver:O}=r(g);return O.getItemRaw?kt(O.getItemRaw,S,b):kt(O.getItem,S,b).then(U=>Ww(U))},async setItem(g,b,S={}){if(b===void 0)return w.removeItem(g);g=lr(g);const{relativeKey:O,driver:U}=r(g);U.setItem&&(await kt(U.setItem,O,yo(b),S),U.watch||a("update",g))},async setItems(g,b){await y(g,b,async S=>{if(S.driver.setItems)return kt(S.driver.setItems,S.items.map(O=>({key:O.relativeKey,value:yo(O.value),options:O.options})),b);S.driver.setItem&&await Promise.all(S.items.map(O=>kt(S.driver.setItem,O.relativeKey,yo(O.value),O.options)))})},async setItemRaw(g,b,S={}){if(b===void 0)return w.removeItem(g,S);g=lr(g);const{relativeKey:O,driver:U}=r(g);if(U.setItemRaw)await kt(U.setItemRaw,O,b,S);else if(U.setItem)await kt(U.setItem,O,Gw(b),S);else return;U.watch||a("update",g)},async removeItem(g,b={}){typeof b=="boolean"&&(b={removeMeta:b}),g=lr(g);const{relativeKey:S,driver:O}=r(g);O.removeItem&&(await kt(O.removeItem,S,b),(b.removeMeta||b.removeMata)&&await kt(O.removeItem,S+"$",b),O.watch||a("remove",g))},async getMeta(g,b={}){typeof b=="boolean"&&(b={nativeOnly:b}),g=lr(g);const{relativeKey:S,driver:O}=r(g),U=Object.create(null);if(O.getMeta&&Object.assign(U,await kt(O.getMeta,S,b)),!b.nativeOnly){const $=await kt(O.getItem,S+"$",b).then(B=>uo(B));$&&typeof $=="object"&&(typeof $.atime=="string"&&($.atime=new Date($.atime)),typeof $.mtime=="string"&&($.mtime=new Date($.mtime)),Object.assign(U,$))}return U},setMeta(g,b,S={}){return this.setItem(g+"$",b,S)},removeMeta(g,b={}){return this.removeItem(g+"$",b)},async getKeys(g,b={}){g=ho(g);const S=s(g,!0);let O=[];const U=[];for(const $ of S){const B=await kt($.driver.getKeys,$.relativeBase,b);for(const ie of B){const ye=$.mountpoint+lr(ie);O.some(ue=>ye.startsWith(ue))||U.push(ye)}O=[$.mountpoint,...O.filter(ie=>!ie.startsWith($.mountpoint))]}return g?U.filter($=>$.startsWith(g)&&$[$.length-1]!=="$"):U.filter($=>$[$.length-1]!=="$")},async clear(g,b={}){g=ho(g),await Promise.all(s(g,!1).map(async S=>{if(S.driver.clear)return kt(S.driver.clear,S.relativeBase,b);if(S.driver.removeItem){const O=await S.driver.getKeys(S.relativeBase||"",b);return Promise.all(O.map(U=>S.driver.removeItem(U,b)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(g=>Yh(g)))},async watch(g){return await u(),t.watchListeners.push(g),async()=>{t.watchListeners=t.watchListeners.filter(b=>b!==g),t.watchListeners.length===0&&await f()}},async unwatch(){t.watchListeners=[],await f()},mount(g,b){if(g=ho(g),g&&t.mounts[g])throw new Error(`already mounted at ${g}`);return g&&(t.mountpoints.push(g),t.mountpoints.sort((S,O)=>O.length-S.length)),t.mounts[g]=b,t.watching&&Promise.resolve(Qh(b,a,g)).then(S=>{t.unwatch[g]=S}).catch(console.error),w},async unmount(g,b=!0){var S,O;g=ho(g),!(!g||!t.mounts[g])&&(t.watching&&g in t.unwatch&&((O=(S=t.unwatch)[g])==null||O.call(S),delete t.unwatch[g]),b&&await Yh(t.mounts[g]),t.mountpoints=t.mountpoints.filter(U=>U!==g),delete t.mounts[g])},getMount(g=""){g=lr(g)+":";const b=r(g);return{driver:b.driver,base:b.base}},getMounts(g="",b={}){return g=lr(g),s(g,b.parents).map(O=>({driver:O.driver,base:O.mountpoint}))},keys:(g,b={})=>w.getKeys(g,b),get:(g,b={})=>w.getItem(g,b),set:(g,b,S={})=>w.setItem(g,b,S),has:(g,b={})=>w.hasItem(g,b),del:(g,b={})=>w.removeItem(g,b),remove:(g,b={})=>w.removeItem(g,b)};return w}function Qh(n,t,r){return n.watch?n.watch((s,a)=>t(s,r+a)):()=>{}}async function Yh(n){typeof n.dispose=="function"&&await kt(n.dispose)}function Ki(n){return new Promise((t,r)=>{n.oncomplete=n.onsuccess=()=>t(n.result),n.onabort=n.onerror=()=>r(n.error)})}function lf(n,t){const r=indexedDB.open(n);r.onupgradeneeded=()=>r.result.createObjectStore(t);const s=Ki(r);return(a,u)=>s.then(f=>u(f.transaction(t,a).objectStore(t)))}let ic;function Zs(){return ic||(ic=lf("keyval-store","keyval")),ic}function Zh(n,t=Zs()){return t("readonly",r=>Ki(r.get(n)))}function tb(n,t,r=Zs()){return r("readwrite",s=>(s.put(t,n),Ki(s.transaction)))}function rb(n,t=Zs()){return t("readwrite",r=>(r.delete(n),Ki(r.transaction)))}function ib(n=Zs()){return n("readwrite",t=>(t.clear(),Ki(t.transaction)))}function sb(n,t){return n.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Ki(n.transaction)}function nb(n=Zs()){return n("readonly",t=>{if(t.getAllKeys)return Ki(t.getAllKeys());const r=[];return sb(t,s=>r.push(s.key)).then(()=>r)})}const ob="idb-keyval";var ab=(n={})=>{const t=n.base&&n.base.length>0?`${n.base}:`:"",r=a=>t+a;let s;return n.dbName&&n.storeName&&(s=lf(n.dbName,n.storeName)),{name:ob,options:n,async hasItem(a){return!(typeof await Zh(r(a),s)>"u")},async getItem(a){return await Zh(r(a),s)??null},setItem(a,u){return tb(r(a),u,s)},removeItem(a){return rb(r(a),s)},getKeys(){return nb(s)},clear(){return ib(s)}}};const cb="WALLET_CONNECT_V2_INDEXED_DB",ub="keyvaluestorage";let hb=class{constructor(){this.indexedDb=eb({driver:ab({dbName:cb,storeName:ub})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,ee.safeJsonStringify(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var sc=typeof globalThis<"u"?globalThis:typeof window<"u"||typeof window<"u"?window:typeof self<"u"?self:{},vo={exports:{}};(function(){let n;function t(){}n=t,n.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},n.prototype.setItem=function(r,s){this[r]=String(s)},n.prototype.removeItem=function(r){delete this[r]},n.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},n.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},n.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof sc<"u"&&sc.localStorage?vo.exports=sc.localStorage:typeof window<"u"&&window.localStorage?vo.exports=window.localStorage:vo.exports=new t})();function lb(n){var t;return[n[0],ee.safeJsonParse((t=n[1])!=null?t:"")]}let fb=class{constructor(){this.localStorage=vo.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(lb)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return ee.safeJsonParse(r)}async setItem(t,r){this.localStorage.setItem(t,ee.safeJsonStringify(r))}async removeItem(t){this.localStorage.removeItem(t)}};const pb="wc_storage_version",Xh=1,db=async(n,t,r)=>{const s=pb,a=await t.getItem(s);if(a&&a>=Xh){r(t);return}const u=await n.getKeys();if(!u.length){r(t);return}const f=[];for(;u.length;){const y=u.shift();if(!y)continue;const w=y.toLowerCase();if(w.includes("wc@")||w.includes("walletconnect")||w.includes("wc_")||w.includes("wallet_connect")){const g=await n.getItem(y);await t.setItem(y,g),f.push(y)}}await t.setItem(s,Xh),r(t),gb(n,f)},gb=async(n,t)=>{t.length&&t.forEach(async r=>{await n.removeItem(r)})};let yb=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new fb;this.storage=t;try{const r=new hb;db(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var nc={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Oc=function(n,t){return Oc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var a in s)s.hasOwnProperty(a)&&(r[a]=s[a])},Oc(n,t)};function vb(n,t){Oc(n,t);function r(){this.constructor=n}n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Rc=function(){return Rc=Object.assign||function(t){for(var r,s=1,a=arguments.length;s<a;s++){r=arguments[s];for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(t[u]=r[u])}return t},Rc.apply(this,arguments)};function mb(n,t){var r={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.indexOf(s)<0&&(r[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(n);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(n,s[a])&&(r[s[a]]=n[s[a]]);return r}function wb(n,t,r,s){var a=arguments.length,u=a<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,r):s,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(n,t,r,s);else for(var y=n.length-1;y>=0;y--)(f=n[y])&&(u=(a<3?f(u):a>3?f(t,r,u):f(t,r))||u);return a>3&&u&&Object.defineProperty(t,r,u),u}function bb(n,t){return function(r,s){t(r,s,n)}}function _b(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)}function Eb(n,t,r,s){function a(u){return u instanceof r?u:new r(function(f){f(u)})}return new(r||(r=Promise))(function(u,f){function y(b){try{g(s.next(b))}catch(S){f(S)}}function w(b){try{g(s.throw(b))}catch(S){f(S)}}function g(b){b.done?u(b.value):a(b.value).then(y,w)}g((s=s.apply(n,t||[])).next())})}function Ib(n,t){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},s,a,u,f;return f={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function y(g){return function(b){return w([g,b])}}function w(g){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,a&&(u=g[0]&2?a.return:g[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,g[1])).done)return u;switch(a=0,u&&(g=[g[0]&2,u.value]),g[0]){case 0:case 1:u=g;break;case 4:return r.label++,{value:g[1],done:!1};case 5:r.label++,a=g[1],g=[0];continue;case 7:g=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(g[0]===6||g[0]===2)){r=0;continue}if(g[0]===3&&(!u||g[1]>u[0]&&g[1]<u[3])){r.label=g[1];break}if(g[0]===6&&r.label<u[1]){r.label=u[1],u=g;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(g);break}u[2]&&r.ops.pop(),r.trys.pop();continue}g=t.call(n,r)}catch(b){g=[6,b],a=0}finally{s=u=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}function xb(n,t,r,s){s===void 0&&(s=r),n[s]=t[r]}function Sb(n,t){for(var r in n)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=n[r])}function Tc(n){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&n[t],s=0;if(r)return r.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ff(n,t){var r=typeof Symbol=="function"&&n[Symbol.iterator];if(!r)return n;var s=r.call(n),a,u=[],f;try{for(;(t===void 0||t-- >0)&&!(a=s.next()).done;)u.push(a.value)}catch(y){f={error:y}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(f)throw f.error}}return u}function Pb(){for(var n=[],t=0;t<arguments.length;t++)n=n.concat(ff(arguments[t]));return n}function Ob(){for(var n=0,t=0,r=arguments.length;t<r;t++)n+=arguments[t].length;for(var s=Array(n),a=0,t=0;t<r;t++)for(var u=arguments[t],f=0,y=u.length;f<y;f++,a++)s[a]=u[f];return s}function Qs(n){return this instanceof Qs?(this.v=n,this):new Qs(n)}function Rb(n,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r.apply(n,t||[]),a,u=[];return a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a;function f(O){s[O]&&(a[O]=function(U){return new Promise(function($,B){u.push([O,U,$,B])>1||y(O,U)})})}function y(O,U){try{w(s[O](U))}catch($){S(u[0][3],$)}}function w(O){O.value instanceof Qs?Promise.resolve(O.value.v).then(g,b):S(u[0][2],O)}function g(O){y("next",O)}function b(O){y("throw",O)}function S(O,U){O(U),u.shift(),u.length&&y(u[0][0],u[0][1])}}function Tb(n){var t,r;return t={},s("next"),s("throw",function(a){throw a}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(a,u){t[a]=n[a]?function(f){return(r=!r)?{value:Qs(n[a](f)),done:a==="return"}:u?u(f):f}:u}}function Nb(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=n[Symbol.asyncIterator],r;return t?t.call(n):(n=typeof Tc=="function"?Tc(n):n[Symbol.iterator](),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(u){r[u]=n[u]&&function(f){return new Promise(function(y,w){f=n[u](f),a(y,w,f.done,f.value)})}}function a(u,f,y,w){Promise.resolve(w).then(function(g){u({value:g,done:y})},f)}}function Ab(n,t){return Object.defineProperty?Object.defineProperty(n,"raw",{value:t}):n.raw=t,n}function $b(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var r in n)Object.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t.default=n,t}function Cb(n){return n&&n.__esModule?n:{default:n}}function jb(n,t){if(!t.has(n))throw new TypeError("attempted to get private field on non-instance");return t.get(n)}function Db(n,t,r){if(!t.has(n))throw new TypeError("attempted to set private field on non-instance");return t.set(n,r),r}const qb=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Rc},__asyncDelegator:Tb,__asyncGenerator:Rb,__asyncValues:Nb,__await:Qs,__awaiter:Eb,__classPrivateFieldGet:jb,__classPrivateFieldSet:Db,__createBinding:xb,__decorate:wb,__exportStar:Sb,__extends:vb,__generator:Ib,__importDefault:Cb,__importStar:$b,__makeTemplateObject:Ab,__metadata:_b,__param:bb,__read:ff,__rest:mb,__spread:Pb,__spreadArrays:Ob,__values:Tc},Symbol.toStringTag,{value:"Module"})),Oo=q.getAugmentedNamespace(qb);var Ls={},oc={},zs={};class Vi{}const Ub=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Vi},Symbol.toStringTag,{value:"Module"})),Mb=q.getAugmentedNamespace(Ub);var el;function Lb(){if(el)return zs;el=1,Object.defineProperty(zs,"__esModule",{value:!0}),zs.IHeartBeat=void 0;const n=Mb;class t extends n.IEvents{constructor(s){super()}}return zs.IHeartBeat=t,zs}var tl;function pf(){return tl||(tl=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),Oo.__exportStar(Lb(),n)}(oc)),oc}var ac={},zi={},rl;function zb(){if(rl)return zi;rl=1,Object.defineProperty(zi,"__esModule",{value:!0}),zi.HEARTBEAT_EVENTS=zi.HEARTBEAT_INTERVAL=void 0;const n=q.requireCjs();return zi.HEARTBEAT_INTERVAL=n.FIVE_SECONDS,zi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},zi}var il;function df(){return il||(il=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),Oo.__exportStar(zb(),n)}(ac)),ac}var sl;function kb(){if(sl)return Ls;sl=1,Object.defineProperty(Ls,"__esModule",{value:!0}),Ls.HeartBeat=void 0;const n=Oo,t=q.requireEvents(),r=q.requireCjs(),s=pf(),a=df();class u extends s.IHeartBeat{constructor(y){super(y),this.events=new t.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(y==null?void 0:y.interval)||a.HEARTBEAT_INTERVAL}static init(y){return n.__awaiter(this,void 0,void 0,function*(){const w=new u(y);return yield w.init(),w})}init(){return n.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(y,w){this.events.on(y,w)}once(y,w){this.events.once(y,w)}off(y,w){this.events.off(y,w)}removeListener(y,w){this.events.removeListener(y,w)}initialize(){return n.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return Ls.HeartBeat=u,Ls}var nl;function Hb(){return nl||(nl=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});const t=Oo;t.__exportStar(kb(),n),t.__exportStar(pf(),n),t.__exportStar(df(),n)}(nc)),nc}var Xs=Hb(),cc,ol;function Kb(){if(ol)return cc;ol=1;function n(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}cc=t;function t(r,s,a){var u=a&&a.stringify||n,f=1;if(typeof r=="object"&&r!==null){var y=s.length+f;if(y===1)return r;var w=new Array(y);w[0]=u(r);for(var g=1;g<y;g++)w[g]=u(s[g]);return w.join(" ")}if(typeof r!="string")return r;var b=s.length;if(b===0)return r;for(var S="",O=1-f,U=-1,$=r&&r.length||0,B=0;B<$;){if(r.charCodeAt(B)===37&&B+1<$){switch(U=U>-1?U:0,r.charCodeAt(B+1)){case 100:case 102:if(O>=b||s[O]==null)break;U<B&&(S+=r.slice(U,B)),S+=Number(s[O]),U=B+2,B++;break;case 105:if(O>=b||s[O]==null)break;U<B&&(S+=r.slice(U,B)),S+=Math.floor(Number(s[O])),U=B+2,B++;break;case 79:case 111:case 106:if(O>=b||s[O]===void 0)break;U<B&&(S+=r.slice(U,B));var ie=typeof s[O];if(ie==="string"){S+="'"+s[O]+"'",U=B+2,B++;break}if(ie==="function"){S+=s[O].name||"<anonymous>",U=B+2,B++;break}S+=u(s[O]),U=B+2,B++;break;case 115:if(O>=b)break;U<B&&(S+=r.slice(U,B)),S+=String(s[O]),U=B+2,B++;break;case 37:U<B&&(S+=r.slice(U,B)),S+="%",U=B+2,B++,O--;break}++O}++B}return U===-1?r:(U<$&&(S+=r.slice(U)),S)}return cc}var uc,al;function Vb(){if(al)return uc;al=1;const n=Kb();uc=a;const t=pe().console||{},r={mapHttpRequest:$,mapHttpResponse:$,wrapRequestSerializer:B,wrapResponseSerializer:B,wrapErrorSerializer:B,req:$,res:$,err:O};function s(j,K){return Array.isArray(j)?j.filter(function(ve){return ve!=="!stdSerializers.err"}):j===!0?Object.keys(K):!1}function a(j){j=j||{},j.browser=j.browser||{};const K=j.browser.transmit;if(K&&typeof K.send!="function")throw Error("pino: transmit option must have a send function");const Q=j.browser.write||t;j.browser.write&&(j.browser.asObject=!0);const ve=j.serializers||{},se=s(j.browser.serialize,ve);let Ie=j.browser.serialize;Array.isArray(j.browser.serialize)&&j.browser.serialize.indexOf("!stdSerializers.err")>-1&&(Ie=!1);const Te=["error","fatal","warn","info","debug","trace"];typeof Q=="function"&&(Q.error=Q.fatal=Q.warn=Q.info=Q.debug=Q.trace=Q),j.enabled===!1&&(j.level="silent");const et=j.level||"info",N=Object.create(Q);N.log||(N.log=ie),Object.defineProperty(N,"levelVal",{get:Le}),Object.defineProperty(N,"level",{get:Ne,set:Y});const z={transmit:K,serialize:se,asObject:j.browser.asObject,levels:Te,timestamp:U(j)};N.levels=a.levels,N.level=et,N.setMaxListeners=N.getMaxListeners=N.emit=N.addListener=N.on=N.prependListener=N.once=N.prependOnceListener=N.removeListener=N.removeAllListeners=N.listeners=N.listenerCount=N.eventNames=N.write=N.flush=ie,N.serializers=ve,N._serialize=se,N._stdErrSerialize=Ie,N.child=F,K&&(N._logEvent=S());function Le(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Ne(){return this._level}function Y(V){if(V!=="silent"&&!this.levels.values[V])throw Error("unknown level "+V);this._level=V,u(z,N,"error","log"),u(z,N,"fatal","error"),u(z,N,"warn","error"),u(z,N,"info","log"),u(z,N,"debug","log"),u(z,N,"trace","log")}function F(V,G){if(!V)throw new Error("missing bindings for child Pino");G=G||{},se&&V.serializers&&(G.serializers=V.serializers);const ut=G.serializers;if(se&&ut){var He=Object.assign({},ve,ut),Hr=j.browser.serialize===!0?Object.keys(He):se;delete V.serializers,w([V],Hr,He,this._stdErrSerialize)}function _e(xt){this._childLevel=(xt._childLevel|0)+1,this.error=g(xt,V,"error"),this.fatal=g(xt,V,"fatal"),this.warn=g(xt,V,"warn"),this.info=g(xt,V,"info"),this.debug=g(xt,V,"debug"),this.trace=g(xt,V,"trace"),He&&(this.serializers=He,this._serialize=Hr),K&&(this._logEvent=S([].concat(xt._logEvent.bindings,V)))}return _e.prototype=this,new _e(this)}return N}a.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},a.stdSerializers=r,a.stdTimeFunctions=Object.assign({},{nullTime:ye,epochTime:ue,unixTime:he,isoTime:fe});function u(j,K,Q,ve){const se=Object.getPrototypeOf(K);K[Q]=K.levelVal>K.levels.values[Q]?ie:se[Q]?se[Q]:t[Q]||t[ve]||ie,f(j,K,Q)}function f(j,K,Q){!j.transmit&&K[Q]===ie||(K[Q]=function(ve){return function(){const Ie=j.timestamp(),Te=new Array(arguments.length),et=Object.getPrototypeOf&&Object.getPrototypeOf(this)===t?t:this;for(var N=0;N<Te.length;N++)Te[N]=arguments[N];if(j.serialize&&!j.asObject&&w(Te,this._serialize,this.serializers,this._stdErrSerialize),j.asObject?ve.call(et,y(this,Q,Te,Ie)):ve.apply(et,Te),j.transmit){const z=j.transmit.level||K.level,Le=a.levels.values[z],Ne=a.levels.values[Q];if(Ne<Le)return;b(this,{ts:Ie,methodLevel:Q,methodValue:Ne,transmitLevel:z,transmitValue:a.levels.values[j.transmit.level||K.level],send:j.transmit.send,val:K.levelVal},Te)}}}(K[Q]))}function y(j,K,Q,ve){j._serialize&&w(Q,j._serialize,j.serializers,j._stdErrSerialize);const se=Q.slice();let Ie=se[0];const Te={};ve&&(Te.time=ve),Te.level=a.levels.values[K];let et=(j._childLevel|0)+1;if(et<1&&(et=1),Ie!==null&&typeof Ie=="object"){for(;et--&&typeof se[0]=="object";)Object.assign(Te,se.shift());Ie=se.length?n(se.shift(),se):void 0}else typeof Ie=="string"&&(Ie=n(se.shift(),se));return Ie!==void 0&&(Te.msg=Ie),Te}function w(j,K,Q,ve){for(const se in j)if(ve&&j[se]instanceof Error)j[se]=a.stdSerializers.err(j[se]);else if(typeof j[se]=="object"&&!Array.isArray(j[se]))for(const Ie in j[se])K&&K.indexOf(Ie)>-1&&Ie in Q&&(j[se][Ie]=Q[Ie](j[se][Ie]))}function g(j,K,Q){return function(){const ve=new Array(1+arguments.length);ve[0]=K;for(var se=1;se<ve.length;se++)ve[se]=arguments[se-1];return j[Q].apply(this,ve)}}function b(j,K,Q){const ve=K.send,se=K.ts,Ie=K.methodLevel,Te=K.methodValue,et=K.val,N=j._logEvent.bindings;w(Q,j._serialize||Object.keys(j.serializers),j.serializers,j._stdErrSerialize===void 0?!0:j._stdErrSerialize),j._logEvent.ts=se,j._logEvent.messages=Q.filter(function(z){return N.indexOf(z)===-1}),j._logEvent.level.label=Ie,j._logEvent.level.value=Te,ve(Ie,j._logEvent,et),j._logEvent=S(N)}function S(j){return{ts:0,messages:[],bindings:j||[],level:{label:"",value:0}}}function O(j){const K={type:j.constructor.name,msg:j.message,stack:j.stack};for(const Q in j)K[Q]===void 0&&(K[Q]=j[Q]);return K}function U(j){return typeof j.timestamp=="function"?j.timestamp:j.timestamp===!1?ye:ue}function $(){return{}}function B(j){return j}function ie(){}function ye(){return!1}function ue(){return Date.now()}function he(){return Math.round(Date.now()/1e3)}function fe(){return new Date(Date.now()).toISOString()}function pe(){function j(K){return typeof K<"u"&&K}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return j(self)||j(window)||j(this)||{}}}return uc}var Bb=Vb();const Ro=q.getDefaultExportFromCjs(Bb),Fb={level:"info"},en="custom_context";var Gb=Object.defineProperty,Wb=Object.defineProperties,Jb=Object.getOwnPropertyDescriptors,cl=Object.getOwnPropertySymbols,Qb=Object.prototype.hasOwnProperty,Yb=Object.prototype.propertyIsEnumerable,ul=(n,t,r)=>t in n?Gb(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Zb=(n,t)=>{for(var r in t||(t={}))Qb.call(t,r)&&ul(n,r,t[r]);if(cl)for(var r of cl(t))Yb.call(t,r)&&ul(n,r,t[r]);return n},Xb=(n,t)=>Wb(n,Jb(t));function To(n){return Xb(Zb({},n),{level:(n==null?void 0:n.level)||Fb.level})}function e0(n,t=en){return n[t]||""}function t0(n,t,r=en){return n[r]=t,n}function pr(n,t=en){let r="";return typeof n.bindings>"u"?r=e0(n,t):r=n.bindings().context||"",r}function r0(n,t,r=en){const s=pr(n,r);return s.trim()?`${s}/${t}`:t}function dr(n,t,r=en){const s=r0(n,t,r),a=n.child({context:s});return t0(a,s,r)}class i0 extends Vi{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let s0=class extends Vi{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},n0=class{constructor(t,r){this.logger=t,this.core=r}},o0=class extends Vi{constructor(t,r){super(),this.relayer=t,this.logger=r}},a0=class extends Vi{constructor(t){super()}},c0=class{constructor(t,r,s,a){this.core=t,this.logger=r,this.name=s}};class u0 extends Vi{constructor(t,r){super(),this.relayer=t,this.logger=r}}let h0=class extends Vi{constructor(t,r){super(),this.core=t,this.logger=r}},l0=class{constructor(t,r){this.projectId=t,this.logger=r}},f0=class{constructor(t,r){this.projectId=t,this.logger=r}},p0=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},d0=class{constructor(t){this.client=t}};var hc={},lc={},hl;function g0(){return hl||(hl=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});var t=q.requireBinary(),r=q.requireWipe();n.DIGEST_LENGTH=64,n.BLOCK_SIZE=128;var s=function(){function y(){this.digestLength=n.DIGEST_LENGTH,this.blockSize=n.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return y.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},y.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},y.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},y.prototype.update=function(w,g){if(g===void 0&&(g=w.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var b=0;if(this._bytesHashed+=g,this._bufferLength>0){for(;this._bufferLength<n.BLOCK_SIZE&&g>0;)this._buffer[this._bufferLength++]=w[b++],g--;this._bufferLength===this.blockSize&&(u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(g>=this.blockSize&&(b=u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,w,b,g),g%=this.blockSize);g>0;)this._buffer[this._bufferLength++]=w[b++],g--;return this},y.prototype.finish=function(w){if(!this._finished){var g=this._bytesHashed,b=this._bufferLength,S=g/536870912|0,O=g<<3,U=g%128<112?128:256;this._buffer[b]=128;for(var $=b+1;$<U-8;$++)this._buffer[$]=0;t.writeUint32BE(S,this._buffer,U-8),t.writeUint32BE(O,this._buffer,U-4),u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,U),this._finished=!0}for(var $=0;$<this.digestLength/8;$++)t.writeUint32BE(this._stateHi[$],w,$*8),t.writeUint32BE(this._stateLo[$],w,$*8+4);return this},y.prototype.digest=function(){var w=new Uint8Array(this.digestLength);return this.finish(w),w},y.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},y.prototype.restoreState=function(w){return this._stateHi.set(w.stateHi),this._stateLo.set(w.stateLo),this._bufferLength=w.bufferLength,w.buffer&&this._buffer.set(w.buffer),this._bytesHashed=w.bytesHashed,this._finished=!1,this},y.prototype.cleanSavedState=function(w){r.wipe(w.stateHi),r.wipe(w.stateLo),w.buffer&&r.wipe(w.buffer),w.bufferLength=0,w.bytesHashed=0},y}();n.SHA512=s;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function u(y,w,g,b,S,O,U){for(var $=g[0],B=g[1],ie=g[2],ye=g[3],ue=g[4],he=g[5],fe=g[6],pe=g[7],j=b[0],K=b[1],Q=b[2],ve=b[3],se=b[4],Ie=b[5],Te=b[6],et=b[7],N,z,Le,Ne,Y,F,V,G;U>=128;){for(var ut=0;ut<16;ut++){var He=8*ut+O;y[ut]=t.readUint32BE(S,He),w[ut]=t.readUint32BE(S,He+4)}for(var ut=0;ut<80;ut++){var Hr=$,_e=B,xt=ie,C=ye,A=ue,R=he,h=fe,E=pe,te=j,ce=K,we=Q,Ae=ve,Ce=se,Se=Ie,St=Te,mt=et;if(N=pe,z=et,Y=z&65535,F=z>>>16,V=N&65535,G=N>>>16,N=(ue>>>14|se<<18)^(ue>>>18|se<<14)^(se>>>9|ue<<23),z=(se>>>14|ue<<18)^(se>>>18|ue<<14)^(ue>>>9|se<<23),Y+=z&65535,F+=z>>>16,V+=N&65535,G+=N>>>16,N=ue&he^~ue&fe,z=se&Ie^~se&Te,Y+=z&65535,F+=z>>>16,V+=N&65535,G+=N>>>16,N=a[ut*2],z=a[ut*2+1],Y+=z&65535,F+=z>>>16,V+=N&65535,G+=N>>>16,N=y[ut%16],z=w[ut%16],Y+=z&65535,F+=z>>>16,V+=N&65535,G+=N>>>16,F+=Y>>>16,V+=F>>>16,G+=V>>>16,Le=V&65535|G<<16,Ne=Y&65535|F<<16,N=Le,z=Ne,Y=z&65535,F=z>>>16,V=N&65535,G=N>>>16,N=($>>>28|j<<4)^(j>>>2|$<<30)^(j>>>7|$<<25),z=(j>>>28|$<<4)^($>>>2|j<<30)^($>>>7|j<<25),Y+=z&65535,F+=z>>>16,V+=N&65535,G+=N>>>16,N=$&B^$&ie^B&ie,z=j&K^j&Q^K&Q,Y+=z&65535,F+=z>>>16,V+=N&65535,G+=N>>>16,F+=Y>>>16,V+=F>>>16,G+=V>>>16,E=V&65535|G<<16,mt=Y&65535|F<<16,N=C,z=Ae,Y=z&65535,F=z>>>16,V=N&65535,G=N>>>16,N=Le,z=Ne,Y+=z&65535,F+=z>>>16,V+=N&65535,G+=N>>>16,F+=Y>>>16,V+=F>>>16,G+=V>>>16,C=V&65535|G<<16,Ae=Y&65535|F<<16,B=Hr,ie=_e,ye=xt,ue=C,he=A,fe=R,pe=h,$=E,K=te,Q=ce,ve=we,se=Ae,Ie=Ce,Te=Se,et=St,j=mt,ut%16===15)for(var He=0;He<16;He++)N=y[He],z=w[He],Y=z&65535,F=z>>>16,V=N&65535,G=N>>>16,N=y[(He+9)%16],z=w[(He+9)%16],Y+=z&65535,F+=z>>>16,V+=N&65535,G+=N>>>16,Le=y[(He+1)%16],Ne=w[(He+1)%16],N=(Le>>>1|Ne<<31)^(Le>>>8|Ne<<24)^Le>>>7,z=(Ne>>>1|Le<<31)^(Ne>>>8|Le<<24)^(Ne>>>7|Le<<25),Y+=z&65535,F+=z>>>16,V+=N&65535,G+=N>>>16,Le=y[(He+14)%16],Ne=w[(He+14)%16],N=(Le>>>19|Ne<<13)^(Ne>>>29|Le<<3)^Le>>>6,z=(Ne>>>19|Le<<13)^(Le>>>29|Ne<<3)^(Ne>>>6|Le<<26),Y+=z&65535,F+=z>>>16,V+=N&65535,G+=N>>>16,F+=Y>>>16,V+=F>>>16,G+=V>>>16,y[He]=V&65535|G<<16,w[He]=Y&65535|F<<16}N=$,z=j,Y=z&65535,F=z>>>16,V=N&65535,G=N>>>16,N=g[0],z=b[0],Y+=z&65535,F+=z>>>16,V+=N&65535,G+=N>>>16,F+=Y>>>16,V+=F>>>16,G+=V>>>16,g[0]=$=V&65535|G<<16,b[0]=j=Y&65535|F<<16,N=B,z=K,Y=z&65535,F=z>>>16,V=N&65535,G=N>>>16,N=g[1],z=b[1],Y+=z&65535,F+=z>>>16,V+=N&65535,G+=N>>>16,F+=Y>>>16,V+=F>>>16,G+=V>>>16,g[1]=B=V&65535|G<<16,b[1]=K=Y&65535|F<<16,N=ie,z=Q,Y=z&65535,F=z>>>16,V=N&65535,G=N>>>16,N=g[2],z=b[2],Y+=z&65535,F+=z>>>16,V+=N&65535,G+=N>>>16,F+=Y>>>16,V+=F>>>16,G+=V>>>16,g[2]=ie=V&65535|G<<16,b[2]=Q=Y&65535|F<<16,N=ye,z=ve,Y=z&65535,F=z>>>16,V=N&65535,G=N>>>16,N=g[3],z=b[3],Y+=z&65535,F+=z>>>16,V+=N&65535,G+=N>>>16,F+=Y>>>16,V+=F>>>16,G+=V>>>16,g[3]=ye=V&65535|G<<16,b[3]=ve=Y&65535|F<<16,N=ue,z=se,Y=z&65535,F=z>>>16,V=N&65535,G=N>>>16,N=g[4],z=b[4],Y+=z&65535,F+=z>>>16,V+=N&65535,G+=N>>>16,F+=Y>>>16,V+=F>>>16,G+=V>>>16,g[4]=ue=V&65535|G<<16,b[4]=se=Y&65535|F<<16,N=he,z=Ie,Y=z&65535,F=z>>>16,V=N&65535,G=N>>>16,N=g[5],z=b[5],Y+=z&65535,F+=z>>>16,V+=N&65535,G+=N>>>16,F+=Y>>>16,V+=F>>>16,G+=V>>>16,g[5]=he=V&65535|G<<16,b[5]=Ie=Y&65535|F<<16,N=fe,z=Te,Y=z&65535,F=z>>>16,V=N&65535,G=N>>>16,N=g[6],z=b[6],Y+=z&65535,F+=z>>>16,V+=N&65535,G+=N>>>16,F+=Y>>>16,V+=F>>>16,G+=V>>>16,g[6]=fe=V&65535|G<<16,b[6]=Te=Y&65535|F<<16,N=pe,z=et,Y=z&65535,F=z>>>16,V=N&65535,G=N>>>16,N=g[7],z=b[7],Y+=z&65535,F+=z>>>16,V+=N&65535,G+=N>>>16,F+=Y>>>16,V+=F>>>16,G+=V>>>16,g[7]=pe=V&65535|G<<16,b[7]=et=Y&65535|F<<16,O+=128,U-=128}return O}function f(y){var w=new s;w.update(y);var g=w.digest();return w.clean(),g}n.hash=f}(lc)),lc}var ll;function y0(){return ll||(ll=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.convertSecretKeyToX25519=n.convertPublicKeyToX25519=n.verify=n.sign=n.extractPublicKeyFromSecretKey=n.generateKeyPair=n.generateKeyPairFromSeed=n.SEED_LENGTH=n.SECRET_KEY_LENGTH=n.PUBLIC_KEY_LENGTH=n.SIGNATURE_LENGTH=void 0;const t=q.requireRandom(),r=g0(),s=q.requireWipe();n.SIGNATURE_LENGTH=64,n.PUBLIC_KEY_LENGTH=32,n.SECRET_KEY_LENGTH=64,n.SEED_LENGTH=32;function a(C){const A=new Float64Array(16);if(C)for(let R=0;R<C.length;R++)A[R]=C[R];return A}const u=new Uint8Array(32);u[0]=9;const f=a(),y=a([1]),w=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),g=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),b=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),S=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),O=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function U(C,A){for(let R=0;R<16;R++)C[R]=A[R]|0}function $(C){let A=1;for(let R=0;R<16;R++){let h=C[R]+A+65535;A=Math.floor(h/65536),C[R]=h-A*65536}C[0]+=A-1+37*(A-1)}function B(C,A,R){const h=~(R-1);for(let E=0;E<16;E++){const te=h&(C[E]^A[E]);C[E]^=te,A[E]^=te}}function ie(C,A){const R=a(),h=a();for(let E=0;E<16;E++)h[E]=A[E];$(h),$(h),$(h);for(let E=0;E<2;E++){R[0]=h[0]-65517;for(let ce=1;ce<15;ce++)R[ce]=h[ce]-65535-(R[ce-1]>>16&1),R[ce-1]&=65535;R[15]=h[15]-32767-(R[14]>>16&1);const te=R[15]>>16&1;R[14]&=65535,B(h,R,1-te)}for(let E=0;E<16;E++)C[2*E]=h[E]&255,C[2*E+1]=h[E]>>8}function ye(C,A){let R=0;for(let h=0;h<32;h++)R|=C[h]^A[h];return(1&R-1>>>8)-1}function ue(C,A){const R=new Uint8Array(32),h=new Uint8Array(32);return ie(R,C),ie(h,A),ye(R,h)}function he(C){const A=new Uint8Array(32);return ie(A,C),A[0]&1}function fe(C,A){for(let R=0;R<16;R++)C[R]=A[2*R]+(A[2*R+1]<<8);C[15]&=32767}function pe(C,A,R){for(let h=0;h<16;h++)C[h]=A[h]+R[h]}function j(C,A,R){for(let h=0;h<16;h++)C[h]=A[h]-R[h]}function K(C,A,R){let h,E,te=0,ce=0,we=0,Ae=0,Ce=0,Se=0,St=0,mt=0,nt=0,De=0,Je=0,Qe=0,ot=0,ze=0,Ye=0,$e=0,Ke=0,ht=0,Ue=0,Pt=0,Dt=0,Kt=0,Vt=0,Mt=0,Qt=0,sr=0,Kr=0,Yt=0,Qr=0,fi=0,Pi=0,lt=R[0],tt=R[1],ft=R[2],pt=R[3],at=R[4],rt=R[5],Ot=R[6],Rt=R[7],dt=R[8],Tt=R[9],gt=R[10],wt=R[11],yt=R[12],We=R[13],Nt=R[14],At=R[15];h=A[0],te+=h*lt,ce+=h*tt,we+=h*ft,Ae+=h*pt,Ce+=h*at,Se+=h*rt,St+=h*Ot,mt+=h*Rt,nt+=h*dt,De+=h*Tt,Je+=h*gt,Qe+=h*wt,ot+=h*yt,ze+=h*We,Ye+=h*Nt,$e+=h*At,h=A[1],ce+=h*lt,we+=h*tt,Ae+=h*ft,Ce+=h*pt,Se+=h*at,St+=h*rt,mt+=h*Ot,nt+=h*Rt,De+=h*dt,Je+=h*Tt,Qe+=h*gt,ot+=h*wt,ze+=h*yt,Ye+=h*We,$e+=h*Nt,Ke+=h*At,h=A[2],we+=h*lt,Ae+=h*tt,Ce+=h*ft,Se+=h*pt,St+=h*at,mt+=h*rt,nt+=h*Ot,De+=h*Rt,Je+=h*dt,Qe+=h*Tt,ot+=h*gt,ze+=h*wt,Ye+=h*yt,$e+=h*We,Ke+=h*Nt,ht+=h*At,h=A[3],Ae+=h*lt,Ce+=h*tt,Se+=h*ft,St+=h*pt,mt+=h*at,nt+=h*rt,De+=h*Ot,Je+=h*Rt,Qe+=h*dt,ot+=h*Tt,ze+=h*gt,Ye+=h*wt,$e+=h*yt,Ke+=h*We,ht+=h*Nt,Ue+=h*At,h=A[4],Ce+=h*lt,Se+=h*tt,St+=h*ft,mt+=h*pt,nt+=h*at,De+=h*rt,Je+=h*Ot,Qe+=h*Rt,ot+=h*dt,ze+=h*Tt,Ye+=h*gt,$e+=h*wt,Ke+=h*yt,ht+=h*We,Ue+=h*Nt,Pt+=h*At,h=A[5],Se+=h*lt,St+=h*tt,mt+=h*ft,nt+=h*pt,De+=h*at,Je+=h*rt,Qe+=h*Ot,ot+=h*Rt,ze+=h*dt,Ye+=h*Tt,$e+=h*gt,Ke+=h*wt,ht+=h*yt,Ue+=h*We,Pt+=h*Nt,Dt+=h*At,h=A[6],St+=h*lt,mt+=h*tt,nt+=h*ft,De+=h*pt,Je+=h*at,Qe+=h*rt,ot+=h*Ot,ze+=h*Rt,Ye+=h*dt,$e+=h*Tt,Ke+=h*gt,ht+=h*wt,Ue+=h*yt,Pt+=h*We,Dt+=h*Nt,Kt+=h*At,h=A[7],mt+=h*lt,nt+=h*tt,De+=h*ft,Je+=h*pt,Qe+=h*at,ot+=h*rt,ze+=h*Ot,Ye+=h*Rt,$e+=h*dt,Ke+=h*Tt,ht+=h*gt,Ue+=h*wt,Pt+=h*yt,Dt+=h*We,Kt+=h*Nt,Vt+=h*At,h=A[8],nt+=h*lt,De+=h*tt,Je+=h*ft,Qe+=h*pt,ot+=h*at,ze+=h*rt,Ye+=h*Ot,$e+=h*Rt,Ke+=h*dt,ht+=h*Tt,Ue+=h*gt,Pt+=h*wt,Dt+=h*yt,Kt+=h*We,Vt+=h*Nt,Mt+=h*At,h=A[9],De+=h*lt,Je+=h*tt,Qe+=h*ft,ot+=h*pt,ze+=h*at,Ye+=h*rt,$e+=h*Ot,Ke+=h*Rt,ht+=h*dt,Ue+=h*Tt,Pt+=h*gt,Dt+=h*wt,Kt+=h*yt,Vt+=h*We,Mt+=h*Nt,Qt+=h*At,h=A[10],Je+=h*lt,Qe+=h*tt,ot+=h*ft,ze+=h*pt,Ye+=h*at,$e+=h*rt,Ke+=h*Ot,ht+=h*Rt,Ue+=h*dt,Pt+=h*Tt,Dt+=h*gt,Kt+=h*wt,Vt+=h*yt,Mt+=h*We,Qt+=h*Nt,sr+=h*At,h=A[11],Qe+=h*lt,ot+=h*tt,ze+=h*ft,Ye+=h*pt,$e+=h*at,Ke+=h*rt,ht+=h*Ot,Ue+=h*Rt,Pt+=h*dt,Dt+=h*Tt,Kt+=h*gt,Vt+=h*wt,Mt+=h*yt,Qt+=h*We,sr+=h*Nt,Kr+=h*At,h=A[12],ot+=h*lt,ze+=h*tt,Ye+=h*ft,$e+=h*pt,Ke+=h*at,ht+=h*rt,Ue+=h*Ot,Pt+=h*Rt,Dt+=h*dt,Kt+=h*Tt,Vt+=h*gt,Mt+=h*wt,Qt+=h*yt,sr+=h*We,Kr+=h*Nt,Yt+=h*At,h=A[13],ze+=h*lt,Ye+=h*tt,$e+=h*ft,Ke+=h*pt,ht+=h*at,Ue+=h*rt,Pt+=h*Ot,Dt+=h*Rt,Kt+=h*dt,Vt+=h*Tt,Mt+=h*gt,Qt+=h*wt,sr+=h*yt,Kr+=h*We,Yt+=h*Nt,Qr+=h*At,h=A[14],Ye+=h*lt,$e+=h*tt,Ke+=h*ft,ht+=h*pt,Ue+=h*at,Pt+=h*rt,Dt+=h*Ot,Kt+=h*Rt,Vt+=h*dt,Mt+=h*Tt,Qt+=h*gt,sr+=h*wt,Kr+=h*yt,Yt+=h*We,Qr+=h*Nt,fi+=h*At,h=A[15],$e+=h*lt,Ke+=h*tt,ht+=h*ft,Ue+=h*pt,Pt+=h*at,Dt+=h*rt,Kt+=h*Ot,Vt+=h*Rt,Mt+=h*dt,Qt+=h*Tt,sr+=h*gt,Kr+=h*wt,Yt+=h*yt,Qr+=h*We,fi+=h*Nt,Pi+=h*At,te+=38*Ke,ce+=38*ht,we+=38*Ue,Ae+=38*Pt,Ce+=38*Dt,Se+=38*Kt,St+=38*Vt,mt+=38*Mt,nt+=38*Qt,De+=38*sr,Je+=38*Kr,Qe+=38*Yt,ot+=38*Qr,ze+=38*fi,Ye+=38*Pi,E=1,h=te+E+65535,E=Math.floor(h/65536),te=h-E*65536,h=ce+E+65535,E=Math.floor(h/65536),ce=h-E*65536,h=we+E+65535,E=Math.floor(h/65536),we=h-E*65536,h=Ae+E+65535,E=Math.floor(h/65536),Ae=h-E*65536,h=Ce+E+65535,E=Math.floor(h/65536),Ce=h-E*65536,h=Se+E+65535,E=Math.floor(h/65536),Se=h-E*65536,h=St+E+65535,E=Math.floor(h/65536),St=h-E*65536,h=mt+E+65535,E=Math.floor(h/65536),mt=h-E*65536,h=nt+E+65535,E=Math.floor(h/65536),nt=h-E*65536,h=De+E+65535,E=Math.floor(h/65536),De=h-E*65536,h=Je+E+65535,E=Math.floor(h/65536),Je=h-E*65536,h=Qe+E+65535,E=Math.floor(h/65536),Qe=h-E*65536,h=ot+E+65535,E=Math.floor(h/65536),ot=h-E*65536,h=ze+E+65535,E=Math.floor(h/65536),ze=h-E*65536,h=Ye+E+65535,E=Math.floor(h/65536),Ye=h-E*65536,h=$e+E+65535,E=Math.floor(h/65536),$e=h-E*65536,te+=E-1+37*(E-1),E=1,h=te+E+65535,E=Math.floor(h/65536),te=h-E*65536,h=ce+E+65535,E=Math.floor(h/65536),ce=h-E*65536,h=we+E+65535,E=Math.floor(h/65536),we=h-E*65536,h=Ae+E+65535,E=Math.floor(h/65536),Ae=h-E*65536,h=Ce+E+65535,E=Math.floor(h/65536),Ce=h-E*65536,h=Se+E+65535,E=Math.floor(h/65536),Se=h-E*65536,h=St+E+65535,E=Math.floor(h/65536),St=h-E*65536,h=mt+E+65535,E=Math.floor(h/65536),mt=h-E*65536,h=nt+E+65535,E=Math.floor(h/65536),nt=h-E*65536,h=De+E+65535,E=Math.floor(h/65536),De=h-E*65536,h=Je+E+65535,E=Math.floor(h/65536),Je=h-E*65536,h=Qe+E+65535,E=Math.floor(h/65536),Qe=h-E*65536,h=ot+E+65535,E=Math.floor(h/65536),ot=h-E*65536,h=ze+E+65535,E=Math.floor(h/65536),ze=h-E*65536,h=Ye+E+65535,E=Math.floor(h/65536),Ye=h-E*65536,h=$e+E+65535,E=Math.floor(h/65536),$e=h-E*65536,te+=E-1+37*(E-1),C[0]=te,C[1]=ce,C[2]=we,C[3]=Ae,C[4]=Ce,C[5]=Se,C[6]=St,C[7]=mt,C[8]=nt,C[9]=De,C[10]=Je,C[11]=Qe,C[12]=ot,C[13]=ze,C[14]=Ye,C[15]=$e}function Q(C,A){K(C,A,A)}function ve(C,A){const R=a();let h;for(h=0;h<16;h++)R[h]=A[h];for(h=253;h>=0;h--)Q(R,R),h!==2&&h!==4&&K(R,R,A);for(h=0;h<16;h++)C[h]=R[h]}function se(C,A){const R=a();let h;for(h=0;h<16;h++)R[h]=A[h];for(h=250;h>=0;h--)Q(R,R),h!==1&&K(R,R,A);for(h=0;h<16;h++)C[h]=R[h]}function Ie(C,A){const R=a(),h=a(),E=a(),te=a(),ce=a(),we=a(),Ae=a(),Ce=a(),Se=a();j(R,C[1],C[0]),j(Se,A[1],A[0]),K(R,R,Se),pe(h,C[0],C[1]),pe(Se,A[0],A[1]),K(h,h,Se),K(E,C[3],A[3]),K(E,E,g),K(te,C[2],A[2]),pe(te,te,te),j(ce,h,R),j(we,te,E),pe(Ae,te,E),pe(Ce,h,R),K(C[0],ce,we),K(C[1],Ce,Ae),K(C[2],Ae,we),K(C[3],ce,Ce)}function Te(C,A,R){for(let h=0;h<4;h++)B(C[h],A[h],R)}function et(C,A){const R=a(),h=a(),E=a();ve(E,A[2]),K(R,A[0],E),K(h,A[1],E),ie(C,h),C[31]^=he(R)<<7}function N(C,A,R){U(C[0],f),U(C[1],y),U(C[2],y),U(C[3],f);for(let h=255;h>=0;--h){const E=R[h/8|0]>>(h&7)&1;Te(C,A,E),Ie(A,C),Ie(C,C),Te(C,A,E)}}function z(C,A){const R=[a(),a(),a(),a()];U(R[0],b),U(R[1],S),U(R[2],y),K(R[3],b,S),N(C,R,A)}function Le(C){if(C.length!==n.SEED_LENGTH)throw new Error(`ed25519: seed must be ${n.SEED_LENGTH} bytes`);const A=(0,r.hash)(C);A[0]&=248,A[31]&=127,A[31]|=64;const R=new Uint8Array(32),h=[a(),a(),a(),a()];z(h,A),et(R,h);const E=new Uint8Array(64);return E.set(C),E.set(R,32),{publicKey:R,secretKey:E}}n.generateKeyPairFromSeed=Le;function Ne(C){const A=(0,t.randomBytes)(32,C),R=Le(A);return(0,s.wipe)(A),R}n.generateKeyPair=Ne;function Y(C){if(C.length!==n.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${n.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(C.subarray(32))}n.extractPublicKeyFromSecretKey=Y;const F=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function V(C,A){let R,h,E,te;for(h=63;h>=32;--h){for(R=0,E=h-32,te=h-12;E<te;++E)A[E]+=R-16*A[h]*F[E-(h-32)],R=Math.floor((A[E]+128)/256),A[E]-=R*256;A[E]+=R,A[h]=0}for(R=0,E=0;E<32;E++)A[E]+=R-(A[31]>>4)*F[E],R=A[E]>>8,A[E]&=255;for(E=0;E<32;E++)A[E]-=R*F[E];for(h=0;h<32;h++)A[h+1]+=A[h]>>8,C[h]=A[h]&255}function G(C){const A=new Float64Array(64);for(let R=0;R<64;R++)A[R]=C[R];for(let R=0;R<64;R++)C[R]=0;V(C,A)}function ut(C,A){const R=new Float64Array(64),h=[a(),a(),a(),a()],E=(0,r.hash)(C.subarray(0,32));E[0]&=248,E[31]&=127,E[31]|=64;const te=new Uint8Array(64);te.set(E.subarray(32),32);const ce=new r.SHA512;ce.update(te.subarray(32)),ce.update(A);const we=ce.digest();ce.clean(),G(we),z(h,we),et(te,h),ce.reset(),ce.update(te.subarray(0,32)),ce.update(C.subarray(32)),ce.update(A);const Ae=ce.digest();G(Ae);for(let Ce=0;Ce<32;Ce++)R[Ce]=we[Ce];for(let Ce=0;Ce<32;Ce++)for(let Se=0;Se<32;Se++)R[Ce+Se]+=Ae[Ce]*E[Se];return V(te.subarray(32),R),te}n.sign=ut;function He(C,A){const R=a(),h=a(),E=a(),te=a(),ce=a(),we=a(),Ae=a();return U(C[2],y),fe(C[1],A),Q(E,C[1]),K(te,E,w),j(E,E,C[2]),pe(te,C[2],te),Q(ce,te),Q(we,ce),K(Ae,we,ce),K(R,Ae,E),K(R,R,te),se(R,R),K(R,R,E),K(R,R,te),K(R,R,te),K(C[0],R,te),Q(h,C[0]),K(h,h,te),ue(h,E)&&K(C[0],C[0],O),Q(h,C[0]),K(h,h,te),ue(h,E)?-1:(he(C[0])===A[31]>>7&&j(C[0],f,C[0]),K(C[3],C[0],C[1]),0)}function Hr(C,A,R){const h=new Uint8Array(32),E=[a(),a(),a(),a()],te=[a(),a(),a(),a()];if(R.length!==n.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${n.SIGNATURE_LENGTH} bytes`);if(He(te,C))return!1;const ce=new r.SHA512;ce.update(R.subarray(0,32)),ce.update(C),ce.update(A);const we=ce.digest();return G(we),N(E,te,we),z(te,R.subarray(32)),Ie(E,te),et(h,E),!ye(R,h)}n.verify=Hr;function _e(C){let A=[a(),a(),a(),a()];if(He(A,C))throw new Error("Ed25519: invalid public key");let R=a(),h=a(),E=A[1];pe(R,y,E),j(h,y,E),ve(h,h),K(R,R,h);let te=new Uint8Array(32);return ie(te,R),te}n.convertPublicKeyToX25519=_e;function xt(C){const A=(0,r.hash)(C.subarray(0,32));A[0]&=248,A[31]&=127,A[31]|=64;const R=new Uint8Array(A.subarray(0,32));return(0,s.wipe)(A),R}n.convertSecretKeyToX25519=xt}(hc)),hc}var gf=y0();const v0="EdDSA",m0="JWT",yf=".",vf="base64url",w0="utf8",b0="utf8",_0=":",E0="did",I0="key",fl="base58btc",x0="z",S0="K36",P0=32;function Mc(n){return globalThis.Buffer!=null?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function mf(n=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Mc(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}function O0(n,t){t||(t=n.reduce((a,u)=>a+u.length,0));const r=mf(t);let s=0;for(const a of n)r.set(a,s),s+=a.length;return Mc(r)}function wf(n,t,r,s){return{name:n,prefix:t,encoder:{name:n,prefix:t,encode:r},decoder:{decode:s}}}const pl=wf("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),fc=wf("ascii","a",n=>{let t="a";for(let r=0;r<n.length;r++)t+=String.fromCharCode(n[r]);return t},n=>{n=n.substring(1);const t=mf(n.length);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}),bf={utf8:pl,"utf-8":pl,hex:bo.base16,latin1:fc,ascii:fc,binary:fc,...bo};function Lc(n,t="utf8"){const r=bf[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("utf8"):r.encoder.encode(n).substring(1)}function zc(n,t="utf8"){const r=bf[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Mc(globalThis.Buffer.from(n,"utf-8")):r.decoder.decode(`${r.prefix}${n}`)}function _o(n){return Lc(zc(ee.safeJsonStringify(n),w0),vf)}function _f(n){const t=zc(S0,fl),r=x0+Lc(O0([t,n]),fl);return[E0,I0,r].join(_0)}function R0(n){return Lc(n,vf)}function T0(n){return zc([_o(n.header),_o(n.payload)].join(yf),b0)}function N0(n){return[_o(n.header),_o(n.payload),R0(n.signature)].join(yf)}function dl(n=q.randomExports.randomBytes(P0)){return gf.generateKeyPairFromSeed(n)}async function A0(n,t,r,s,a=q.cjsExports.fromMiliseconds(Date.now())){const u={alg:v0,typ:m0},f=_f(s.publicKey),y=a+r,w={iss:f,sub:n,aud:t,iat:a,exp:y},g=T0({header:u,payload:w}),b=gf.sign(s.secretKey,g);return N0({header:u,payload:w,signature:b})}function kc(n){return globalThis.Buffer!=null?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function Ef(n=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?kc(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}function gl(n,t){t||(t=n.reduce((a,u)=>a+u.length,0));const r=Ef(t);let s=0;for(const a of n)r.set(a,s),s+=a.length;return kc(r)}function If(n,t,r,s){return{name:n,prefix:t,encoder:{name:n,prefix:t,encode:r},decoder:{decode:s}}}const yl=If("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),pc=If("ascii","a",n=>{let t="a";for(let r=0;r<n.length;r++)t+=String.fromCharCode(n[r]);return t},n=>{n=n.substring(1);const t=Ef(n.length);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}),xf={utf8:yl,"utf-8":yl,hex:bo.base16,latin1:pc,ascii:pc,binary:pc,...bo};function kr(n,t="utf8"){const r=xf[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?kc(globalThis.Buffer.from(n,"utf-8")):r.decoder.decode(`${r.prefix}${n}`)}function $r(n,t="utf8"){const r=xf[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("utf8"):r.encoder.encode(n).substring(1)}const $0=":";function C0(n){const[t,r]=n.split($0);return{namespace:t,reference:r}}function Sf(n,t){return n.includes(":")?[n]:t.chains||[]}const Pf="base10",ir="base16",Nc="base64pad",Hc="utf8",Of=0,Bi=1,j0=0,vl=1,Ac=12,Kc=32;function D0(){const n=q.x25519Exports.generateKeyPair();return{privateKey:$r(n.secretKey,ir),publicKey:$r(n.publicKey,ir)}}function $c(){const n=q.randomExports.randomBytes(Kc);return $r(n,ir)}function q0(n,t){const r=q.x25519Exports.sharedKey(kr(n,ir),kr(t,ir),!0),s=new q.hkdfExports.HKDF(q.sha256Exports.SHA256,r).expand(Kc);return $r(s,ir)}function U0(n){const t=q.sha256Exports.hash(kr(n,ir));return $r(t,ir)}function gs(n){const t=q.sha256Exports.hash(kr(n,Hc));return $r(t,ir)}function M0(n){return kr(`${n}`,Pf)}function tn(n){return Number($r(n,Pf))}function L0(n){const t=M0(typeof n.type<"u"?n.type:Of);if(tn(t)===Bi&&typeof n.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof n.senderPublicKey<"u"?kr(n.senderPublicKey,ir):void 0,s=typeof n.iv<"u"?kr(n.iv,ir):q.randomExports.randomBytes(Ac),a=new q.chacha20poly1305Exports.ChaCha20Poly1305(kr(n.symKey,ir)).seal(s,kr(n.message,Hc));return k0({type:t,sealed:a,iv:s,senderPublicKey:r})}function z0(n){const t=new q.chacha20poly1305Exports.ChaCha20Poly1305(kr(n.symKey,ir)),{sealed:r,iv:s}=Eo(n.encoded),a=t.open(s,r);if(a===null)throw new Error("Failed to decrypt");return $r(a,Hc)}function k0(n){if(tn(n.type)===Bi){if(typeof n.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return $r(gl([n.type,n.senderPublicKey,n.iv,n.sealed]),Nc)}return $r(gl([n.type,n.iv,n.sealed]),Nc)}function Eo(n){const t=kr(n,Nc),r=t.slice(j0,vl),s=vl;if(tn(r)===Bi){const y=s+Kc,w=y+Ac,g=t.slice(s,y),b=t.slice(y,w),S=t.slice(w);return{type:r,sealed:S,iv:b,senderPublicKey:g}}const a=s+Ac,u=t.slice(s,a),f=t.slice(a);return{type:r,sealed:f,iv:u}}function H0(n,t){const r=Eo(n);return Rf({type:tn(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?$r(r.senderPublicKey,ir):void 0,receiverPublicKey:t==null?void 0:t.receiverPublicKey})}function Rf(n){const t=(n==null?void 0:n.type)||Of;if(t===Bi){if(typeof(n==null?void 0:n.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(n==null?void 0:n.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:n==null?void 0:n.senderPublicKey,receiverPublicKey:n==null?void 0:n.receiverPublicKey}}function ml(n){return n.type===Bi&&typeof n.senderPublicKey=="string"&&typeof n.receiverPublicKey=="string"}var K0=Object.defineProperty,wl=Object.getOwnPropertySymbols,V0=Object.prototype.hasOwnProperty,B0=Object.prototype.propertyIsEnumerable,bl=(n,t,r)=>t in n?K0(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,_l=(n,t)=>{for(var r in t||(t={}))V0.call(t,r)&&bl(n,r,t[r]);if(wl)for(var r of wl(t))B0.call(t,r)&&bl(n,r,t[r]);return n};const F0="ReactNative",_r={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},G0="js";function Vc(){return typeof q.process$1<"u"&&typeof q.process$1.versions<"u"&&typeof q.process$1.versions.node<"u"}function vs(){return!q.cjsExports$2.getDocument()&&!!q.cjsExports$2.getNavigator()&&navigator.product===F0}function ms(){return!Vc()&&!!q.cjsExports$2.getNavigator()&&!!q.cjsExports$2.getDocument()}function rn(){return vs()?_r.reactNative:Vc()?_r.node:ms()?_r.browser:_r.unknown}function W0(){var n;try{return vs()&&typeof window<"u"&&typeof(window==null?void 0:window.Application)<"u"?(n=window.Application)==null?void 0:n.applicationId:void 0}catch{return}}function J0(n,t){let r=q.queryStringExports.parse(n);return r=_l(_l({},r),t),n=q.queryStringExports.stringify(r),n}function Q0(){return q.cjsExports$1.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function Y0(){if(rn()===_r.reactNative&&typeof window<"u"&&typeof(window==null?void 0:window.Platform)<"u"){const{OS:r,Version:s}=window.Platform;return[r,s].join("-")}const n=ee.detect();if(n===null)return"unknown";const t=n.os?n.os.replace(" ","").toLowerCase():"unknown";return n.type==="browser"?[t,n.name,n.version].join("-"):[t,n.version].join("-")}function Z0(){var n;const t=rn();return t===_r.browser?[t,((n=q.cjsExports$2.getLocation())==null?void 0:n.host)||"unknown"].join(":"):t}function X0(n,t,r){const s=Y0(),a=Z0();return[[n,t].join("-"),[G0,r].join("-"),s,a].join("/")}function e_({protocol:n,version:t,relayUrl:r,sdkVersion:s,auth:a,projectId:u,useOnCloseEvent:f,bundleId:y}){const w=r.split("?"),g=X0(n,t,s),b={auth:a,ua:g,projectId:u,useOnCloseEvent:f||void 0,origin:y||void 0},S=J0(w[1]||"",b);return w[0]+"?"+S}function ki(n,t){return n.filter(r=>t.includes(r)).length===n.length}function Tf(n){return Object.fromEntries(n.entries())}function Nf(n){return new Map(Object.entries(n))}function ps(n=q.cjsExports.FIVE_MINUTES,t){const r=q.cjsExports.toMiliseconds(n||q.cjsExports.FIVE_MINUTES);let s,a,u;return{resolve:f=>{u&&s&&(clearTimeout(u),s(f))},reject:f=>{u&&a&&(clearTimeout(u),a(f))},done:()=>new Promise((f,y)=>{u=setTimeout(()=>{y(new Error(t))},r),s=f,a=y})}}function Ys(n,t,r){return new Promise(async(s,a)=>{const u=setTimeout(()=>a(new Error(r)),t);try{const f=await n;s(f)}catch(f){a(f)}clearTimeout(u)})}function Af(n,t){if(typeof t=="string"&&t.startsWith(`${n}:`))return t;if(n.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(n.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${n}`)}function t_(n){return Af("topic",n)}function r_(n){return Af("id",n)}function $f(n){const[t,r]=n.split(":"),s={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")s.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))s.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return s}function zr(n,t){return q.cjsExports.fromMiliseconds(Date.now()+q.cjsExports.toMiliseconds(n))}function Ii(n){return Date.now()>=q.cjsExports.toMiliseconds(n)}function jt(n,t){return`${n}${t?`:${t}`:""}`}function dc(n=[],t=[]){return[...new Set([...n,...t])]}async function i_({id:n,topic:t,wcDeepLink:r}){try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r;let a=s==null?void 0:s.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const u=`${a}/wc?requestId=${n}&sessionTopic=${t}`,f=rn();f===_r.browser?u.startsWith("https://")?window.open(u,"_blank","noreferrer noopener"):window.open(u,"_self","noreferrer noopener"):f===_r.reactNative&&typeof(window==null?void 0:window.Linking)<"u"&&await window.Linking.openURL(u)}catch(s){console.error(s)}}async function s_(n,t){try{return await n.getItem(t)||(ms()?localStorage.getItem(t):void 0)}catch(r){console.error(r)}}const n_="irn";function Cc(n){return(n==null?void 0:n.relay)||{protocol:n_}}function mo(n){const t=Dw[n];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${n}`);return t}var o_=Object.defineProperty,El=Object.getOwnPropertySymbols,a_=Object.prototype.hasOwnProperty,c_=Object.prototype.propertyIsEnumerable,Il=(n,t,r)=>t in n?o_(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,u_=(n,t)=>{for(var r in t||(t={}))a_.call(t,r)&&Il(n,r,t[r]);if(El)for(var r of El(t))c_.call(t,r)&&Il(n,r,t[r]);return n};function h_(n,t="-"){const r={},s="relay"+t;return Object.keys(n).forEach(a=>{if(a.startsWith(s)){const u=a.replace(s,""),f=n[a];r[u]=f}}),r}function xl(n){n=n.includes("wc://")?n.replace("wc://",""):n,n=n.includes("wc:")?n.replace("wc:",""):n;const t=n.indexOf(":"),r=n.indexOf("?")!==-1?n.indexOf("?"):void 0,s=n.substring(0,t),a=n.substring(t+1,r).split("@"),u=typeof r<"u"?n.substring(r):"",f=q.queryStringExports.parse(u);return{protocol:s,topic:l_(a[0]),version:parseInt(a[1],10),symKey:f.symKey,relay:h_(f)}}function l_(n){return n.startsWith("//")?n.substring(2):n}function f_(n,t="-"){const r="relay",s={};return Object.keys(n).forEach(a=>{const u=r+t+a;n[a]&&(s[u]=n[a])}),s}function p_(n){return`${n.protocol}:${n.topic}@${n.version}?`+q.queryStringExports.stringify(u_({symKey:n.symKey},f_(n.relay)))}function ws(n){const t=[];return n.forEach(r=>{const[s,a]=r.split(":");t.push(`${s}:${a}`)}),t}function d_(n){const t=[];return Object.values(n).forEach(r=>{t.push(...ws(r.accounts))}),t}function g_(n,t){const r=[];return Object.values(n).forEach(s=>{ws(s.accounts).includes(t)&&r.push(...s.methods)}),r}function y_(n,t){const r=[];return Object.values(n).forEach(s=>{ws(s.accounts).includes(t)&&r.push(...s.events)}),r}function v_(n,t){const r=wo(n,t);if(r)throw new Error(r.message);const s={};for(const[a,u]of Object.entries(n))s[a]={methods:u.methods,events:u.events,chains:u.accounts.map(f=>`${f.split(":")[0]}:${f.split(":")[1]}`)};return s}function Bc(n){return n.includes(":")}function Fs(n){return Bc(n)?n.split(":")[0]:n}const m_={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},w_={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function W(n,t){const{message:r,code:s}=w_[n];return{message:t?`${r} ${t}`:r,code:s}}function It(n,t){const{message:r,code:s}=m_[n];return{message:t?`${r} ${t}`:r,code:s}}function Hi(n,t){return!!Array.isArray(n)}function ys(n){return Object.getPrototypeOf(n)===Object.prototype&&Object.keys(n).length}function rr(n){return typeof n>"u"}function Ht(n,t){return t&&rr(n)?!0:typeof n=="string"&&!!n.trim().length}function Fc(n,t){return t&&rr(n)?!0:typeof n=="number"&&!isNaN(n)}function b_(n,t){const{requiredNamespaces:r}=t,s=Object.keys(n.namespaces),a=Object.keys(r);let u=!0;return ki(a,s)?(s.forEach(f=>{const{accounts:y,methods:w,events:g}=n.namespaces[f],b=ws(y),S=r[f];(!ki(Sf(f,S),b)||!ki(S.methods,w)||!ki(S.events,g))&&(u=!1)}),u):!1}function Io(n){return Ht(n,!1)&&n.includes(":")?n.split(":").length===2:!1}function __(n){if(Ht(n,!1)&&n.includes(":")){const t=n.split(":");if(t.length===3){const r=t[0]+":"+t[1];return!!t[2]&&Io(r)}}return!1}function E_(n){if(Ht(n,!1))try{return typeof new URL(n)<"u"}catch{return!1}return!1}function I_(n){var t;return(t=n==null?void 0:n.proposer)==null?void 0:t.publicKey}function x_(n){return n==null?void 0:n.topic}function S_(n,t){let r=null;return Ht(n==null?void 0:n.publicKey,!1)||(r=W("MISSING_OR_INVALID",`${t} controller public key should be a string`)),r}function Sl(n){let t=!0;return Hi(n)?n.length&&(t=n.every(r=>Ht(r,!1))):t=!1,t}function P_(n,t,r){let s=null;return Hi(t)&&t.length?t.forEach(a=>{s||Io(a)||(s=It("UNSUPPORTED_CHAINS",`${r}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):Io(n)||(s=It("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function O_(n,t,r){let s=null;return Object.entries(n).forEach(([a,u])=>{if(s)return;const f=P_(a,Sf(a,u),`${t} ${r}`);f&&(s=f)}),s}function R_(n,t){let r=null;return Hi(n)?n.forEach(s=>{r||__(s)||(r=It("UNSUPPORTED_ACCOUNTS",`${t}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):r=It("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function T_(n,t){let r=null;return Object.values(n).forEach(s=>{if(r)return;const a=R_(s==null?void 0:s.accounts,`${t} namespace`);a&&(r=a)}),r}function N_(n,t){let r=null;return Sl(n==null?void 0:n.methods)?Sl(n==null?void 0:n.events)||(r=It("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):r=It("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),r}function Cf(n,t){let r=null;return Object.values(n).forEach(s=>{if(r)return;const a=N_(s,`${t}, namespace`);a&&(r=a)}),r}function A_(n,t,r){let s=null;if(n&&ys(n)){const a=Cf(n,t);a&&(s=a);const u=O_(n,t,r);u&&(s=u)}else s=W("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return s}function wo(n,t){let r=null;if(n&&ys(n)){const s=Cf(n,t);s&&(r=s);const a=T_(n,t);a&&(r=a)}else r=W("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function jf(n){return Ht(n.protocol,!0)}function $_(n,t){let r=!1;return n?n&&Hi(n)&&n.length&&n.forEach(s=>{r=jf(s)}):r=!0,r}function C_(n){return typeof n=="number"}function fr(n){return typeof n<"u"&&typeof n!==null}function j_(n){return!(!n||typeof n!="object"||!n.code||!Fc(n.code,!1)||!n.message||!Ht(n.message,!1))}function D_(n){return!(rr(n)||!Ht(n.method,!1))}function q_(n){return!(rr(n)||rr(n.result)&&rr(n.error)||!Fc(n.id,!1)||!Ht(n.jsonrpc,!1))}function U_(n){return!(rr(n)||!Ht(n.name,!1))}function Pl(n,t){return!(!Io(t)||!d_(n).includes(t))}function M_(n,t,r){return Ht(r,!1)?g_(n,t).includes(r):!1}function L_(n,t,r){return Ht(r,!1)?y_(n,t).includes(r):!1}function Ol(n,t,r){let s=null;const a=z_(n),u=k_(t),f=Object.keys(a),y=Object.keys(u),w=Rl(Object.keys(n)),g=Rl(Object.keys(t)),b=w.filter(S=>!g.includes(S));return b.length&&(s=W("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${b.toString()}
      Received: ${Object.keys(t).toString()}`)),ki(f,y)||(s=W("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${f.toString()}
      Approved: ${y.toString()}`)),Object.keys(t).forEach(S=>{if(!S.includes(":")||s)return;const O=ws(t[S].accounts);O.includes(S)||(s=W("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${S}
        Required: ${S}
        Approved: ${O.toString()}`))}),f.forEach(S=>{s||(ki(a[S].methods,u[S].methods)?ki(a[S].events,u[S].events)||(s=W("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${S}`)):s=W("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${S}`))}),s}function z_(n){const t={};return Object.keys(n).forEach(r=>{var s;r.includes(":")?t[r]=n[r]:(s=n[r].chains)==null||s.forEach(a=>{t[a]={methods:n[r].methods,events:n[r].events}})}),t}function Rl(n){return[...new Set(n.map(t=>t.includes(":")?t.split(":")[0]:t))]}function k_(n){const t={};return Object.keys(n).forEach(r=>{if(r.includes(":"))t[r]=n[r];else{const s=ws(n[r].accounts);s==null||s.forEach(a=>{t[a]={accounts:n[r].accounts.filter(u=>u.includes(`${a}:`)),methods:n[r].methods,events:n[r].events}})}}),t}function H_(n,t){return Fc(n,!1)&&n<=t.max&&n>=t.min}function Tl(){const n=rn();return new Promise(t=>{switch(n){case _r.browser:t(K_());break;case _r.reactNative:t(V_());break;case _r.node:t(B_());break;default:t(!0)}})}function K_(){return ms()&&(navigator==null?void 0:navigator.onLine)}async function V_(){if(vs()&&typeof window<"u"&&window!=null&&window.NetInfo){const n=await(window==null?void 0:window.NetInfo.fetch());return n==null?void 0:n.isConnected}return!0}function B_(){return!0}function F_(n){switch(rn()){case _r.browser:G_(n);break;case _r.reactNative:W_(n);break}}function G_(n){!vs()&&ms()&&(window.addEventListener("online",()=>n(!0)),window.addEventListener("offline",()=>n(!1)))}function W_(n){vs()&&typeof window<"u"&&window!=null&&window.NetInfo&&(window==null||window.NetInfo.addEventListener(t=>n(t==null?void 0:t.isConnected)))}const gc={};let lo=class{static get(t){return gc[t]}static set(t,r){gc[t]=r}static delete(t){delete gc[t]}};class hi extends ee.r{constructor(t){super(t),this.events=new q.eventsExports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(ee.formatJsonRpcRequest(t.method,t.params||[],t.id||ee.getBigIntRpcId().toString()),r)}async requestStrict(t,r){return new Promise(async(s,a)=>{if(!this.connection.connected)try{await this.open()}catch(u){a(u)}this.events.on(`${t.id}`,u=>{ee.isJsonRpcError(u)?a(u.error):s(u.result)});try{await this.connection.send(t,r)}catch(u){a(u)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),ee.isJsonRpcResponse(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const J_=()=>typeof WebSocket<"u"?WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Q_=()=>typeof WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Nl=n=>n.split("?")[0],Al=10,Y_=J_();let Z_=class{constructor(t){if(this.url=t,this.events=new q.eventsExports.EventEmitter,this.registering=!1,!ee.isWsUrl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(ee.safeJsonStringify(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!ee.isWsUrl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,a)=>{this.events.once("register_error",u=>{this.resetMaxListeners(),a(u)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,s)=>{const a=new URLSearchParams(t).get("origin"),u=ee.cjsExports.isReactNative()?{headers:{origin:a}}:{rejectUnauthorized:!ee.isLocalhostUrl(t)},f=new Y_(t,[],u);Q_()?f.onerror=y=>{const w=y;s(this.emitError(w.error))}:f.on("error",y=>{s(this.emitError(y))}),f.onopen=()=>{this.onOpen(f),r(f)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?ee.safeJsonParse(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),a=s.message||s.toString(),u=ee.formatJsonRpcError(t,a);this.events.emit("payload",u)}parseError(t,r=this.url){return ee.parseConnectionError(t,Nl(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Al&&this.events.setMaxListeners(Al)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${Nl(this.url)}`));return this.events.emit("register_error",r),r}};var Gs={exports:{}};Gs.exports;var $l;function X_(){return $l||($l=1,function(n,t){var r=200,s="__lodash_hash_undefined__",a=1,u=2,f=9007199254740991,y="[object Arguments]",w="[object Array]",g="[object AsyncFunction]",b="[object Boolean]",S="[object Date]",O="[object Error]",U="[object Function]",$="[object GeneratorFunction]",B="[object Map]",ie="[object Number]",ye="[object Null]",ue="[object Object]",he="[object Promise]",fe="[object Proxy]",pe="[object RegExp]",j="[object Set]",K="[object String]",Q="[object Symbol]",ve="[object Undefined]",se="[object WeakMap]",Ie="[object ArrayBuffer]",Te="[object DataView]",et="[object Float32Array]",N="[object Float64Array]",z="[object Int8Array]",Le="[object Int16Array]",Ne="[object Int32Array]",Y="[object Uint8Array]",F="[object Uint8ClampedArray]",V="[object Uint16Array]",G="[object Uint32Array]",ut=/[\\^$.*+?()[\]{}|]/g,He=/^\[object .+?Constructor\]$/,Hr=/^(?:0|[1-9]\d*)$/,_e={};_e[et]=_e[N]=_e[z]=_e[Le]=_e[Ne]=_e[Y]=_e[F]=_e[V]=_e[G]=!0,_e[y]=_e[w]=_e[Ie]=_e[b]=_e[Te]=_e[S]=_e[O]=_e[U]=_e[B]=_e[ie]=_e[ue]=_e[pe]=_e[j]=_e[K]=_e[se]=!1;var xt=typeof window=="object"&&window&&window.Object===Object&&window,C=typeof self=="object"&&self&&self.Object===Object&&self,A=xt||C||Function("return this")(),R=t&&!t.nodeType&&t,h=R&&!0&&n&&!n.nodeType&&n,E=h&&h.exports===R,te=E&&xt.process,ce=function(){try{return te&&te.binding&&te.binding("util")}catch{}}(),we=ce&&ce.isTypedArray;function Ae(v,I){for(var k=-1,Z=v==null?0:v.length,Be=0,de=[];++k<Z;){var Ze=v[k];I(Ze,k,v)&&(de[Be++]=Ze)}return de}function Ce(v,I){for(var k=-1,Z=I.length,Be=v.length;++k<Z;)v[Be+k]=I[k];return v}function Se(v,I){for(var k=-1,Z=v==null?0:v.length;++k<Z;)if(I(v[k],k,v))return!0;return!1}function St(v,I){for(var k=-1,Z=Array(v);++k<v;)Z[k]=I(k);return Z}function mt(v){return function(I){return v(I)}}function nt(v,I){return v.has(I)}function De(v,I){return v==null?void 0:v[I]}function Je(v){var I=-1,k=Array(v.size);return v.forEach(function(Z,Be){k[++I]=[Be,Z]}),k}function Qe(v,I){return function(k){return v(I(k))}}function ot(v){var I=-1,k=Array(v.size);return v.forEach(function(Z){k[++I]=Z}),k}var ze=Array.prototype,Ye=Function.prototype,$e=Object.prototype,Ke=A["__core-js_shared__"],ht=Ye.toString,Ue=$e.hasOwnProperty,Pt=function(){var v=/[^.]+$/.exec(Ke&&Ke.keys&&Ke.keys.IE_PROTO||"");return v?"Symbol(src)_1."+v:""}(),Dt=$e.toString,Kt=RegExp("^"+ht.call(Ue).replace(ut,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Vt=E?A.Buffer:void 0,Mt=A.Symbol,Qt=A.Uint8Array,sr=$e.propertyIsEnumerable,Kr=ze.splice,Yt=Mt?Mt.toStringTag:void 0,Qr=Object.getOwnPropertySymbols,fi=Vt?Vt.isBuffer:void 0,Pi=Qe(Object.keys,Object),lt=gr(A,"DataView"),tt=gr(A,"Map"),ft=gr(A,"Promise"),pt=gr(A,"Set"),at=gr(A,"WeakMap"),rt=gr(Object,"create"),Ot=Zr(lt),Rt=Zr(tt),dt=Zr(ft),Tt=Zr(pt),gt=Zr(at),wt=Mt?Mt.prototype:void 0,yt=wt?wt.valueOf:void 0;function We(v){var I=-1,k=v==null?0:v.length;for(this.clear();++I<k;){var Z=v[I];this.set(Z[0],Z[1])}}function Nt(){this.__data__=rt?rt(null):{},this.size=0}function At(v){var I=this.has(v)&&delete this.__data__[v];return this.size-=I?1:0,I}function Co(v){var I=this.__data__;if(rt){var k=I[v];return k===s?void 0:k}return Ue.call(I,v)?I[v]:void 0}function jo(v){var I=this.__data__;return rt?I[v]!==void 0:Ue.call(I,v)}function Do(v,I){var k=this.__data__;return this.size+=this.has(v)?0:1,k[v]=rt&&I===void 0?s:I,this}We.prototype.clear=Nt,We.prototype.delete=At,We.prototype.get=Co,We.prototype.has=jo,We.prototype.set=Do;function Er(v){var I=-1,k=v==null?0:v.length;for(this.clear();++I<k;){var Z=v[I];this.set(Z[0],Z[1])}}function qo(){this.__data__=[],this.size=0}function Uo(v){var I=this.__data__,k=Oi(I,v);if(k<0)return!1;var Z=I.length-1;return k==Z?I.pop():Kr.call(I,k,1),--this.size,!0}function Mo(v){var I=this.__data__,k=Oi(I,v);return k<0?void 0:I[k][1]}function Lo(v){return Oi(this.__data__,v)>-1}function zo(v,I){var k=this.__data__,Z=Oi(k,v);return Z<0?(++this.size,k.push([v,I])):k[Z][1]=I,this}Er.prototype.clear=qo,Er.prototype.delete=Uo,Er.prototype.get=Mo,Er.prototype.has=Lo,Er.prototype.set=zo;function Yr(v){var I=-1,k=v==null?0:v.length;for(this.clear();++I<k;){var Z=v[I];this.set(Z[0],Z[1])}}function Gi(){this.size=0,this.__data__={hash:new We,map:new(tt||Er),string:new We}}function ko(v){var I=pi(this,v).delete(v);return this.size-=I?1:0,I}function Wi(v){return pi(this,v).get(v)}function Ho(v){return pi(this,v).has(v)}function Ko(v,I){var k=pi(this,v),Z=k.size;return k.set(v,I),this.size+=k.size==Z?0:1,this}Yr.prototype.clear=Gi,Yr.prototype.delete=ko,Yr.prototype.get=Wi,Yr.prototype.has=Ho,Yr.prototype.set=Ko;function Ji(v){var I=-1,k=v==null?0:v.length;for(this.__data__=new Yr;++I<k;)this.add(v[I])}function nn(v){return this.__data__.set(v,s),this}function on(v){return this.__data__.has(v)}Ji.prototype.add=Ji.prototype.push=nn,Ji.prototype.has=on;function Cr(v){var I=this.__data__=new Er(v);this.size=I.size}function Vo(){this.__data__=new Er,this.size=0}function Bo(v){var I=this.__data__,k=I.delete(v);return this.size=I.size,k}function Fo(v){return this.__data__.get(v)}function Go(v){return this.__data__.has(v)}function an(v,I){var k=this.__data__;if(k instanceof Er){var Z=k.__data__;if(!tt||Z.length<r-1)return Z.push([v,I]),this.size=++k.size,this;k=this.__data__=new Yr(Z)}return k.set(v,I),this.size=k.size,this}Cr.prototype.clear=Vo,Cr.prototype.delete=Bo,Cr.prototype.get=Fo,Cr.prototype.has=Go,Cr.prototype.set=an;function cn(v,I){var k=Zi(v),Z=!k&&bn(v),Be=!k&&!Z&&Es(v),de=!k&&!Z&&!Be&&In(v),Ze=k||Z||Be||de,$t=Ze?St(v.length,String):[],Oe=$t.length;for(var Fe in v)Ue.call(v,Fe)&&!(Ze&&(Fe=="length"||Be&&(Fe=="offset"||Fe=="parent")||de&&(Fe=="buffer"||Fe=="byteLength"||Fe=="byteOffset")||gn(Fe,Oe)))&&$t.push(Fe);return $t}function Oi(v,I){for(var k=v.length;k--;)if(wn(v[k][0],I))return k;return-1}function bs(v,I,k){var Z=I(v);return Zi(v)?Z:Ce(Z,k(v))}function Ri(v){return v==null?v===void 0?ve:ye:Yt&&Yt in Object(v)?pn(v):Qo(v)}function _s(v){return Ni(v)&&Ri(v)==y}function Ti(v,I,k,Z,Be){return v===I?!0:v==null||I==null||!Ni(v)&&!Ni(I)?v!==v&&I!==I:un(v,I,k,Z,Ti,Be)}function un(v,I,k,Z,Be,de){var Ze=Zi(v),$t=Zi(I),Oe=Ze?w:Vr(v),Fe=$t?w:Vr(I);Oe=Oe==y?ue:Oe,Fe=Fe==y?ue:Fe;var bt=Oe==ue,nr=Fe==ue,Ct=Oe==Fe;if(Ct&&Es(v)){if(!Es(I))return!1;Ze=!0,bt=!1}if(Ct&&!bt)return de||(de=new Cr),Ze||In(v)?Qi(v,I,k,Z,Be,de):Jo(v,I,Oe,k,Z,Be,de);if(!(k&a)){var Xe=bt&&Ue.call(v,"__wrapped__"),Zt=nr&&Ue.call(I,"__wrapped__");if(Xe||Zt){var jr=Xe?v.value():v,Ir=Zt?I.value():I;return de||(de=new Cr),Be(jr,Ir,k,Z,de)}}return Ct?(de||(de=new Cr),fn(v,I,k,Z,Be,de)):!1}function Wo(v){if(!En(v)||vn(v))return!1;var I=Xi(v)?Kt:He;return I.test(Zr(v))}function hn(v){return Ni(v)&&_n(v.length)&&!!_e[Ri(v)]}function ln(v){if(!mn(v))return Pi(v);var I=[];for(var k in Object(v))Ue.call(v,k)&&k!="constructor"&&I.push(k);return I}function Qi(v,I,k,Z,Be,de){var Ze=k&a,$t=v.length,Oe=I.length;if($t!=Oe&&!(Ze&&Oe>$t))return!1;var Fe=de.get(v);if(Fe&&de.get(I))return Fe==I;var bt=-1,nr=!0,Ct=k&u?new Ji:void 0;for(de.set(v,I),de.set(I,v);++bt<$t;){var Xe=v[bt],Zt=I[bt];if(Z)var jr=Ze?Z(Zt,Xe,bt,I,v,de):Z(Xe,Zt,bt,v,I,de);if(jr!==void 0){if(jr)continue;nr=!1;break}if(Ct){if(!Se(I,function(Ir,Br){if(!nt(Ct,Br)&&(Xe===Ir||Be(Xe,Ir,k,Z,de)))return Ct.push(Br)})){nr=!1;break}}else if(!(Xe===Zt||Be(Xe,Zt,k,Z,de))){nr=!1;break}}return de.delete(v),de.delete(I),nr}function Jo(v,I,k,Z,Be,de,Ze){switch(k){case Te:if(v.byteLength!=I.byteLength||v.byteOffset!=I.byteOffset)return!1;v=v.buffer,I=I.buffer;case Ie:return!(v.byteLength!=I.byteLength||!de(new Qt(v),new Qt(I)));case b:case S:case ie:return wn(+v,+I);case O:return v.name==I.name&&v.message==I.message;case pe:case K:return v==I+"";case B:var $t=Je;case j:var Oe=Z&a;if($t||($t=ot),v.size!=I.size&&!Oe)return!1;var Fe=Ze.get(v);if(Fe)return Fe==I;Z|=u,Ze.set(v,I);var bt=Qi($t(v),$t(I),Z,Be,de,Ze);return Ze.delete(v),bt;case Q:if(yt)return yt.call(v)==yt.call(I)}return!1}function fn(v,I,k,Z,Be,de){var Ze=k&a,$t=Yi(v),Oe=$t.length,Fe=Yi(I),bt=Fe.length;if(Oe!=bt&&!Ze)return!1;for(var nr=Oe;nr--;){var Ct=$t[nr];if(!(Ze?Ct in I:Ue.call(I,Ct)))return!1}var Xe=de.get(v);if(Xe&&de.get(I))return Xe==I;var Zt=!0;de.set(v,I),de.set(I,v);for(var jr=Ze;++nr<Oe;){Ct=$t[nr];var Ir=v[Ct],Br=I[Ct];if(Z)var Is=Ze?Z(Br,Ir,Ct,I,v,de):Z(Ir,Br,Ct,v,I,de);if(!(Is===void 0?Ir===Br||Be(Ir,Br,k,Z,de):Is)){Zt=!1;break}jr||(jr=Ct=="constructor")}if(Zt&&!jr){var Ai=v.constructor,Lt=I.constructor;Ai!=Lt&&"constructor"in v&&"constructor"in I&&!(typeof Ai=="function"&&Ai instanceof Ai&&typeof Lt=="function"&&Lt instanceof Lt)&&(Zt=!1)}return de.delete(v),de.delete(I),Zt}function Yi(v){return bs(v,Xo,dn)}function pi(v,I){var k=v.__data__;return yn(I)?k[typeof I=="string"?"string":"hash"]:k.map}function gr(v,I){var k=De(v,I);return Wo(k)?k:void 0}function pn(v){var I=Ue.call(v,Yt),k=v[Yt];try{v[Yt]=void 0;var Z=!0}catch{}var Be=Dt.call(v);return Z&&(I?v[Yt]=k:delete v[Yt]),Be}var dn=Qr?function(v){return v==null?[]:(v=Object(v),Ae(Qr(v),function(I){return sr.call(v,I)}))}:Ve,Vr=Ri;(lt&&Vr(new lt(new ArrayBuffer(1)))!=Te||tt&&Vr(new tt)!=B||ft&&Vr(ft.resolve())!=he||pt&&Vr(new pt)!=j||at&&Vr(new at)!=se)&&(Vr=function(v){var I=Ri(v),k=I==ue?v.constructor:void 0,Z=k?Zr(k):"";if(Z)switch(Z){case Ot:return Te;case Rt:return B;case dt:return he;case Tt:return j;case gt:return se}return I});function gn(v,I){return I=I??f,!!I&&(typeof v=="number"||Hr.test(v))&&v>-1&&v%1==0&&v<I}function yn(v){var I=typeof v;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?v!=="__proto__":v===null}function vn(v){return!!Pt&&Pt in v}function mn(v){var I=v&&v.constructor,k=typeof I=="function"&&I.prototype||$e;return v===k}function Qo(v){return Dt.call(v)}function Zr(v){if(v!=null){try{return ht.call(v)}catch{}try{return v+""}catch{}}return""}function wn(v,I){return v===I||v!==v&&I!==I}var bn=_s(function(){return arguments}())?_s:function(v){return Ni(v)&&Ue.call(v,"callee")&&!sr.call(v,"callee")},Zi=Array.isArray;function Yo(v){return v!=null&&_n(v.length)&&!Xi(v)}var Es=fi||ke;function Zo(v,I){return Ti(v,I)}function Xi(v){if(!En(v))return!1;var I=Ri(v);return I==U||I==$||I==g||I==fe}function _n(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=f}function En(v){var I=typeof v;return v!=null&&(I=="object"||I=="function")}function Ni(v){return v!=null&&typeof v=="object"}var In=we?mt(we):hn;function Xo(v){return Yo(v)?cn(v):ln(v)}function Ve(){return[]}function ke(){return!1}n.exports=Zo}(Gs,Gs.exports)),Gs.exports}var e1=X_();const t1=q.getDefaultExportFromCjs(e1);var r1=q.requireBrowser();const i1=q.getDefaultExportFromCjs(r1);var s1={};function n1(n,t){if(n.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var a=0;a<n.length;a++){var u=n.charAt(a),f=u.charCodeAt(0);if(r[f]!==255)throw new TypeError(u+" is ambiguous");r[f]=a}var y=n.length,w=n.charAt(0),g=Math.log(y)/Math.log(256),b=Math.log(256)/Math.log(y);function S($){if($ instanceof Uint8Array||(ArrayBuffer.isView($)?$=new Uint8Array($.buffer,$.byteOffset,$.byteLength):Array.isArray($)&&($=Uint8Array.from($))),!($ instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if($.length===0)return"";for(var B=0,ie=0,ye=0,ue=$.length;ye!==ue&&$[ye]===0;)ye++,B++;for(var he=(ue-ye)*b+1>>>0,fe=new Uint8Array(he);ye!==ue;){for(var pe=$[ye],j=0,K=he-1;(pe!==0||j<ie)&&K!==-1;K--,j++)pe+=256*fe[K]>>>0,fe[K]=pe%y>>>0,pe=pe/y>>>0;if(pe!==0)throw new Error("Non-zero carry");ie=j,ye++}for(var Q=he-ie;Q!==he&&fe[Q]===0;)Q++;for(var ve=w.repeat(B);Q<he;++Q)ve+=n.charAt(fe[Q]);return ve}function O($){if(typeof $!="string")throw new TypeError("Expected String");if($.length===0)return new Uint8Array;var B=0;if($[B]!==" "){for(var ie=0,ye=0;$[B]===w;)ie++,B++;for(var ue=($.length-B)*g+1>>>0,he=new Uint8Array(ue);$[B];){var fe=r[$.charCodeAt(B)];if(fe===255)return;for(var pe=0,j=ue-1;(fe!==0||pe<ye)&&j!==-1;j--,pe++)fe+=y*he[j]>>>0,he[j]=fe%256>>>0,fe=fe/256>>>0;if(fe!==0)throw new Error("Non-zero carry");ye=pe,B++}if($[B]!==" "){for(var K=ue-ye;K!==ue&&he[K]===0;)K++;for(var Q=new Uint8Array(ie+(ue-K)),ve=ie;K!==ue;)Q[ve++]=he[K++];return Q}}}function U($){var B=O($);if(B)return B;throw new Error(`Non-${t} character`)}return{encode:S,decodeUnsafe:O,decode:U}}var o1=n1,a1=o1;const Df=n=>{if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")},c1=n=>new TextEncoder().encode(n),u1=n=>new TextDecoder().decode(n);class h1{constructor(t,r,s){this.name=t,this.prefix=r,this.baseEncode=s}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class l1{constructor(t,r,s){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return qf(this,t)}}class f1{constructor(t){this.decoders=t}or(t){return qf(this,t)}decode(t){const r=t[0],s=this.decoders[r];if(s)return s.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const qf=(n,t)=>new f1({...n.decoders||{[n.prefix]:n},...t.decoders||{[t.prefix]:t}});class p1{constructor(t,r,s,a){this.name=t,this.prefix=r,this.baseEncode=s,this.baseDecode=a,this.encoder=new h1(t,r,s),this.decoder=new l1(t,r,a)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const No=({name:n,prefix:t,encode:r,decode:s})=>new p1(n,t,r,s),sn=({prefix:n,name:t,alphabet:r})=>{const{encode:s,decode:a}=a1(r,t);return No({prefix:n,name:t,encode:s,decode:u=>Df(a(u))})},d1=(n,t,r,s)=>{const a={};for(let b=0;b<t.length;++b)a[t[b]]=b;let u=n.length;for(;n[u-1]==="=";)--u;const f=new Uint8Array(u*r/8|0);let y=0,w=0,g=0;for(let b=0;b<u;++b){const S=a[n[b]];if(S===void 0)throw new SyntaxError(`Non-${s} character`);w=w<<r|S,y+=r,y>=8&&(y-=8,f[g++]=255&w>>y)}if(y>=r||255&w<<8-y)throw new SyntaxError("Unexpected end of data");return f},g1=(n,t,r)=>{const s=t[t.length-1]==="=",a=(1<<r)-1;let u="",f=0,y=0;for(let w=0;w<n.length;++w)for(y=y<<8|n[w],f+=8;f>r;)f-=r,u+=t[a&y>>f];if(f&&(u+=t[a&y<<r-f]),s)for(;u.length*r&7;)u+="=";return u},Ft=({name:n,prefix:t,bitsPerChar:r,alphabet:s})=>No({prefix:t,name:n,encode(a){return g1(a,s,r)},decode(a){return d1(a,s,r,n)}}),y1=No({prefix:"\0",name:"identity",encode:n=>u1(n),decode:n=>c1(n)});var v1=Object.freeze({__proto__:null,identity:y1});const m1=Ft({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var w1=Object.freeze({__proto__:null,base2:m1});const b1=Ft({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var _1=Object.freeze({__proto__:null,base8:b1});const E1=sn({prefix:"9",name:"base10",alphabet:"0123456789"});var I1=Object.freeze({__proto__:null,base10:E1});const x1=Ft({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),S1=Ft({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var P1=Object.freeze({__proto__:null,base16:x1,base16upper:S1});const O1=Ft({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),R1=Ft({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),T1=Ft({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),N1=Ft({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),A1=Ft({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),$1=Ft({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),C1=Ft({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),j1=Ft({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),D1=Ft({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var q1=Object.freeze({__proto__:null,base32:O1,base32upper:R1,base32pad:T1,base32padupper:N1,base32hex:A1,base32hexupper:$1,base32hexpad:C1,base32hexpadupper:j1,base32z:D1});const U1=sn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),M1=sn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var L1=Object.freeze({__proto__:null,base36:U1,base36upper:M1});const z1=sn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),k1=sn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var H1=Object.freeze({__proto__:null,base58btc:z1,base58flickr:k1});const K1=Ft({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),V1=Ft({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),B1=Ft({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),F1=Ft({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var G1=Object.freeze({__proto__:null,base64:K1,base64pad:V1,base64url:B1,base64urlpad:F1});const Uf=Array.from(""),W1=Uf.reduce((n,t,r)=>(n[r]=t,n),[]),J1=Uf.reduce((n,t,r)=>(n[t.codePointAt(0)]=r,n),[]);function Q1(n){return n.reduce((t,r)=>(t+=W1[r],t),"")}function Y1(n){const t=[];for(const r of n){const s=J1[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(s)}return new Uint8Array(t)}const Z1=No({prefix:"",name:"base256emoji",encode:Q1,decode:Y1});var X1=Object.freeze({__proto__:null,base256emoji:Z1}),eE=Mf,Cl=128,tE=127,rE=~tE,iE=Math.pow(2,31);function Mf(n,t,r){t=t||[],r=r||0;for(var s=r;n>=iE;)t[r++]=n&255|Cl,n/=128;for(;n&rE;)t[r++]=n&255|Cl,n>>>=7;return t[r]=n|0,Mf.bytes=r-s+1,t}var sE=jc,nE=128,jl=127;function jc(n,s){var r=0,s=s||0,a=0,u=s,f,y=n.length;do{if(u>=y)throw jc.bytes=0,new RangeError("Could not decode varint");f=n[u++],r+=a<28?(f&jl)<<a:(f&jl)*Math.pow(2,a),a+=7}while(f>=nE);return jc.bytes=u-s,r}var oE=Math.pow(2,7),aE=Math.pow(2,14),cE=Math.pow(2,21),uE=Math.pow(2,28),hE=Math.pow(2,35),lE=Math.pow(2,42),fE=Math.pow(2,49),pE=Math.pow(2,56),dE=Math.pow(2,63),gE=function(n){return n<oE?1:n<aE?2:n<cE?3:n<uE?4:n<hE?5:n<lE?6:n<fE?7:n<pE?8:n<dE?9:10},yE={encode:eE,decode:sE,encodingLength:gE},Lf=yE;const Dl=(n,t,r=0)=>(Lf.encode(n,t,r),t),ql=n=>Lf.encodingLength(n),Dc=(n,t)=>{const r=t.byteLength,s=ql(n),a=s+ql(r),u=new Uint8Array(a+r);return Dl(n,u,0),Dl(r,u,s),u.set(t,a),new vE(n,r,t,u)};class vE{constructor(t,r,s,a){this.code=t,this.size=r,this.digest=s,this.bytes=a}}const zf=({name:n,code:t,encode:r})=>new mE(n,t,r);class mE{constructor(t,r,s){this.name=t,this.code=r,this.encode=s}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Dc(this.code,r):r.then(s=>Dc(this.code,s))}else throw Error("Unknown type, must be binary type")}}const kf=n=>async t=>new Uint8Array(await crypto.subtle.digest(n,t)),wE=zf({name:"sha2-256",code:18,encode:kf("SHA-256")}),bE=zf({name:"sha2-512",code:19,encode:kf("SHA-512")});var _E=Object.freeze({__proto__:null,sha256:wE,sha512:bE});const Hf=0,EE="identity",Kf=Df,IE=n=>Dc(Hf,Kf(n)),xE={code:Hf,name:EE,encode:Kf,digest:IE};var SE=Object.freeze({__proto__:null,identity:xE});new TextEncoder,new TextDecoder;const Ul={...v1,...w1,..._1,...I1,...P1,...q1,...L1,...H1,...G1,...X1};({..._E,...SE});function Vf(n){return globalThis.Buffer!=null?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function PE(n=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Vf(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}function Bf(n,t,r,s){return{name:n,prefix:t,encoder:{name:n,prefix:t,encode:r},decoder:{decode:s}}}const Ml=Bf("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),yc=Bf("ascii","a",n=>{let t="a";for(let r=0;r<n.length;r++)t+=String.fromCharCode(n[r]);return t},n=>{n=n.substring(1);const t=PE(n.length);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}),OE={utf8:Ml,"utf-8":Ml,hex:Ul.base16,latin1:yc,ascii:yc,binary:yc,...Ul};function RE(n,t="utf8"){const r=OE[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Vf(globalThis.Buffer.from(n,"utf-8")):r.decoder.decode(`${r.prefix}${n}`)}const Ff="wc",TE=2,Gc="core",xi=`${Ff}@2:${Gc}:`,NE={name:Gc,logger:"error"},AE={database:":memory:"},$E="crypto",Ll="client_ed25519_seed",CE=q.cjsExports.ONE_DAY,jE="keychain",DE="0.3",qE="messages",UE="0.3",ME=q.cjsExports.SIX_HOURS,LE="publisher",Gf="irn",zE="error",Wf="wss://relay.walletconnect.com",zl="wss://relay.walletconnect.org",kE="relayer",Jt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},HE="_subscription",ci={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},KE=q.cjsExports.ONE_SECOND,VE="2.11.0",BE=1e4,FE="0.3",GE="WALLETCONNECT_CLIENT_ID",Lr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},WE="subscription",JE="0.3",QE=q.cjsExports.FIVE_SECONDS*1e3,YE="pairing",ZE="0.3",ks={wc_pairingDelete:{req:{ttl:q.cjsExports.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:q.cjsExports.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:q.cjsExports.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:q.cjsExports.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:q.cjsExports.ONE_DAY,prompt:!1,tag:0},res:{ttl:q.cjsExports.ONE_DAY,prompt:!1,tag:0}}},Ws={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Jr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},XE="history",eI="0.3",tI="expirer",Ar={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},rI="0.3",vc="verify-api",ds="https://verify.walletconnect.com",qc="https://verify.walletconnect.org",iI=[ds,qc],sI="echo",nI="https://echo.walletconnect.com";class oI{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=jE,this.version=DE,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,a)=>{this.isInitialized(),this.keychain.set(s,a),await this.persist()},this.get=s=>{this.isInitialized();const a=this.keychain.get(s);if(typeof a>"u"){const{message:u}=W("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(u)}return a},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=t,this.logger=dr(r,this.name)}get context(){return pr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,Tf(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Nf(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=W("NOT_INITIALIZED",this.name);throw new Error(t)}}}class aI{constructor(t,r,s){this.core=t,this.logger=r,this.name=$E,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),u=dl(a);return _f(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=D0();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const u=await this.getClientSeed(),f=dl(u),y=$c();return await A0(y,a,CE,f)},this.generateSharedKey=(a,u,f)=>{this.isInitialized();const y=this.getPrivateKey(a),w=q0(y,u);return this.setSymKey(w,f)},this.setSymKey=async(a,u)=>{this.isInitialized();const f=u||U0(a);return await this.keychain.set(f,a),f},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,u,f)=>{this.isInitialized();const y=Rf(f),w=ee.safeJsonStringify(u);if(ml(y)){const O=y.senderPublicKey,U=y.receiverPublicKey;a=await this.generateSharedKey(O,U)}const g=this.getSymKey(a),{type:b,senderPublicKey:S}=y;return L0({type:b,symKey:g,message:w,senderPublicKey:S})},this.decode=async(a,u,f)=>{this.isInitialized();const y=H0(u,f);if(ml(y)){const w=y.receiverPublicKey,g=y.senderPublicKey;a=await this.generateSharedKey(w,g)}try{const w=this.getSymKey(a),g=z0({symKey:w,encoded:u});return ee.safeJsonParse(g)}catch(w){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(w)}},this.getPayloadType=a=>{const u=Eo(a);return tn(u.type)},this.getPayloadSenderPublicKey=a=>{const u=Eo(a);return u.senderPublicKey?$r(u.senderPublicKey,ir):void 0},this.core=t,this.logger=dr(r,this.name),this.keychain=s||new oI(this.core,this.logger)}get context(){return pr(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(Ll)}catch{t=$c(),await this.keychain.set(Ll,t)}return RE(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=W("NOT_INITIALIZED",this.name);throw new Error(t)}}}class cI extends n0{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=qE,this.version=UE,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,a)=>{this.isInitialized();const u=gs(a);let f=this.messages.get(s);return typeof f>"u"&&(f={}),typeof f[u]<"u"||(f[u]=a,this.messages.set(s,f),await this.persist()),u},this.get=s=>{this.isInitialized();let a=this.messages.get(s);return typeof a>"u"&&(a={}),a},this.has=(s,a)=>{this.isInitialized();const u=this.get(s),f=gs(a);return typeof u[f]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=dr(t,this.name),this.core=r}get context(){return pr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,Tf(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Nf(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=W("NOT_INITIALIZED",this.name);throw new Error(t)}}}class uI extends o0{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new q.eventsExports.EventEmitter,this.name=LE,this.queue=new Map,this.publishTimeout=q.cjsExports.toMiliseconds(q.cjsExports.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,a,u)=>{var f;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}});try{const y=(u==null?void 0:u.ttl)||ME,w=Cc(u),g=(u==null?void 0:u.prompt)||!1,b=(u==null?void 0:u.tag)||0,S=(u==null?void 0:u.id)||ee.getBigIntRpcId().toString(),O={topic:s,message:a,opts:{ttl:y,relay:w,prompt:g,tag:b,id:S}},U=setTimeout(()=>this.queue.set(S,O),this.publishTimeout);try{await await Ys(this.rpcPublish(s,a,y,w,g,b,S),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(S),this.relayer.events.emit(Jt.publish,O)}catch($){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(f=u==null?void 0:u.internal)!=null&&f.throwOnFailedPublish)throw this.removeRequestFromQueue(S),$;return}finally{clearTimeout(U)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}})}catch(y){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(y),y}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.relayer=t,this.logger=dr(r,this.name),this.registerEventListeners()}get context(){return pr(this.logger)}rpcPublish(t,r,s,a,u,f,y){var w,g,b,S;const O={method:mo(a.protocol).publish,params:{topic:t,message:r,ttl:s,prompt:u,tag:f},id:y};return rr((w=O.params)==null?void 0:w.prompt)&&((g=O.params)==null||delete g.prompt),rr((b=O.params)==null?void 0:b.tag)&&((S=O.params)==null||delete S.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:O}),this.relayer.request(O)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:s,opts:a}=t;await this.publish(r,s,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(Xs.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Jt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Jt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class hI{constructor(){this.map=new Map,this.set=(t,r)=>{const s=this.get(t);this.exists(t,r)||this.map.set(t,[...s,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const s=this.get(t);if(!this.exists(t,r))return;const a=s.filter(u=>u!==r);if(!a.length){this.map.delete(t);return}this.map.set(t,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var lI=Object.defineProperty,fI=Object.defineProperties,pI=Object.getOwnPropertyDescriptors,kl=Object.getOwnPropertySymbols,dI=Object.prototype.hasOwnProperty,gI=Object.prototype.propertyIsEnumerable,Hl=(n,t,r)=>t in n?lI(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Hs=(n,t)=>{for(var r in t||(t={}))dI.call(t,r)&&Hl(n,r,t[r]);if(kl)for(var r of kl(t))gI.call(t,r)&&Hl(n,r,t[r]);return n},mc=(n,t)=>fI(n,pI(t));class yI extends u0{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new hI,this.events=new q.eventsExports.EventEmitter,this.name=WE,this.version=JE,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=xi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}});try{const u=Cc(a),f={topic:s,relay:u};this.pending.set(s,f);const y=await this.rpcSubscribe(s,u);return this.onSubscribe(y,f),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}}),y}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(s,a.id,a):await this.unsubscribeByTopic(s,a)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((a,u)=>{const f=new q.cjsExports.Watch;f.start(this.pendingSubscriptionWatchLabel);const y=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(y),f.stop(this.pendingSubscriptionWatchLabel),a(!0)),f.elapsed(this.pendingSubscriptionWatchLabel)>=QE&&(clearInterval(y),f.stop(this.pendingSubscriptionWatchLabel),u(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=dr(r,this.name),this.clientId=""}get context(){return pr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let s=!1;try{s=this.getSubscription(t).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const s=this.topicMap.get(t);await Promise.all(s.map(async a=>await this.unsubscribeById(t,a,r)))}async unsubscribeById(t,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}});try{const a=Cc(s);await this.rpcUnsubscribe(t,r,a);const u=It("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(t,r){const s={method:mo(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await Ys(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Jt.connection_stalled)}return gs(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,s={method:mo(r.protocol).batchSubscribe,params:{topics:t.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await Ys(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Jt.connection_stalled)}}rpcUnsubscribe(t,r,s){const a={method:mo(s.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(t,r){this.setSubscription(t,mc(Hs({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Hs({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,s),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Hs({},r)),this.topicMap.set(r.topic,t),this.events.emit(Lr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:s}=W("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const s=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(s.topic,t),this.events.emit(Lr.deleted,mc(Hs({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Lr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Lr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);Hi(r)&&this.onBatchSubscribe(r.map((s,a)=>mc(Hs({},t[a]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(Xs.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Jt.connect,async()=>{await this.onConnect()}),this.relayer.on(Jt.disconnect,()=>{this.onDisconnect()}),this.events.on(Lr.created,async t=>{const r=Lr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(Lr.deleted,async t=>{const r=Lr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=W("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var vI=Object.defineProperty,Kl=Object.getOwnPropertySymbols,mI=Object.prototype.hasOwnProperty,wI=Object.prototype.propertyIsEnumerable,Vl=(n,t,r)=>t in n?vI(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,bI=(n,t)=>{for(var r in t)mI.call(t,r)&&Vl(n,r,t[r]);if(Kl)for(var r of Kl(t))wI.call(t,r)&&Vl(n,r,t[r]);return n};class _I extends a0{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new q.eventsExports.EventEmitter,this.name=kE,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Jt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Jt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ci.payload,this.onPayloadHandler),this.provider.on(ci.connect,this.onConnectHandler),this.provider.on(ci.disconnect,this.onDisconnectHandler),this.provider.on(ci.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?dr(t.logger,this.name):Ro(To({level:t.logger||zE})),this.messages=new cI(this.logger,t.core),this.subscriber=new yI(this,this.logger),this.publisher=new uI(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||Wf,this.projectId=t.projectId,this.bundleId=W0(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${zl}...`),await this.restartTransport(zl)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},BE)}get context(){return pr(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,s){this.isInitialized(),await this.publisher.publish(t,r,s),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var s;this.isInitialized();let a=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"";if(a)return a;let u;const f=y=>{y.topic===t&&(this.subscriber.off(Lr.created,f),u())};return await Promise.all([new Promise(y=>{u=y,this.subscriber.on(Lr.created,f)}),new Promise(async y=>{a=await this.subscriber.subscribe(t,r),y()})]),a}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Ys(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(Lr.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await Ys(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){s(a);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(ci.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Tl())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new hi(new Z_(e_({sdkVersion:VE,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:s}=t;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(t){const{topic:r,message:s}=t;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,s);return a&&this.logger.debug(`Ignoring duplicate message: ${s}`),a}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),ee.isJsonRpcRequest(t)){if(!t.method.endsWith(HE))return;const r=t.params,{topic:s,message:a,publishedAt:u}=r.data,f={topic:s,message:a,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(bI({type:"event",event:r.id},f)),this.events.emit(r.id,f),await this.acknowledgePayload(t),await this.onMessageEvent(f)}else ee.isJsonRpcResponse(t)&&this.events.emit(Jt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Jt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=ee.formatJsonRpcResult(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ci.payload,this.onPayloadHandler),this.provider.off(ci.connect,this.onConnectHandler),this.provider.off(ci.disconnect,this.onDisconnectHandler),this.provider.off(ci.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Jt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Tl();F_(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Jt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},q.cjsExports.toMiliseconds(KE)))}isInitialized(){if(!this.initialized){const{message:t}=W("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var EI=Object.defineProperty,Bl=Object.getOwnPropertySymbols,II=Object.prototype.hasOwnProperty,xI=Object.prototype.propertyIsEnumerable,Fl=(n,t,r)=>t in n?EI(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Gl=(n,t)=>{for(var r in t||(t={}))II.call(t,r)&&Fl(n,r,t[r]);if(Bl)for(var r of Bl(t))xI.call(t,r)&&Fl(n,r,t[r]);return n};class Ao extends c0{constructor(t,r,s,a=xi,u=void 0){super(t,r,s,a),this.core=t,this.logger=r,this.name=s,this.map=new Map,this.version=FE,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(f=>{this.getKey&&f!==null&&!rr(f)?this.map.set(this.getKey(f),f):I_(f)?this.map.set(f.id,f):x_(f)&&this.map.set(f.topic,f)}),this.cached=[],this.initialized=!0)},this.set=async(f,y)=>{this.isInitialized(),this.map.has(f)?await this.update(f,y):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:f,value:y}),this.map.set(f,y),await this.persist())},this.get=f=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:f}),this.getData(f)),this.getAll=f=>(this.isInitialized(),f?this.values.filter(y=>Object.keys(f).every(w=>t1(y[w],f[w]))):this.values),this.update=async(f,y)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:f,update:y});const w=Gl(Gl({},this.getData(f)),y);this.map.set(f,w),await this.persist()},this.delete=async(f,y)=>{this.isInitialized(),this.map.has(f)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:f,reason:y}),this.map.delete(f),await this.persist())},this.logger=dr(r,this.name),this.storagePrefix=a,this.getKey=u}get context(){return pr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:s}=W("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=W("NOT_INITIALIZED",this.name);throw new Error(t)}}}class SI{constructor(t,r){this.core=t,this.logger=r,this.name=YE,this.version=ZE,this.events=new q.ss,this.initialized=!1,this.storagePrefix=xi,this.ignoredPayloadTypes=[Bi],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=$c(),a=await this.core.crypto.setSymKey(s),u=zr(q.cjsExports.FIVE_MINUTES),f={protocol:Gf},y={topic:a,expiry:u,relay:f,active:!1},w=p_({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:s,relay:f});return await this.pairings.set(a,y),await this.core.relayer.subscribe(a),this.core.expirer.set(a,u),{topic:a,uri:w}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:a,symKey:u,relay:f}=xl(s.uri);let y;if(this.pairings.keys.includes(a)&&(y=this.pairings.get(a),y.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const w=zr(q.cjsExports.FIVE_MINUTES),g={topic:a,relay:f,expiry:w,active:!1};return await this.pairings.set(a,g),this.core.expirer.set(a,w),s.activatePairing&&await this.activate({topic:a}),this.events.emit(Ws.create,g),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(u,a),await this.core.relayer.subscribe(a,{relay:f})),g},this.activate=async({topic:s})=>{this.isInitialized();const a=zr(q.cjsExports.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:a}),this.core.expirer.set(s,a)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:a}=s;if(this.pairings.keys.includes(a)){const u=await this.sendRequest(a,"wc_pairingPing",{}),{done:f,resolve:y,reject:w}=ps();this.events.once(jt("pairing_ping",u),({error:g})=>{g?w(g):y()}),await f()}},this.updateExpiry=async({topic:s,expiry:a})=>{this.isInitialized(),await this.pairings.update(s,{expiry:a})},this.updateMetadata=async({topic:s,metadata:a})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:a}=s;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",It("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(s,a,u)=>{const f=ee.formatJsonRpcRequest(a,u),y=await this.core.crypto.encode(s,f),w=ks[a].req;return this.core.history.set(s,f),this.core.relayer.publish(s,y,w),f.id},this.sendResult=async(s,a,u)=>{const f=ee.formatJsonRpcResult(s,u),y=await this.core.crypto.encode(a,f),w=await this.core.history.get(a,s),g=ks[w.request.method].res;await this.core.relayer.publish(a,y,g),await this.core.history.resolve(f)},this.sendError=async(s,a,u)=>{const f=ee.formatJsonRpcError(s,u),y=await this.core.crypto.encode(a,f),w=await this.core.history.get(a,s),g=ks[w.request.method]?ks[w.request.method].res:ks.unregistered_method.res;await this.core.relayer.publish(a,y,g),await this.core.history.resolve(f)},this.deletePairing=async(s,a)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,It("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),a?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(a=>Ii(a.expiry));await Promise.all(s.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=s=>{const{topic:a,payload:u}=s;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(a,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,u);default:return this.onUnknownRpcMethodRequest(a,u)}},this.onRelayEventResponse=async s=>{const{topic:a,payload:u}=s,f=(await this.core.history.get(a,u.id)).request.method;switch(f){case"wc_pairingPing":return this.onPairingPingResponse(a,u);default:return this.onUnknownRpcMethodResponse(f)}},this.onPairingPingRequest=async(s,a)=>{const{id:u}=a;try{this.isValidPing({topic:s}),await this.sendResult(u,s,!0),this.events.emit(Ws.ping,{id:u,topic:s})}catch(f){await this.sendError(u,s,f),this.logger.error(f)}},this.onPairingPingResponse=(s,a)=>{const{id:u}=a;setTimeout(()=>{ee.isJsonRpcResult(a)?this.events.emit(jt("pairing_ping",u),{}):ee.isJsonRpcError(a)&&this.events.emit(jt("pairing_ping",u),{error:a.error})},500)},this.onPairingDeleteRequest=async(s,a)=>{const{id:u}=a;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(Ws.delete,{id:u,topic:s})}catch(f){await this.sendError(u,s,f),this.logger.error(f)}},this.onUnknownRpcMethodRequest=async(s,a)=>{const{id:u,method:f}=a;try{if(this.registeredMethods.includes(f))return;const y=It("WC_METHOD_UNSUPPORTED",f);await this.sendError(u,s,y),this.logger.error(y)}catch(y){await this.sendError(u,s,y),this.logger.error(y)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(It("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var a;if(!fr(s)){const{message:f}=W("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(f)}if(!E_(s.uri)){const{message:f}=W("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(f)}const u=xl(s.uri);if(!((a=u==null?void 0:u.relay)!=null&&a.protocol)){const{message:f}=W("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(f)}if(!(u!=null&&u.symKey)){const{message:f}=W("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(f)}},this.isValidPing=async s=>{if(!fr(s)){const{message:u}=W("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidDisconnect=async s=>{if(!fr(s)){const{message:u}=W("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async s=>{if(!Ht(s,!1)){const{message:a}=W("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(a)}if(!this.pairings.keys.includes(s)){const{message:a}=W("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(a)}if(Ii(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:a}=W("EXPIRED",`pairing topic: ${s}`);throw new Error(a)}},this.core=t,this.logger=dr(r,this.name),this.pairings=new Ao(this.core,this.logger,this.name,this.storagePrefix)}get context(){return pr(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=W("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Jt.message,async t=>{const{topic:r,message:s}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const a=await this.core.crypto.decode(r,s);try{ee.isJsonRpcRequest(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):ee.isJsonRpcResponse(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(u){this.logger.error(u)}})}registerExpirerEvents(){this.core.expirer.on(Ar.expired,async t=>{const{topic:r}=$f(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Ws.expire,{topic:r}))})}}class PI extends s0{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new q.eventsExports.EventEmitter,this.name=XE,this.version=eI,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,a,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:a,chainId:u}),this.records.has(a.id))return;const f={id:a.id,topic:s,request:{method:a.method,params:a.params||null},chainId:u,expiry:zr(q.cjsExports.THIRTY_DAYS)};this.records.set(f.id,f),this.events.emit(Jr.created,f)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const a=await this.getRecord(s.id);typeof a.response>"u"&&(a.response=ee.isJsonRpcError(s)?{error:s.error}:{result:s.result},this.records.set(a.id,a),this.events.emit(Jr.updated,a))},this.get=async(s,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:a}),await this.getRecord(a)),this.delete=(s,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(u=>{if(u.topic===s){if(typeof a<"u"&&u.id!==a)return;this.records.delete(u.id),this.events.emit(Jr.deleted,u)}})},this.exists=async(s,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===s:!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=dr(r,this.name)}get context(){return pr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:ee.formatJsonRpcRequest(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(s)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:s}=W("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Jr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Jr.created,t=>{const r=Jr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Jr.updated,t=>{const r=Jr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Jr.deleted,t=>{const r=Jr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(Xs.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{q.cjsExports.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=W("NOT_INITIALIZED",this.name);throw new Error(t)}}}class OI extends h0{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new q.eventsExports.EventEmitter,this.name=tI,this.version=rI,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const a=this.formatTarget(s);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(s,a)=>{this.isInitialized();const u=this.formatTarget(s),f={target:u,expiry:a};this.expirations.set(u,f),this.checkExpiry(u,f),this.events.emit(Ar.created,{target:u,expiration:f})},this.get=s=>{this.isInitialized();const a=this.formatTarget(s);return this.getExpiration(a)},this.del=s=>{if(this.isInitialized(),this.has(s)){const a=this.formatTarget(s),u=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Ar.deleted,{target:a,expiration:u})}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=dr(r,this.name)}get context(){return pr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return t_(t);if(typeof t=="number")return r_(t);const{message:r}=W("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ar.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:s}=W("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(t,r){const{expiry:s}=r;q.cjsExports.toMiliseconds(s)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Ar.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(Xs.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Ar.created,t=>{const r=Ar.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Ar.expired,t=>{const r=Ar.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Ar.deleted,t=>{const r=Ar.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=W("NOT_INITIALIZED",this.name);throw new Error(t)}}}class RI extends l0{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=vc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||vs()||!ms())return;const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u)}if(!this.initialized){this.removeIframe(),this.verifyUrl=qc;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let u;try{u=await this.fetchAttestation(s.attestationId,a)}catch(f){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${a}`),this.logger.info(f),u=await this.fetchAttestation(s.attestationId,qc)}return u},this.fetchAttestation=async(s,a)=>{this.logger.info(`resolving attestation: ${s} from url: ${a}`);const u=this.startAbortTimer(q.cjsExports.ONE_SECOND*2),f=await fetch(`${a}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(u),f.status===200?await f.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const a=u=>{u.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),s())};await Promise.race([new Promise(u=>{if(document.getElementById(vc))return u();window.addEventListener("message",a);const f=document.createElement("iframe");f.id=vc,f.src=`${this.verifyUrl}/${this.projectId}`,f.style.display="none",document.body.append(f),this.iframe=f,s=u}),new Promise((u,f)=>setTimeout(()=>{window.removeEventListener("message",a),f("verify iframe load timeout")},q.cjsExports.toMiliseconds(q.cjsExports.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let a=s||ds;return iI.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${ds}`),a=ds),a},this.logger=dr(r,this.name),this.verifyUrl=ds,this.abortController=new AbortController,this.isDevEnv=Vc()&&s1.IS_VITEST}get context(){return pr(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),q.cjsExports.toMiliseconds(t))}}class TI extends f0{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.context=sI,this.registerDeviceToken=async s=>{const{clientId:a,token:u,notificationType:f,enableEncrypted:y=!1}=s,w=`${nI}/${this.projectId}/clients`;await i1(w,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:f,token:u,always_raw:y})})},this.logger=dr(r,this.context)}}var NI=Object.defineProperty,Wl=Object.getOwnPropertySymbols,AI=Object.prototype.hasOwnProperty,$I=Object.prototype.propertyIsEnumerable,Jl=(n,t,r)=>t in n?NI(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Ql=(n,t)=>{for(var r in t||(t={}))AI.call(t,r)&&Jl(n,r,t[r]);if(Wl)for(var r of Wl(t))$I.call(t,r)&&Jl(n,r,t[r]);return n};class Wc extends i0{constructor(t){super(t),this.protocol=Ff,this.version=TE,this.name=Gc,this.events=new q.eventsExports.EventEmitter,this.initialized=!1,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||Wf,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ro(To({level:(t==null?void 0:t.logger)||NE.logger}));this.logger=dr(r,this.name),this.heartbeat=new Xs.HeartBeat,this.crypto=new aI(this,this.logger,t==null?void 0:t.keychain),this.history=new PI(this,this.logger),this.expirer=new OI(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new yb(Ql(Ql({},AE),t==null?void 0:t.storageOptions)),this.relayer=new _I({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new SI(this,this.logger),this.verify=new RI(this.projectId||"",this.logger),this.echoClient=new TI(this.projectId||"",this.logger)}static async init(t){const r=new Wc(t);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(GE,s),r}get context(){return pr(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const CI=Wc,Jf="wc",Qf=2,Yf="client",Jc=`${Jf}@${Qf}:${Yf}:`,wc={name:Yf,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Yl="WALLETCONNECT_DEEPLINK_CHOICE",jI="proposal",Zf="Proposal expired",DI="session",fo=q.cjsExports.SEVEN_DAYS,qI="engine",Ks={wc_sessionPropose:{req:{ttl:q.cjsExports.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:q.cjsExports.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:q.cjsExports.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:q.cjsExports.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:q.cjsExports.ONE_DAY,prompt:!1,tag:1104},res:{ttl:q.cjsExports.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:q.cjsExports.ONE_DAY,prompt:!1,tag:1106},res:{ttl:q.cjsExports.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:q.cjsExports.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:q.cjsExports.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:q.cjsExports.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:q.cjsExports.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:q.cjsExports.ONE_DAY,prompt:!1,tag:1112},res:{ttl:q.cjsExports.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:q.cjsExports.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:q.cjsExports.THIRTY_SECONDS,prompt:!1,tag:1115}}},bc={min:q.cjsExports.FIVE_MINUTES,max:q.cjsExports.SEVEN_DAYS},ui={idle:"IDLE",active:"ACTIVE"},UI="request",MI=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var LI=Object.defineProperty,zI=Object.defineProperties,kI=Object.getOwnPropertyDescriptors,Zl=Object.getOwnPropertySymbols,HI=Object.prototype.hasOwnProperty,KI=Object.prototype.propertyIsEnumerable,Xl=(n,t,r)=>t in n?LI(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,hr=(n,t)=>{for(var r in t||(t={}))HI.call(t,r)&&Xl(n,r,t[r]);if(Zl)for(var r of Zl(t))KI.call(t,r)&&Xl(n,r,t[r]);return n},Vs=(n,t)=>zI(n,kI(t));class VI extends d0{constructor(t){super(t),this.name=qI,this.events=new q.ss,this.initialized=!1,this.ignoredPayloadTypes=[Bi],this.requestQueue={state:ui.idle,queue:[]},this.sessionRequestQueue={state:ui.idle,queue:[]},this.requestQueueDelay=q.cjsExports.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Ks)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},q.cjsExports.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=Vs(hr({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:a,requiredNamespaces:u,optionalNamespaces:f,sessionProperties:y,relays:w}=s;let g=a,b,S=!1;if(g&&(S=this.client.core.pairing.pairings.get(g).active),!g||!S){const{topic:he,uri:fe}=await this.client.core.pairing.create();g=he,b=fe}const O=await this.client.core.crypto.generateKeyPair(),U=hr({requiredNamespaces:u,optionalNamespaces:f,relays:w??[{protocol:Gf}],proposer:{publicKey:O,metadata:this.client.metadata}},y&&{sessionProperties:y}),{reject:$,resolve:B,done:ie}=ps(q.cjsExports.FIVE_MINUTES,Zf);if(this.events.once(jt("session_connect"),async({error:he,session:fe})=>{if(he)$(he);else if(fe){fe.self.publicKey=O;const pe=Vs(hr({},fe),{requiredNamespaces:fe.requiredNamespaces,optionalNamespaces:fe.optionalNamespaces});await this.client.session.set(fe.topic,pe),await this.setExpiry(fe.topic,fe.expiry),g&&await this.client.core.pairing.updateMetadata({topic:g,metadata:fe.peer.metadata}),B(pe)}}),!g){const{message:he}=W("NO_MATCHING_KEY",`connect() pairing topic: ${g}`);throw new Error(he)}const ye=await this.sendRequest({topic:g,method:"wc_sessionPropose",params:U}),ue=zr(q.cjsExports.FIVE_MINUTES);return await this.setProposal(ye,hr({id:ye,expiry:ue},U)),{uri:b,approval:ie}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:a,namespaces:u,sessionProperties:f}=r,y=this.client.proposal.get(s);let{pairingTopic:w,proposer:g,requiredNamespaces:b,optionalNamespaces:S}=y;w=w||"",ys(b)||(b=v_(u,"approve()"));const O=await this.client.core.crypto.generateKeyPair(),U=g.publicKey,$=await this.client.core.crypto.generateSharedKey(O,U);w&&s&&(await this.client.core.pairing.updateMetadata({topic:w,metadata:g.metadata}),await this.sendResult({id:s,topic:w,result:{relay:{protocol:a??"irn"},responderPublicKey:O}}),await this.client.proposal.delete(s,It("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}));const B=hr({relay:{protocol:a??"irn"},namespaces:u,requiredNamespaces:b,optionalNamespaces:S,pairingTopic:w,controller:{publicKey:O,metadata:this.client.metadata},expiry:zr(fo)},f&&{sessionProperties:f});await this.client.core.relayer.subscribe($),await this.sendRequest({topic:$,method:"wc_sessionSettle",params:B,throwOnFailedPublish:!0});const ie=Vs(hr({},B),{topic:$,pairingTopic:w,acknowledged:!1,self:B.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:O});return await this.client.session.set($,ie),await this.setExpiry($,zr(fo)),{topic:$,acknowledged:()=>new Promise(ye=>setTimeout(()=>ye(this.client.session.get($)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:a}=r,{pairingTopic:u}=this.client.proposal.get(s);u&&(await this.sendError(s,u,a),await this.client.proposal.delete(s,It("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:a}=r,u=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:f,resolve:y,reject:w}=ps();return this.events.once(jt("session_update",u),({error:g})=>{g?w(g):y()}),await this.client.session.update(s,{namespaces:a}),{acknowledged:f}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,a=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:u,resolve:f,reject:y}=ps();return this.events.once(jt("session_extend",a),({error:w})=>{w?y(w):f()}),await this.setExpiry(s,zr(fo)),{acknowledged:u}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:a,topic:u,expiry:f}=r,y=ee.payloadId(),{done:w,resolve:g,reject:b}=ps(f,"Request expired. Please try again.");return this.events.once(jt("session_request",y),({error:S,result:O})=>{S?b(S):g(O)}),await Promise.all([new Promise(async S=>{await this.sendRequest({clientRpcId:y,topic:u,method:"wc_sessionRequest",params:{request:a,chainId:s},expiry:f,throwOnFailedPublish:!0}).catch(O=>b(O)),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:s,id:y}),S()}),new Promise(async S=>{const O=await s_(this.client.core.storage,Yl);i_({id:y,topic:u,wcDeepLink:O}),S()}),w()]).then(S=>S[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:a}=r,{id:u}=a;ee.isJsonRpcResult(a)?await this.sendResult({id:u,topic:s,result:a.result,throwOnFailedPublish:!0}):ee.isJsonRpcError(a)&&await this.sendError(u,s,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const a=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:u,resolve:f,reject:y}=ps();this.events.once(jt("session_ping",a),({error:w})=>{w?y(w):f()}),await u()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:a,chainId:u}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:a,chainId:u}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:It("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>b_(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(u=>{var f,y;return((f=u.peerMetadata)==null?void 0:f.url)&&((y=u.peerMetadata)==null?void 0:y.url)===r.peer.metadata.url&&u.topic&&u.topic!==s.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,It("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Yl).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===r&&this.deletePendingSessionRequest(u.id,It("USER_DISCONNECTED"))})},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,It("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(u=>u.id!==r),a&&(this.sessionRequestQueue.state=ui.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=Ks.wc_sessionRequest.req.ttl,{id:a,topic:u,params:f,verifyContext:y}=r;await this.client.pendingRequest.set(a,{id:a,topic:u,params:f,verifyContext:y}),s&&this.client.core.expirer.set(a,zr(s))},this.sendRequest=async r=>{const{topic:s,method:a,params:u,expiry:f,relayRpcId:y,clientRpcId:w,throwOnFailedPublish:g}=r,b=ee.formatJsonRpcRequest(a,u,w);if(ms()&&MI.includes(a)){const U=gs(JSON.stringify(b));this.client.core.verify.register({attestationId:U})}const S=await this.client.core.crypto.encode(s,b),O=Ks[a].req;return f&&(O.ttl=f),y&&(O.id=y),this.client.core.history.set(s,b),g?(O.internal=Vs(hr({},O.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,S,O)):this.client.core.relayer.publish(s,S,O).catch(U=>this.client.logger.error(U)),b.id},this.sendResult=async r=>{const{id:s,topic:a,result:u,throwOnFailedPublish:f}=r,y=ee.formatJsonRpcResult(s,u),w=await this.client.core.crypto.encode(a,y),g=await this.client.core.history.get(a,s),b=Ks[g.request.method].res;f?(b.internal=Vs(hr({},b.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,w,b)):this.client.core.relayer.publish(a,w,b).catch(S=>this.client.logger.error(S)),await this.client.core.history.resolve(y)},this.sendError=async(r,s,a)=>{const u=ee.formatJsonRpcError(r,a),f=await this.client.core.crypto.encode(s,u),y=await this.client.core.history.get(s,r),w=Ks[y.request.method].res;this.client.core.relayer.publish(s,f,w),await this.client.core.history.resolve(u)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(a=>{Ii(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{Ii(a.expiry)&&s.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...s.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===ui.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ui.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=ui.idle},this.processRequest=r=>{const{topic:s,payload:a}=r,u=a.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(s,a);case"wc_sessionSettle":return this.onSessionSettleRequest(s,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,a);case"wc_sessionExtend":return this.onSessionExtendRequest(s,a);case"wc_sessionPing":return this.onSessionPingRequest(s,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,a);case"wc_sessionRequest":return this.onSessionRequest(s,a);case"wc_sessionEvent":return this.onSessionEventRequest(s,a);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:a}=r,u=(await this.client.core.history.get(s,a.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(s,a);case"wc_sessionSettle":return this.onSessionSettleResponse(s,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,a);case"wc_sessionExtend":return this.onSessionExtendResponse(s,a);case"wc_sessionPing":return this.onSessionPingResponse(s,a);case"wc_sessionRequest":return this.onSessionRequestResponse(s,a);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:a}=W("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,s)=>{const{params:a,id:u}=s;try{this.isValidConnect(hr({},s.params));const f=zr(q.cjsExports.FIVE_MINUTES),y=hr({id:u,pairingTopic:r,expiry:f},a);await this.setProposal(u,y);const w=gs(JSON.stringify(s)),g=await this.getVerifyContext(w,y.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:y,verifyContext:g})}catch(f){await this.sendError(u,r,f),this.client.logger.error(f)}},this.onSessionProposeResponse=async(r,s)=>{const{id:a}=s;if(ee.isJsonRpcResult(s)){const{result:u}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const f=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});const y=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:y});const w=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const g=await this.client.core.crypto.generateSharedKey(y,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:g});const b=await this.client.core.relayer.subscribe(g);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:b}),await this.client.core.pairing.activate({topic:r})}else ee.isJsonRpcError(s)&&(await this.client.proposal.delete(a,It("USER_DISCONNECTED")),this.events.emit(jt("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:a,params:u}=s;try{this.isValidSessionSettleRequest(u);const{relay:f,controller:y,expiry:w,namespaces:g,requiredNamespaces:b,optionalNamespaces:S,sessionProperties:O,pairingTopic:U}=s.params,$=hr({topic:r,relay:f,expiry:w,namespaces:g,acknowledged:!0,pairingTopic:U,requiredNamespaces:b,optionalNamespaces:S,controller:y.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:y.publicKey,metadata:y.metadata}},O&&{sessionProperties:O});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(jt("session_connect"),{session:$}),this.cleanupDuplicatePairings($)}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.onSessionSettleResponse=async(r,s)=>{const{id:a}=s;ee.isJsonRpcResult(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(jt("session_approve",a),{})):ee.isJsonRpcError(s)&&(await this.client.session.delete(r,It("USER_DISCONNECTED")),this.events.emit(jt("session_approve",a),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:a,id:u}=s;try{const f=`${r}_session_update`,y=lo.get(f);if(y&&this.isRequestOutOfSync(y,u)){this.client.logger.info(`Discarding out of sync request - ${u}`);return}this.isValidUpdate(hr({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:u,topic:r,result:!0}),this.client.events.emit("session_update",{id:u,topic:r,params:a}),lo.set(f,u)}catch(f){await this.sendError(u,r,f),this.client.logger.error(f)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:a}=s;ee.isJsonRpcResult(s)?this.events.emit(jt("session_update",a),{}):ee.isJsonRpcError(s)&&this.events.emit(jt("session_update",a),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:a}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,zr(fo)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionExtendResponse=(r,s)=>{const{id:a}=s;ee.isJsonRpcResult(s)?this.events.emit(jt("session_extend",a),{}):ee.isJsonRpcError(s)&&this.events.emit(jt("session_extend",a),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:a}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionPingResponse=(r,s)=>{const{id:a}=s;setTimeout(()=>{ee.isJsonRpcResult(s)?this.events.emit(jt("session_ping",a),{}):ee.isJsonRpcError(s)&&this.events.emit(jt("session_ping",a),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(Jt.publish,async()=>{u(await this.deleteSession(r))})}),this.sendResult({id:a,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(r,s)=>{const{id:a,params:u}=s;try{this.isValidRequest(hr({topic:r},u));const f=gs(JSON.stringify(ee.formatJsonRpcRequest("wc_sessionRequest",u,a))),y=this.client.session.get(r),w=await this.getVerifyContext(f,y.peer.metadata),g={id:a,topic:r,params:u,verifyContext:w};await this.setPendingSessionRequest(g),this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue()}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.onSessionRequestResponse=(r,s)=>{const{id:a}=s;ee.isJsonRpcResult(s)?this.events.emit(jt("session_request",a),{result:s.result}):ee.isJsonRpcError(s)&&this.events.emit(jt("session_request",a),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:a,params:u}=s;try{const f=`${r}_session_event_${u.event.name}`,y=lo.get(f);if(y&&this.isRequestOutOfSync(y,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(hr({topic:r},u)),this.client.events.emit("session_event",{id:a,topic:r,params:u}),lo.set(f,a)}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ui.idle,this.processSessionRequestQueue()},q.cjsExports.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===ui.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ui.active,this.client.events.emit("session_request",r)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=r=>{if(r.active)return;const s=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);s&&this.onSessionProposeRequest(r.topic,ee.formatJsonRpcRequest("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async r=>{if(!fr(r)){const{message:w}=W("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(w)}const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:u,sessionProperties:f,relays:y}=r;if(rr(s)||await this.isValidPairingTopic(s),!$_(y)){const{message:w}=W("MISSING_OR_INVALID",`connect() relays: ${y}`);throw new Error(w)}!rr(a)&&ys(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!rr(u)&&ys(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),rr(f)||this.validateSessionProps(f,"sessionProperties")},this.validateNamespaces=(r,s)=>{const a=A_(r,"connect()",s);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!fr(r))throw new Error(W("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:a,relayProtocol:u,sessionProperties:f}=r;await this.isValidProposalId(s);const y=this.client.proposal.get(s),w=wo(a,"approve()");if(w)throw new Error(w.message);const g=Ol(y.requiredNamespaces,a,"approve()");if(g)throw new Error(g.message);if(!Ht(u,!0)){const{message:b}=W("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(b)}rr(f)||this.validateSessionProps(f,"sessionProperties")},this.isValidReject=async r=>{if(!fr(r)){const{message:u}=W("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(u)}const{id:s,reason:a}=r;if(await this.isValidProposalId(s),!j_(a)){const{message:u}=W("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidSessionSettleRequest=r=>{if(!fr(r)){const{message:g}=W("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(g)}const{relay:s,controller:a,namespaces:u,expiry:f}=r;if(!jf(s)){const{message:g}=W("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(g)}const y=S_(a,"onSessionSettleRequest()");if(y)throw new Error(y.message);const w=wo(u,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(Ii(f)){const{message:g}=W("EXPIRED","onSessionSettleRequest()");throw new Error(g)}},this.isValidUpdate=async r=>{if(!fr(r)){const{message:w}=W("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(w)}const{topic:s,namespaces:a}=r;await this.isValidSessionTopic(s);const u=this.client.session.get(s),f=wo(a,"update()");if(f)throw new Error(f.message);const y=Ol(u.requiredNamespaces,a,"update()");if(y)throw new Error(y.message)},this.isValidExtend=async r=>{if(!fr(r)){const{message:a}=W("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!fr(r)){const{message:w}=W("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(w)}const{topic:s,request:a,chainId:u,expiry:f}=r;await this.isValidSessionTopic(s);const{namespaces:y}=this.client.session.get(s);if(!Pl(y,u)){const{message:w}=W("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(w)}if(!D_(a)){const{message:w}=W("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(w)}if(!M_(y,u,a.method)){const{message:w}=W("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(w)}if(f&&!H_(f,bc)){const{message:w}=W("MISSING_OR_INVALID",`request() expiry: ${f}. Expiry must be a number (in seconds) between ${bc.min} and ${bc.max}`);throw new Error(w)}},this.isValidRespond=async r=>{var s;if(!fr(r)){const{message:f}=W("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(f)}const{topic:a,response:u}=r;try{await this.isValidSessionTopic(a)}catch(f){throw(s=r==null?void 0:r.response)!=null&&s.id&&this.cleanupAfterResponse(r),f}if(!q_(u)){const{message:f}=W("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(u)}`);throw new Error(f)}},this.isValidPing=async r=>{if(!fr(r)){const{message:a}=W("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!fr(r)){const{message:y}=W("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(y)}const{topic:s,event:a,chainId:u}=r;await this.isValidSessionTopic(s);const{namespaces:f}=this.client.session.get(s);if(!Pl(f,u)){const{message:y}=W("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(y)}if(!U_(a)){const{message:y}=W("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(y)}if(!L_(f,u,a.name)){const{message:y}=W("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(y)}},this.isValidDisconnect=async r=>{if(!fr(r)){const{message:a}=W("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const a={verified:{verifyUrl:s.verifyUrl||ds,validation:"UNKNOWN",origin:s.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});u&&(a.verified.origin=u.origin,a.verified.isScam=u.isScam,a.verified.validation=u.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.info(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(a=>{if(!Ht(a,!1)){const{message:u}=W("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(u)}})}}async isInitialized(){if(!this.initialized){const{message:t}=W("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Jt.message,async t=>{const{topic:r,message:s}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const a=await this.client.core.crypto.decode(r,s);try{ee.isJsonRpcRequest(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):ee.isJsonRpcResponse(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(u){this.client.logger.error(u)}})}registerExpirerEvents(){this.client.core.expirer.on(Ar.expired,async t=>{const{topic:r,id:s}=$f(t.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,W("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(Ws.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!Ht(t,!1)){const{message:r}=W("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=W("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(Ii(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=W("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!Ht(t,!1)){const{message:r}=W("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=W("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(Ii(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=W("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(Ht(t,!1)){const{message:r}=W("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=W("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!C_(t)){const{message:r}=W("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=W("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(Ii(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=W("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class BI extends Ao{constructor(t,r){super(t,r,jI,Jc),this.core=t,this.logger=r}}class FI extends Ao{constructor(t,r){super(t,r,DI,Jc),this.core=t,this.logger=r}}class GI extends Ao{constructor(t,r){super(t,r,UI,Jc,s=>s.id),this.core=t,this.logger=r}}let WI=class Xf extends p0{constructor(t){super(t),this.protocol=Jf,this.version=Qf,this.name=wc.name,this.events=new q.eventsExports.EventEmitter,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(a){throw this.logger.error(a.message),a}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(a){throw this.logger.error(a.message),a}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(a){throw this.logger.error(a.message),a}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(a){throw this.logger.error(a.message),a}},this.update=async s=>{try{return await this.engine.update(s)}catch(a){throw this.logger.error(a.message),a}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(a){throw this.logger.error(a.message),a}},this.request=async s=>{try{return await this.engine.request(s)}catch(a){throw this.logger.error(a.message),a}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(a){throw this.logger.error(a.message),a}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(a){throw this.logger.error(a.message),a}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(a){throw this.logger.error(a.message),a}},this.find=s=>{try{return this.engine.find(s)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(t==null?void 0:t.name)||wc.name,this.metadata=(t==null?void 0:t.metadata)||Q0();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ro(To({level:(t==null?void 0:t.logger)||wc.logger}));this.core=(t==null?void 0:t.core)||new CI(t),this.logger=dr(r,this.name),this.session=new FI(this.core,this.logger),this.proposal=new BI(this.core,this.logger),this.pendingRequest=new GI(this.core,this.logger),this.engine=new VI(this)}static async init(t){const r=new Xf(t);return await r.initialize(),r}get context(){return pr(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};const ef="error",JI="wss://relay.walletconnect.com",QI="wc",YI="universal_provider",tf=`${QI}@2:${YI}:`,ZI="https://rpc.walletconnect.com/v1/",li={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Bs=typeof globalThis<"u"?globalThis:typeof window<"u"||typeof window<"u"?window:typeof self<"u"?self:{},Uc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(n,t){(function(){var r,s="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",y="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",g=500,b="__lodash_placeholder__",S=1,O=2,U=4,$=1,B=2,ie=1,ye=2,ue=4,he=8,fe=16,pe=32,j=64,K=128,Q=256,ve=512,se=30,Ie="...",Te=800,et=16,N=1,z=2,Le=3,Ne=1/0,Y=9007199254740991,F=17976931348623157e292,V=NaN,G=4294967295,ut=G-1,He=G>>>1,Hr=[["ary",K],["bind",ie],["bindKey",ye],["curry",he],["curryRight",fe],["flip",ve],["partial",pe],["partialRight",j],["rearg",Q]],_e="[object Arguments]",xt="[object Array]",C="[object AsyncFunction]",A="[object Boolean]",R="[object Date]",h="[object DOMException]",E="[object Error]",te="[object Function]",ce="[object GeneratorFunction]",we="[object Map]",Ae="[object Number]",Ce="[object Null]",Se="[object Object]",St="[object Promise]",mt="[object Proxy]",nt="[object RegExp]",De="[object Set]",Je="[object String]",Qe="[object Symbol]",ot="[object Undefined]",ze="[object WeakMap]",Ye="[object WeakSet]",$e="[object ArrayBuffer]",Ke="[object DataView]",ht="[object Float32Array]",Ue="[object Float64Array]",Pt="[object Int8Array]",Dt="[object Int16Array]",Kt="[object Int32Array]",Vt="[object Uint8Array]",Mt="[object Uint8ClampedArray]",Qt="[object Uint16Array]",sr="[object Uint32Array]",Kr=/\b__p \+= '';/g,Yt=/\b(__p \+=) '' \+/g,Qr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,fi=/&(?:amp|lt|gt|quot|#39);/g,Pi=/[&<>"']/g,lt=RegExp(fi.source),tt=RegExp(Pi.source),ft=/<%-([\s\S]+?)%>/g,pt=/<%([\s\S]+?)%>/g,at=/<%=([\s\S]+?)%>/g,rt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ot=/^\w*$/,Rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,dt=/[\\^$.*+?()[\]{}|]/g,Tt=RegExp(dt.source),gt=/^\s+/,wt=/\s/,yt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,We=/\{\n\/\* \[wrapped with (.+)\] \*/,Nt=/,? & /,At=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Co=/[()=,{}\[\]\/\s]/,jo=/\\(\\)?/g,Do=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Er=/\w*$/,qo=/^[-+]0x[0-9a-f]+$/i,Uo=/^0b[01]+$/i,Mo=/^\[object .+?Constructor\]$/,Lo=/^0o[0-7]+$/i,zo=/^(?:0|[1-9]\d*)$/,Yr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Gi=/($^)/,ko=/['\n\r\u2028\u2029\\]/g,Wi="\\ud800-\\udfff",Ho="\\u0300-\\u036f",Ko="\\ufe20-\\ufe2f",Ji="\\u20d0-\\u20ff",nn=Ho+Ko+Ji,on="\\u2700-\\u27bf",Cr="a-z\\xdf-\\xf6\\xf8-\\xff",Vo="\\xac\\xb1\\xd7\\xf7",Bo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Fo="\\u2000-\\u206f",Go=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",an="A-Z\\xc0-\\xd6\\xd8-\\xde",cn="\\ufe0e\\ufe0f",Oi=Vo+Bo+Fo+Go,bs="[']",Ri="["+Wi+"]",_s="["+Oi+"]",Ti="["+nn+"]",un="\\d+",Wo="["+on+"]",hn="["+Cr+"]",ln="[^"+Wi+Oi+un+on+Cr+an+"]",Qi="\\ud83c[\\udffb-\\udfff]",Jo="(?:"+Ti+"|"+Qi+")",fn="[^"+Wi+"]",Yi="(?:\\ud83c[\\udde6-\\uddff]){2}",pi="[\\ud800-\\udbff][\\udc00-\\udfff]",gr="["+an+"]",pn="\\u200d",dn="(?:"+hn+"|"+ln+")",Vr="(?:"+gr+"|"+ln+")",gn="(?:"+bs+"(?:d|ll|m|re|s|t|ve))?",yn="(?:"+bs+"(?:D|LL|M|RE|S|T|VE))?",vn=Jo+"?",mn="["+cn+"]?",Qo="(?:"+pn+"(?:"+[fn,Yi,pi].join("|")+")"+mn+vn+")*",Zr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",wn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",bn=mn+vn+Qo,Zi="(?:"+[Wo,Yi,pi].join("|")+")"+bn,Yo="(?:"+[fn+Ti+"?",Ti,Yi,pi,Ri].join("|")+")",Es=RegExp(bs,"g"),Zo=RegExp(Ti,"g"),Xi=RegExp(Qi+"(?="+Qi+")|"+Yo+bn,"g"),_n=RegExp([gr+"?"+hn+"+"+gn+"(?="+[_s,gr,"$"].join("|")+")",Vr+"+"+yn+"(?="+[_s,gr+dn,"$"].join("|")+")",gr+"?"+dn+"+"+gn,gr+"+"+yn,wn,Zr,un,Zi].join("|"),"g"),En=RegExp("["+pn+Wi+nn+cn+"]"),Ni=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,In=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Xo=-1,Ve={};Ve[ht]=Ve[Ue]=Ve[Pt]=Ve[Dt]=Ve[Kt]=Ve[Vt]=Ve[Mt]=Ve[Qt]=Ve[sr]=!0,Ve[_e]=Ve[xt]=Ve[$e]=Ve[A]=Ve[Ke]=Ve[R]=Ve[E]=Ve[te]=Ve[we]=Ve[Ae]=Ve[Se]=Ve[nt]=Ve[De]=Ve[Je]=Ve[ze]=!1;var ke={};ke[_e]=ke[xt]=ke[$e]=ke[Ke]=ke[A]=ke[R]=ke[ht]=ke[Ue]=ke[Pt]=ke[Dt]=ke[Kt]=ke[we]=ke[Ae]=ke[Se]=ke[nt]=ke[De]=ke[Je]=ke[Qe]=ke[Vt]=ke[Mt]=ke[Qt]=ke[sr]=!0,ke[E]=ke[te]=ke[ze]=!1;var v={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},k={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Z={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Be=parseFloat,de=parseInt,Ze=typeof Bs=="object"&&Bs&&Bs.Object===Object&&Bs,$t=typeof self=="object"&&self&&self.Object===Object&&self,Oe=Ze||$t||Function("return this")(),Fe=t&&!t.nodeType&&t,bt=Fe&&!0&&n&&!n.nodeType&&n,nr=bt&&bt.exports===Fe,Ct=nr&&Ze.process,Xe=function(){try{var x=bt&&bt.require&&bt.require("util").types;return x||Ct&&Ct.binding&&Ct.binding("util")}catch{}}(),Zt=Xe&&Xe.isArrayBuffer,jr=Xe&&Xe.isDate,Ir=Xe&&Xe.isMap,Br=Xe&&Xe.isRegExp,Is=Xe&&Xe.isSet,Ai=Xe&&Xe.isTypedArray;function Lt(x,D,T){switch(T.length){case 0:return x.call(D);case 1:return x.call(D,T[0]);case 2:return x.call(D,T[0],T[1]);case 3:return x.call(D,T[0],T[1],T[2])}return x.apply(D,T)}function sp(x,D,T,X){for(var le=-1,je=x==null?0:x.length;++le<je;){var qt=x[le];D(X,qt,T(qt),x)}return X}function xr(x,D){for(var T=-1,X=x==null?0:x.length;++T<X&&D(x[T],T,x)!==!1;);return x}function np(x,D){for(var T=x==null?0:x.length;T--&&D(x[T],T,x)!==!1;);return x}function Yc(x,D){for(var T=-1,X=x==null?0:x.length;++T<X;)if(!D(x[T],T,x))return!1;return!0}function di(x,D){for(var T=-1,X=x==null?0:x.length,le=0,je=[];++T<X;){var qt=x[T];D(qt,T,x)&&(je[le++]=qt)}return je}function xn(x,D){var T=x==null?0:x.length;return!!T&&es(x,D,0)>-1}function ea(x,D,T){for(var X=-1,le=x==null?0:x.length;++X<le;)if(T(D,x[X]))return!0;return!1}function it(x,D){for(var T=-1,X=x==null?0:x.length,le=Array(X);++T<X;)le[T]=D(x[T],T,x);return le}function gi(x,D){for(var T=-1,X=D.length,le=x.length;++T<X;)x[le+T]=D[T];return x}function ta(x,D,T,X){var le=-1,je=x==null?0:x.length;for(X&&je&&(T=x[++le]);++le<je;)T=D(T,x[le],le,x);return T}function op(x,D,T,X){var le=x==null?0:x.length;for(X&&le&&(T=x[--le]);le--;)T=D(T,x[le],le,x);return T}function ra(x,D){for(var T=-1,X=x==null?0:x.length;++T<X;)if(D(x[T],T,x))return!0;return!1}var ap=ia("length");function cp(x){return x.split("")}function up(x){return x.match(At)||[]}function Zc(x,D,T){var X;return T(x,function(le,je,qt){if(D(le,je,qt))return X=je,!1}),X}function Sn(x,D,T,X){for(var le=x.length,je=T+(X?1:-1);X?je--:++je<le;)if(D(x[je],je,x))return je;return-1}function es(x,D,T){return D===D?_p(x,D,T):Sn(x,Xc,T)}function hp(x,D,T,X){for(var le=T-1,je=x.length;++le<je;)if(X(x[le],D))return le;return-1}function Xc(x){return x!==x}function eu(x,D){var T=x==null?0:x.length;return T?na(x,D)/T:V}function ia(x){return function(D){return D==null?r:D[x]}}function sa(x){return function(D){return x==null?r:x[D]}}function tu(x,D,T,X,le){return le(x,function(je,qt,Ge){T=X?(X=!1,je):D(T,je,qt,Ge)}),T}function lp(x,D){var T=x.length;for(x.sort(D);T--;)x[T]=x[T].value;return x}function na(x,D){for(var T,X=-1,le=x.length;++X<le;){var je=D(x[X]);je!==r&&(T=T===r?je:T+je)}return T}function oa(x,D){for(var T=-1,X=Array(x);++T<x;)X[T]=D(T);return X}function fp(x,D){return it(D,function(T){return[T,x[T]]})}function ru(x){return x&&x.slice(0,ou(x)+1).replace(gt,"")}function yr(x){return function(D){return x(D)}}function aa(x,D){return it(D,function(T){return x[T]})}function xs(x,D){return x.has(D)}function iu(x,D){for(var T=-1,X=x.length;++T<X&&es(D,x[T],0)>-1;);return T}function su(x,D){for(var T=x.length;T--&&es(D,x[T],0)>-1;);return T}function pp(x,D){for(var T=x.length,X=0;T--;)x[T]===D&&++X;return X}var dp=sa(v),gp=sa(I);function yp(x){return"\\"+Z[x]}function vp(x,D){return x==null?r:x[D]}function ts(x){return En.test(x)}function mp(x){return Ni.test(x)}function wp(x){for(var D,T=[];!(D=x.next()).done;)T.push(D.value);return T}function ca(x){var D=-1,T=Array(x.size);return x.forEach(function(X,le){T[++D]=[le,X]}),T}function nu(x,D){return function(T){return x(D(T))}}function yi(x,D){for(var T=-1,X=x.length,le=0,je=[];++T<X;){var qt=x[T];(qt===D||qt===b)&&(x[T]=b,je[le++]=T)}return je}function Pn(x){var D=-1,T=Array(x.size);return x.forEach(function(X){T[++D]=X}),T}function bp(x){var D=-1,T=Array(x.size);return x.forEach(function(X){T[++D]=[X,X]}),T}function _p(x,D,T){for(var X=T-1,le=x.length;++X<le;)if(x[X]===D)return X;return-1}function Ep(x,D,T){for(var X=T+1;X--;)if(x[X]===D)return X;return X}function rs(x){return ts(x)?xp(x):ap(x)}function Dr(x){return ts(x)?Sp(x):cp(x)}function ou(x){for(var D=x.length;D--&&wt.test(x.charAt(D)););return D}var Ip=sa(k);function xp(x){for(var D=Xi.lastIndex=0;Xi.test(x);)++D;return D}function Sp(x){return x.match(Xi)||[]}function Pp(x){return x.match(_n)||[]}var Op=function x(D){D=D==null?Oe:is.defaults(Oe.Object(),D,is.pick(Oe,In));var T=D.Array,X=D.Date,le=D.Error,je=D.Function,qt=D.Math,Ge=D.Object,ua=D.RegExp,Rp=D.String,Sr=D.TypeError,On=T.prototype,Tp=je.prototype,ss=Ge.prototype,Rn=D["__core-js_shared__"],Tn=Tp.toString,Me=ss.hasOwnProperty,Np=0,au=function(){var e=/[^.]+$/.exec(Rn&&Rn.keys&&Rn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Nn=ss.toString,Ap=Tn.call(Ge),$p=Oe._,Cp=ua("^"+Tn.call(Me).replace(dt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),An=nr?D.Buffer:r,vi=D.Symbol,$n=D.Uint8Array,cu=An?An.allocUnsafe:r,Cn=nu(Ge.getPrototypeOf,Ge),uu=Ge.create,hu=ss.propertyIsEnumerable,jn=On.splice,lu=vi?vi.isConcatSpreadable:r,Ss=vi?vi.iterator:r,$i=vi?vi.toStringTag:r,Dn=function(){try{var e=Ui(Ge,"defineProperty");return e({},"",{}),e}catch{}}(),jp=D.clearTimeout!==Oe.clearTimeout&&D.clearTimeout,Dp=X&&X.now!==Oe.Date.now&&X.now,qp=D.setTimeout!==Oe.setTimeout&&D.setTimeout,qn=qt.ceil,Un=qt.floor,ha=Ge.getOwnPropertySymbols,Up=An?An.isBuffer:r,fu=D.isFinite,Mp=On.join,Lp=nu(Ge.keys,Ge),Ut=qt.max,Gt=qt.min,zp=X.now,kp=D.parseInt,pu=qt.random,Hp=On.reverse,la=Ui(D,"DataView"),Ps=Ui(D,"Map"),fa=Ui(D,"Promise"),ns=Ui(D,"Set"),Os=Ui(D,"WeakMap"),Rs=Ui(Ge,"create"),Mn=Os&&new Os,os={},Kp=Mi(la),Vp=Mi(Ps),Bp=Mi(fa),Fp=Mi(ns),Gp=Mi(Os),Ln=vi?vi.prototype:r,Ts=Ln?Ln.valueOf:r,du=Ln?Ln.toString:r;function p(e){if(vt(e)&&!ge(e)&&!(e instanceof Pe)){if(e instanceof Pr)return e;if(Me.call(e,"__wrapped__"))return gh(e)}return new Pr(e)}var as=function(){function e(){}return function(i){if(!ct(i))return{};if(uu)return uu(i);e.prototype=i;var o=new e;return e.prototype=r,o}}();function zn(){}function Pr(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}p.templateSettings={escape:ft,evaluate:pt,interpolate:at,variable:"",imports:{_:p}},p.prototype=zn.prototype,p.prototype.constructor=p,Pr.prototype=as(zn.prototype),Pr.prototype.constructor=Pr;function Pe(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=G,this.__views__=[]}function Wp(){var e=new Pe(this.__wrapped__);return e.__actions__=or(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=or(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=or(this.__views__),e}function Jp(){if(this.__filtered__){var e=new Pe(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Qp(){var e=this.__wrapped__.value(),i=this.__dir__,o=ge(e),c=i<0,l=o?e.length:0,d=cg(0,l,this.__views__),m=d.start,_=d.end,P=_-m,M=c?_:m-1,L=this.__iteratees__,H=L.length,J=0,re=Gt(P,this.__takeCount__);if(!o||!c&&l==P&&re==P)return Mu(e,this.__actions__);var oe=[];e:for(;P--&&J<re;){M+=i;for(var be=-1,ae=e[M];++be<H;){var xe=L[be],Re=xe.iteratee,wr=xe.type,tr=Re(ae);if(wr==z)ae=tr;else if(!tr){if(wr==N)continue e;break e}}oe[J++]=ae}return oe}Pe.prototype=as(zn.prototype),Pe.prototype.constructor=Pe;function Ci(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var c=e[i];this.set(c[0],c[1])}}function Yp(){this.__data__=Rs?Rs(null):{},this.size=0}function Zp(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function Xp(e){var i=this.__data__;if(Rs){var o=i[e];return o===w?r:o}return Me.call(i,e)?i[e]:r}function ed(e){var i=this.__data__;return Rs?i[e]!==r:Me.call(i,e)}function td(e,i){var o=this.__data__;return this.size+=this.has(e)?0:1,o[e]=Rs&&i===r?w:i,this}Ci.prototype.clear=Yp,Ci.prototype.delete=Zp,Ci.prototype.get=Xp,Ci.prototype.has=ed,Ci.prototype.set=td;function Xr(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var c=e[i];this.set(c[0],c[1])}}function rd(){this.__data__=[],this.size=0}function id(e){var i=this.__data__,o=kn(i,e);if(o<0)return!1;var c=i.length-1;return o==c?i.pop():jn.call(i,o,1),--this.size,!0}function sd(e){var i=this.__data__,o=kn(i,e);return o<0?r:i[o][1]}function nd(e){return kn(this.__data__,e)>-1}function od(e,i){var o=this.__data__,c=kn(o,e);return c<0?(++this.size,o.push([e,i])):o[c][1]=i,this}Xr.prototype.clear=rd,Xr.prototype.delete=id,Xr.prototype.get=sd,Xr.prototype.has=nd,Xr.prototype.set=od;function ei(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var c=e[i];this.set(c[0],c[1])}}function ad(){this.size=0,this.__data__={hash:new Ci,map:new(Ps||Xr),string:new Ci}}function cd(e){var i=Xn(this,e).delete(e);return this.size-=i?1:0,i}function ud(e){return Xn(this,e).get(e)}function hd(e){return Xn(this,e).has(e)}function ld(e,i){var o=Xn(this,e),c=o.size;return o.set(e,i),this.size+=o.size==c?0:1,this}ei.prototype.clear=ad,ei.prototype.delete=cd,ei.prototype.get=ud,ei.prototype.has=hd,ei.prototype.set=ld;function ji(e){var i=-1,o=e==null?0:e.length;for(this.__data__=new ei;++i<o;)this.add(e[i])}function fd(e){return this.__data__.set(e,w),this}function pd(e){return this.__data__.has(e)}ji.prototype.add=ji.prototype.push=fd,ji.prototype.has=pd;function qr(e){var i=this.__data__=new Xr(e);this.size=i.size}function dd(){this.__data__=new Xr,this.size=0}function gd(e){var i=this.__data__,o=i.delete(e);return this.size=i.size,o}function yd(e){return this.__data__.get(e)}function vd(e){return this.__data__.has(e)}function md(e,i){var o=this.__data__;if(o instanceof Xr){var c=o.__data__;if(!Ps||c.length<a-1)return c.push([e,i]),this.size=++o.size,this;o=this.__data__=new ei(c)}return o.set(e,i),this.size=o.size,this}qr.prototype.clear=dd,qr.prototype.delete=gd,qr.prototype.get=yd,qr.prototype.has=vd,qr.prototype.set=md;function gu(e,i){var o=ge(e),c=!o&&Li(e),l=!o&&!c&&Ei(e),d=!o&&!c&&!l&&ls(e),m=o||c||l||d,_=m?oa(e.length,Rp):[],P=_.length;for(var M in e)(i||Me.call(e,M))&&!(m&&(M=="length"||l&&(M=="offset"||M=="parent")||d&&(M=="buffer"||M=="byteLength"||M=="byteOffset")||si(M,P)))&&_.push(M);return _}function yu(e){var i=e.length;return i?e[Ia(0,i-1)]:r}function wd(e,i){return eo(or(e),Di(i,0,e.length))}function bd(e){return eo(or(e))}function pa(e,i,o){(o!==r&&!Ur(e[i],o)||o===r&&!(i in e))&&ti(e,i,o)}function Ns(e,i,o){var c=e[i];(!(Me.call(e,i)&&Ur(c,o))||o===r&&!(i in e))&&ti(e,i,o)}function kn(e,i){for(var o=e.length;o--;)if(Ur(e[o][0],i))return o;return-1}function _d(e,i,o,c){return mi(e,function(l,d,m){i(c,l,o(l),m)}),c}function vu(e,i){return e&&Gr(i,zt(i),e)}function Ed(e,i){return e&&Gr(i,cr(i),e)}function ti(e,i,o){i=="__proto__"&&Dn?Dn(e,i,{configurable:!0,enumerable:!0,value:o,writable:!0}):e[i]=o}function da(e,i){for(var o=-1,c=i.length,l=T(c),d=e==null;++o<c;)l[o]=d?r:Wa(e,i[o]);return l}function Di(e,i,o){return e===e&&(o!==r&&(e=e<=o?e:o),i!==r&&(e=e>=i?e:i)),e}function Or(e,i,o,c,l,d){var m,_=i&S,P=i&O,M=i&U;if(o&&(m=l?o(e,c,l,d):o(e)),m!==r)return m;if(!ct(e))return e;var L=ge(e);if(L){if(m=hg(e),!_)return or(e,m)}else{var H=Wt(e),J=H==te||H==ce;if(Ei(e))return ku(e,_);if(H==Se||H==_e||J&&!l){if(m=P||J?{}:oh(e),!_)return P?Xd(e,Ed(m,e)):Zd(e,vu(m,e))}else{if(!ke[H])return l?e:{};m=lg(e,H,_)}}d||(d=new qr);var re=d.get(e);if(re)return re;d.set(e,m),Dh(e)?e.forEach(function(ae){m.add(Or(ae,i,o,ae,e,d))}):Ch(e)&&e.forEach(function(ae,xe){m.set(xe,Or(ae,i,o,xe,e,d))});var oe=M?P?ja:Ca:P?cr:zt,be=L?r:oe(e);return xr(be||e,function(ae,xe){be&&(xe=ae,ae=e[xe]),Ns(m,xe,Or(ae,i,o,xe,e,d))}),m}function Id(e){var i=zt(e);return function(o){return mu(o,e,i)}}function mu(e,i,o){var c=o.length;if(e==null)return!c;for(e=Ge(e);c--;){var l=o[c],d=i[l],m=e[l];if(m===r&&!(l in e)||!d(m))return!1}return!0}function wu(e,i,o){if(typeof e!="function")throw new Sr(f);return Us(function(){e.apply(r,o)},i)}function As(e,i,o,c){var l=-1,d=xn,m=!0,_=e.length,P=[],M=i.length;if(!_)return P;o&&(i=it(i,yr(o))),c?(d=ea,m=!1):i.length>=a&&(d=xs,m=!1,i=new ji(i));e:for(;++l<_;){var L=e[l],H=o==null?L:o(L);if(L=c||L!==0?L:0,m&&H===H){for(var J=M;J--;)if(i[J]===H)continue e;P.push(L)}else d(i,H,c)||P.push(L)}return P}var mi=Fu(Fr),bu=Fu(ya,!0);function xd(e,i){var o=!0;return mi(e,function(c,l,d){return o=!!i(c,l,d),o}),o}function Hn(e,i,o){for(var c=-1,l=e.length;++c<l;){var d=e[c],m=i(d);if(m!=null&&(_===r?m===m&&!mr(m):o(m,_)))var _=m,P=d}return P}function Sd(e,i,o,c){var l=e.length;for(o=me(o),o<0&&(o=-o>l?0:l+o),c=c===r||c>l?l:me(c),c<0&&(c+=l),c=o>c?0:Uh(c);o<c;)e[o++]=i;return e}function _u(e,i){var o=[];return mi(e,function(c,l,d){i(c,l,d)&&o.push(c)}),o}function Bt(e,i,o,c,l){var d=-1,m=e.length;for(o||(o=pg),l||(l=[]);++d<m;){var _=e[d];i>0&&o(_)?i>1?Bt(_,i-1,o,c,l):gi(l,_):c||(l[l.length]=_)}return l}var ga=Gu(),Eu=Gu(!0);function Fr(e,i){return e&&ga(e,i,zt)}function ya(e,i){return e&&Eu(e,i,zt)}function Kn(e,i){return di(i,function(o){return ni(e[o])})}function qi(e,i){i=bi(i,e);for(var o=0,c=i.length;e!=null&&o<c;)e=e[Wr(i[o++])];return o&&o==c?e:r}function Iu(e,i,o){var c=i(e);return ge(e)?c:gi(c,o(e))}function Xt(e){return e==null?e===r?ot:Ce:$i&&$i in Ge(e)?ag(e):bg(e)}function va(e,i){return e>i}function Pd(e,i){return e!=null&&Me.call(e,i)}function Od(e,i){return e!=null&&i in Ge(e)}function Rd(e,i,o){return e>=Gt(i,o)&&e<Ut(i,o)}function ma(e,i,o){for(var c=o?ea:xn,l=e[0].length,d=e.length,m=d,_=T(d),P=1/0,M=[];m--;){var L=e[m];m&&i&&(L=it(L,yr(i))),P=Gt(L.length,P),_[m]=!o&&(i||l>=120&&L.length>=120)?new ji(m&&L):r}L=e[0];var H=-1,J=_[0];e:for(;++H<l&&M.length<P;){var re=L[H],oe=i?i(re):re;if(re=o||re!==0?re:0,!(J?xs(J,oe):c(M,oe,o))){for(m=d;--m;){var be=_[m];if(!(be?xs(be,oe):c(e[m],oe,o)))continue e}J&&J.push(oe),M.push(re)}}return M}function Td(e,i,o,c){return Fr(e,function(l,d,m){i(c,o(l),d,m)}),c}function $s(e,i,o){i=bi(i,e),e=hh(e,i);var c=e==null?e:e[Wr(Tr(i))];return c==null?r:Lt(c,e,o)}function xu(e){return vt(e)&&Xt(e)==_e}function Nd(e){return vt(e)&&Xt(e)==$e}function Ad(e){return vt(e)&&Xt(e)==R}function Cs(e,i,o,c,l){return e===i?!0:e==null||i==null||!vt(e)&&!vt(i)?e!==e&&i!==i:$d(e,i,o,c,Cs,l)}function $d(e,i,o,c,l,d){var m=ge(e),_=ge(i),P=m?xt:Wt(e),M=_?xt:Wt(i);P=P==_e?Se:P,M=M==_e?Se:M;var L=P==Se,H=M==Se,J=P==M;if(J&&Ei(e)){if(!Ei(i))return!1;m=!0,L=!1}if(J&&!L)return d||(d=new qr),m||ls(e)?ih(e,i,o,c,l,d):ng(e,i,P,o,c,l,d);if(!(o&$)){var re=L&&Me.call(e,"__wrapped__"),oe=H&&Me.call(i,"__wrapped__");if(re||oe){var be=re?e.value():e,ae=oe?i.value():i;return d||(d=new qr),l(be,ae,o,c,d)}}return J?(d||(d=new qr),og(e,i,o,c,l,d)):!1}function Cd(e){return vt(e)&&Wt(e)==we}function wa(e,i,o,c){var l=o.length,d=l,m=!c;if(e==null)return!d;for(e=Ge(e);l--;){var _=o[l];if(m&&_[2]?_[1]!==e[_[0]]:!(_[0]in e))return!1}for(;++l<d;){_=o[l];var P=_[0],M=e[P],L=_[1];if(m&&_[2]){if(M===r&&!(P in e))return!1}else{var H=new qr;if(c)var J=c(M,L,P,e,i,H);if(!(J===r?Cs(L,M,$|B,c,H):J))return!1}}return!0}function Su(e){if(!ct(e)||gg(e))return!1;var i=ni(e)?Cp:Mo;return i.test(Mi(e))}function jd(e){return vt(e)&&Xt(e)==nt}function Dd(e){return vt(e)&&Wt(e)==De}function qd(e){return vt(e)&&oo(e.length)&&!!Ve[Xt(e)]}function Pu(e){return typeof e=="function"?e:e==null?ur:typeof e=="object"?ge(e)?Tu(e[0],e[1]):Ru(e):Wh(e)}function ba(e){if(!qs(e))return Lp(e);var i=[];for(var o in Ge(e))Me.call(e,o)&&o!="constructor"&&i.push(o);return i}function Ud(e){if(!ct(e))return wg(e);var i=qs(e),o=[];for(var c in e)c=="constructor"&&(i||!Me.call(e,c))||o.push(c);return o}function _a(e,i){return e<i}function Ou(e,i){var o=-1,c=ar(e)?T(e.length):[];return mi(e,function(l,d,m){c[++o]=i(l,d,m)}),c}function Ru(e){var i=qa(e);return i.length==1&&i[0][2]?ch(i[0][0],i[0][1]):function(o){return o===e||wa(o,e,i)}}function Tu(e,i){return Ma(e)&&ah(i)?ch(Wr(e),i):function(o){var c=Wa(o,e);return c===r&&c===i?Ja(o,e):Cs(i,c,$|B)}}function Vn(e,i,o,c,l){e!==i&&ga(i,function(d,m){if(l||(l=new qr),ct(d))Md(e,i,m,o,Vn,c,l);else{var _=c?c(za(e,m),d,m+"",e,i,l):r;_===r&&(_=d),pa(e,m,_)}},cr)}function Md(e,i,o,c,l,d,m){var _=za(e,o),P=za(i,o),M=m.get(P);if(M){pa(e,o,M);return}var L=d?d(_,P,o+"",e,i,m):r,H=L===r;if(H){var J=ge(P),re=!J&&Ei(P),oe=!J&&!re&&ls(P);L=P,J||re||oe?ge(_)?L=_:_t(_)?L=or(_):re?(H=!1,L=ku(P,!0)):oe?(H=!1,L=Hu(P,!0)):L=[]:Ms(P)||Li(P)?(L=_,Li(_)?L=Mh(_):(!ct(_)||ni(_))&&(L=oh(P))):H=!1}H&&(m.set(P,L),l(L,P,c,d,m),m.delete(P)),pa(e,o,L)}function Nu(e,i){var o=e.length;if(o)return i+=i<0?o:0,si(i,o)?e[i]:r}function Au(e,i,o){i.length?i=it(i,function(d){return ge(d)?function(m){return qi(m,d.length===1?d[0]:d)}:d}):i=[ur];var c=-1;i=it(i,yr(ne()));var l=Ou(e,function(d,m,_){var P=it(i,function(M){return M(d)});return{criteria:P,index:++c,value:d}});return lp(l,function(d,m){return Yd(d,m,o)})}function Ld(e,i){return $u(e,i,function(o,c){return Ja(e,c)})}function $u(e,i,o){for(var c=-1,l=i.length,d={};++c<l;){var m=i[c],_=qi(e,m);o(_,m)&&js(d,bi(m,e),_)}return d}function zd(e){return function(i){return qi(i,e)}}function Ea(e,i,o,c){var l=c?hp:es,d=-1,m=i.length,_=e;for(e===i&&(i=or(i)),o&&(_=it(e,yr(o)));++d<m;)for(var P=0,M=i[d],L=o?o(M):M;(P=l(_,L,P,c))>-1;)_!==e&&jn.call(_,P,1),jn.call(e,P,1);return e}function Cu(e,i){for(var o=e?i.length:0,c=o-1;o--;){var l=i[o];if(o==c||l!==d){var d=l;si(l)?jn.call(e,l,1):Pa(e,l)}}return e}function Ia(e,i){return e+Un(pu()*(i-e+1))}function kd(e,i,o,c){for(var l=-1,d=Ut(qn((i-e)/(o||1)),0),m=T(d);d--;)m[c?d:++l]=e,e+=o;return m}function xa(e,i){var o="";if(!e||i<1||i>Y)return o;do i%2&&(o+=e),i=Un(i/2),i&&(e+=e);while(i);return o}function Ee(e,i){return ka(uh(e,i,ur),e+"")}function Hd(e){return yu(fs(e))}function Kd(e,i){var o=fs(e);return eo(o,Di(i,0,o.length))}function js(e,i,o,c){if(!ct(e))return e;i=bi(i,e);for(var l=-1,d=i.length,m=d-1,_=e;_!=null&&++l<d;){var P=Wr(i[l]),M=o;if(P==="__proto__"||P==="constructor"||P==="prototype")return e;if(l!=m){var L=_[P];M=c?c(L,P,_):r,M===r&&(M=ct(L)?L:si(i[l+1])?[]:{})}Ns(_,P,M),_=_[P]}return e}var ju=Mn?function(e,i){return Mn.set(e,i),e}:ur,Vd=Dn?function(e,i){return Dn(e,"toString",{configurable:!0,enumerable:!1,value:Ya(i),writable:!0})}:ur;function Bd(e){return eo(fs(e))}function Rr(e,i,o){var c=-1,l=e.length;i<0&&(i=-i>l?0:l+i),o=o>l?l:o,o<0&&(o+=l),l=i>o?0:o-i>>>0,i>>>=0;for(var d=T(l);++c<l;)d[c]=e[c+i];return d}function Fd(e,i){var o;return mi(e,function(c,l,d){return o=i(c,l,d),!o}),!!o}function Bn(e,i,o){var c=0,l=e==null?c:e.length;if(typeof i=="number"&&i===i&&l<=He){for(;c<l;){var d=c+l>>>1,m=e[d];m!==null&&!mr(m)&&(o?m<=i:m<i)?c=d+1:l=d}return l}return Sa(e,i,ur,o)}function Sa(e,i,o,c){var l=0,d=e==null?0:e.length;if(d===0)return 0;i=o(i);for(var m=i!==i,_=i===null,P=mr(i),M=i===r;l<d;){var L=Un((l+d)/2),H=o(e[L]),J=H!==r,re=H===null,oe=H===H,be=mr(H);if(m)var ae=c||oe;else M?ae=oe&&(c||J):_?ae=oe&&J&&(c||!re):P?ae=oe&&J&&!re&&(c||!be):re||be?ae=!1:ae=c?H<=i:H<i;ae?l=L+1:d=L}return Gt(d,ut)}function Du(e,i){for(var o=-1,c=e.length,l=0,d=[];++o<c;){var m=e[o],_=i?i(m):m;if(!o||!Ur(_,P)){var P=_;d[l++]=m===0?0:m}}return d}function qu(e){return typeof e=="number"?e:mr(e)?V:+e}function vr(e){if(typeof e=="string")return e;if(ge(e))return it(e,vr)+"";if(mr(e))return du?du.call(e):"";var i=e+"";return i=="0"&&1/e==-Ne?"-0":i}function wi(e,i,o){var c=-1,l=xn,d=e.length,m=!0,_=[],P=_;if(o)m=!1,l=ea;else if(d>=a){var M=i?null:ig(e);if(M)return Pn(M);m=!1,l=xs,P=new ji}else P=i?[]:_;e:for(;++c<d;){var L=e[c],H=i?i(L):L;if(L=o||L!==0?L:0,m&&H===H){for(var J=P.length;J--;)if(P[J]===H)continue e;i&&P.push(H),_.push(L)}else l(P,H,o)||(P!==_&&P.push(H),_.push(L))}return _}function Pa(e,i){return i=bi(i,e),e=hh(e,i),e==null||delete e[Wr(Tr(i))]}function Uu(e,i,o,c){return js(e,i,o(qi(e,i)),c)}function Fn(e,i,o,c){for(var l=e.length,d=c?l:-1;(c?d--:++d<l)&&i(e[d],d,e););return o?Rr(e,c?0:d,c?d+1:l):Rr(e,c?d+1:0,c?l:d)}function Mu(e,i){var o=e;return o instanceof Pe&&(o=o.value()),ta(i,function(c,l){return l.func.apply(l.thisArg,gi([c],l.args))},o)}function Oa(e,i,o){var c=e.length;if(c<2)return c?wi(e[0]):[];for(var l=-1,d=T(c);++l<c;)for(var m=e[l],_=-1;++_<c;)_!=l&&(d[l]=As(d[l]||m,e[_],i,o));return wi(Bt(d,1),i,o)}function Lu(e,i,o){for(var c=-1,l=e.length,d=i.length,m={};++c<l;){var _=c<d?i[c]:r;o(m,e[c],_)}return m}function Ra(e){return _t(e)?e:[]}function Ta(e){return typeof e=="function"?e:ur}function bi(e,i){return ge(e)?e:Ma(e,i)?[e]:dh(qe(e))}var Gd=Ee;function _i(e,i,o){var c=e.length;return o=o===r?c:o,!i&&o>=c?e:Rr(e,i,o)}var zu=jp||function(e){return Oe.clearTimeout(e)};function ku(e,i){if(i)return e.slice();var o=e.length,c=cu?cu(o):new e.constructor(o);return e.copy(c),c}function Na(e){var i=new e.constructor(e.byteLength);return new $n(i).set(new $n(e)),i}function Wd(e,i){var o=i?Na(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.byteLength)}function Jd(e){var i=new e.constructor(e.source,Er.exec(e));return i.lastIndex=e.lastIndex,i}function Qd(e){return Ts?Ge(Ts.call(e)):{}}function Hu(e,i){var o=i?Na(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.length)}function Ku(e,i){if(e!==i){var o=e!==r,c=e===null,l=e===e,d=mr(e),m=i!==r,_=i===null,P=i===i,M=mr(i);if(!_&&!M&&!d&&e>i||d&&m&&P&&!_&&!M||c&&m&&P||!o&&P||!l)return 1;if(!c&&!d&&!M&&e<i||M&&o&&l&&!c&&!d||_&&o&&l||!m&&l||!P)return-1}return 0}function Yd(e,i,o){for(var c=-1,l=e.criteria,d=i.criteria,m=l.length,_=o.length;++c<m;){var P=Ku(l[c],d[c]);if(P){if(c>=_)return P;var M=o[c];return P*(M=="desc"?-1:1)}}return e.index-i.index}function Vu(e,i,o,c){for(var l=-1,d=e.length,m=o.length,_=-1,P=i.length,M=Ut(d-m,0),L=T(P+M),H=!c;++_<P;)L[_]=i[_];for(;++l<m;)(H||l<d)&&(L[o[l]]=e[l]);for(;M--;)L[_++]=e[l++];return L}function Bu(e,i,o,c){for(var l=-1,d=e.length,m=-1,_=o.length,P=-1,M=i.length,L=Ut(d-_,0),H=T(L+M),J=!c;++l<L;)H[l]=e[l];for(var re=l;++P<M;)H[re+P]=i[P];for(;++m<_;)(J||l<d)&&(H[re+o[m]]=e[l++]);return H}function or(e,i){var o=-1,c=e.length;for(i||(i=T(c));++o<c;)i[o]=e[o];return i}function Gr(e,i,o,c){var l=!o;o||(o={});for(var d=-1,m=i.length;++d<m;){var _=i[d],P=c?c(o[_],e[_],_,o,e):r;P===r&&(P=e[_]),l?ti(o,_,P):Ns(o,_,P)}return o}function Zd(e,i){return Gr(e,Ua(e),i)}function Xd(e,i){return Gr(e,sh(e),i)}function Gn(e,i){return function(o,c){var l=ge(o)?sp:_d,d=i?i():{};return l(o,e,ne(c,2),d)}}function cs(e){return Ee(function(i,o){var c=-1,l=o.length,d=l>1?o[l-1]:r,m=l>2?o[2]:r;for(d=e.length>3&&typeof d=="function"?(l--,d):r,m&&er(o[0],o[1],m)&&(d=l<3?r:d,l=1),i=Ge(i);++c<l;){var _=o[c];_&&e(i,_,c,d)}return i})}function Fu(e,i){return function(o,c){if(o==null)return o;if(!ar(o))return e(o,c);for(var l=o.length,d=i?l:-1,m=Ge(o);(i?d--:++d<l)&&c(m[d],d,m)!==!1;);return o}}function Gu(e){return function(i,o,c){for(var l=-1,d=Ge(i),m=c(i),_=m.length;_--;){var P=m[e?_:++l];if(o(d[P],P,d)===!1)break}return i}}function eg(e,i,o){var c=i&ie,l=Ds(e);function d(){var m=this&&this!==Oe&&this instanceof d?l:e;return m.apply(c?o:this,arguments)}return d}function Wu(e){return function(i){i=qe(i);var o=ts(i)?Dr(i):r,c=o?o[0]:i.charAt(0),l=o?_i(o,1).join(""):i.slice(1);return c[e]()+l}}function us(e){return function(i){return ta(Fh(Bh(i).replace(Es,"")),e,"")}}function Ds(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var o=as(e.prototype),c=e.apply(o,i);return ct(c)?c:o}}function tg(e,i,o){var c=Ds(e);function l(){for(var d=arguments.length,m=T(d),_=d,P=hs(l);_--;)m[_]=arguments[_];var M=d<3&&m[0]!==P&&m[d-1]!==P?[]:yi(m,P);if(d-=M.length,d<o)return Xu(e,i,Wn,l.placeholder,r,m,M,r,r,o-d);var L=this&&this!==Oe&&this instanceof l?c:e;return Lt(L,this,m)}return l}function Ju(e){return function(i,o,c){var l=Ge(i);if(!ar(i)){var d=ne(o,3);i=zt(i),o=function(_){return d(l[_],_,l)}}var m=e(i,o,c);return m>-1?l[d?i[m]:m]:r}}function Qu(e){return ii(function(i){var o=i.length,c=o,l=Pr.prototype.thru;for(e&&i.reverse();c--;){var d=i[c];if(typeof d!="function")throw new Sr(f);if(l&&!m&&Zn(d)=="wrapper")var m=new Pr([],!0)}for(c=m?c:o;++c<o;){d=i[c];var _=Zn(d),P=_=="wrapper"?Da(d):r;P&&La(P[0])&&P[1]==(K|he|pe|Q)&&!P[4].length&&P[9]==1?m=m[Zn(P[0])].apply(m,P[3]):m=d.length==1&&La(d)?m[_]():m.thru(d)}return function(){var M=arguments,L=M[0];if(m&&M.length==1&&ge(L))return m.plant(L).value();for(var H=0,J=o?i[H].apply(this,M):L;++H<o;)J=i[H].call(this,J);return J}})}function Wn(e,i,o,c,l,d,m,_,P,M){var L=i&K,H=i&ie,J=i&ye,re=i&(he|fe),oe=i&ve,be=J?r:Ds(e);function ae(){for(var xe=arguments.length,Re=T(xe),wr=xe;wr--;)Re[wr]=arguments[wr];if(re)var tr=hs(ae),br=pp(Re,tr);if(c&&(Re=Vu(Re,c,l,re)),d&&(Re=Bu(Re,d,m,re)),xe-=br,re&&xe<M){var Et=yi(Re,tr);return Xu(e,i,Wn,ae.placeholder,o,Re,Et,_,P,M-xe)}var Mr=H?o:this,ai=J?Mr[e]:e;return xe=Re.length,_?Re=_g(Re,_):oe&&xe>1&&Re.reverse(),L&&P<xe&&(Re.length=P),this&&this!==Oe&&this instanceof ae&&(ai=be||Ds(ai)),ai.apply(Mr,Re)}return ae}function Yu(e,i){return function(o,c){return Td(o,e,i(c),{})}}function Jn(e,i){return function(o,c){var l;if(o===r&&c===r)return i;if(o!==r&&(l=o),c!==r){if(l===r)return c;typeof o=="string"||typeof c=="string"?(o=vr(o),c=vr(c)):(o=qu(o),c=qu(c)),l=e(o,c)}return l}}function Aa(e){return ii(function(i){return i=it(i,yr(ne())),Ee(function(o){var c=this;return e(i,function(l){return Lt(l,c,o)})})})}function Qn(e,i){i=i===r?" ":vr(i);var o=i.length;if(o<2)return o?xa(i,e):i;var c=xa(i,qn(e/rs(i)));return ts(i)?_i(Dr(c),0,e).join(""):c.slice(0,e)}function rg(e,i,o,c){var l=i&ie,d=Ds(e);function m(){for(var _=-1,P=arguments.length,M=-1,L=c.length,H=T(L+P),J=this&&this!==Oe&&this instanceof m?d:e;++M<L;)H[M]=c[M];for(;P--;)H[M++]=arguments[++_];return Lt(J,l?o:this,H)}return m}function Zu(e){return function(i,o,c){return c&&typeof c!="number"&&er(i,o,c)&&(o=c=r),i=oi(i),o===r?(o=i,i=0):o=oi(o),c=c===r?i<o?1:-1:oi(c),kd(i,o,c,e)}}function Yn(e){return function(i,o){return typeof i=="string"&&typeof o=="string"||(i=Nr(i),o=Nr(o)),e(i,o)}}function Xu(e,i,o,c,l,d,m,_,P,M){var L=i&he,H=L?m:r,J=L?r:m,re=L?d:r,oe=L?r:d;i|=L?pe:j,i&=~(L?j:pe),i&ue||(i&=~(ie|ye));var be=[e,i,l,re,H,oe,J,_,P,M],ae=o.apply(r,be);return La(e)&&lh(ae,be),ae.placeholder=c,fh(ae,e,i)}function $a(e){var i=qt[e];return function(o,c){if(o=Nr(o),c=c==null?0:Gt(me(c),292),c&&fu(o)){var l=(qe(o)+"e").split("e"),d=i(l[0]+"e"+(+l[1]+c));return l=(qe(d)+"e").split("e"),+(l[0]+"e"+(+l[1]-c))}return i(o)}}var ig=ns&&1/Pn(new ns([,-0]))[1]==Ne?function(e){return new ns(e)}:ec;function eh(e){return function(i){var o=Wt(i);return o==we?ca(i):o==De?bp(i):fp(i,e(i))}}function ri(e,i,o,c,l,d,m,_){var P=i&ye;if(!P&&typeof e!="function")throw new Sr(f);var M=c?c.length:0;if(M||(i&=~(pe|j),c=l=r),m=m===r?m:Ut(me(m),0),_=_===r?_:me(_),M-=l?l.length:0,i&j){var L=c,H=l;c=l=r}var J=P?r:Da(e),re=[e,i,o,c,l,L,H,d,m,_];if(J&&mg(re,J),e=re[0],i=re[1],o=re[2],c=re[3],l=re[4],_=re[9]=re[9]===r?P?0:e.length:Ut(re[9]-M,0),!_&&i&(he|fe)&&(i&=~(he|fe)),!i||i==ie)var oe=eg(e,i,o);else i==he||i==fe?oe=tg(e,i,_):(i==pe||i==(ie|pe))&&!l.length?oe=rg(e,i,o,c):oe=Wn.apply(r,re);var be=J?ju:lh;return fh(be(oe,re),e,i)}function th(e,i,o,c){return e===r||Ur(e,ss[o])&&!Me.call(c,o)?i:e}function rh(e,i,o,c,l,d){return ct(e)&&ct(i)&&(d.set(i,e),Vn(e,i,r,rh,d),d.delete(i)),e}function sg(e){return Ms(e)?r:e}function ih(e,i,o,c,l,d){var m=o&$,_=e.length,P=i.length;if(_!=P&&!(m&&P>_))return!1;var M=d.get(e),L=d.get(i);if(M&&L)return M==i&&L==e;var H=-1,J=!0,re=o&B?new ji:r;for(d.set(e,i),d.set(i,e);++H<_;){var oe=e[H],be=i[H];if(c)var ae=m?c(be,oe,H,i,e,d):c(oe,be,H,e,i,d);if(ae!==r){if(ae)continue;J=!1;break}if(re){if(!ra(i,function(xe,Re){if(!xs(re,Re)&&(oe===xe||l(oe,xe,o,c,d)))return re.push(Re)})){J=!1;break}}else if(!(oe===be||l(oe,be,o,c,d))){J=!1;break}}return d.delete(e),d.delete(i),J}function ng(e,i,o,c,l,d,m){switch(o){case Ke:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case $e:return!(e.byteLength!=i.byteLength||!d(new $n(e),new $n(i)));case A:case R:case Ae:return Ur(+e,+i);case E:return e.name==i.name&&e.message==i.message;case nt:case Je:return e==i+"";case we:var _=ca;case De:var P=c&$;if(_||(_=Pn),e.size!=i.size&&!P)return!1;var M=m.get(e);if(M)return M==i;c|=B,m.set(e,i);var L=ih(_(e),_(i),c,l,d,m);return m.delete(e),L;case Qe:if(Ts)return Ts.call(e)==Ts.call(i)}return!1}function og(e,i,o,c,l,d){var m=o&$,_=Ca(e),P=_.length,M=Ca(i),L=M.length;if(P!=L&&!m)return!1;for(var H=P;H--;){var J=_[H];if(!(m?J in i:Me.call(i,J)))return!1}var re=d.get(e),oe=d.get(i);if(re&&oe)return re==i&&oe==e;var be=!0;d.set(e,i),d.set(i,e);for(var ae=m;++H<P;){J=_[H];var xe=e[J],Re=i[J];if(c)var wr=m?c(Re,xe,J,i,e,d):c(xe,Re,J,e,i,d);if(!(wr===r?xe===Re||l(xe,Re,o,c,d):wr)){be=!1;break}ae||(ae=J=="constructor")}if(be&&!ae){var tr=e.constructor,br=i.constructor;tr!=br&&"constructor"in e&&"constructor"in i&&!(typeof tr=="function"&&tr instanceof tr&&typeof br=="function"&&br instanceof br)&&(be=!1)}return d.delete(e),d.delete(i),be}function ii(e){return ka(uh(e,r,mh),e+"")}function Ca(e){return Iu(e,zt,Ua)}function ja(e){return Iu(e,cr,sh)}var Da=Mn?function(e){return Mn.get(e)}:ec;function Zn(e){for(var i=e.name+"",o=os[i],c=Me.call(os,i)?o.length:0;c--;){var l=o[c],d=l.func;if(d==null||d==e)return l.name}return i}function hs(e){var i=Me.call(p,"placeholder")?p:e;return i.placeholder}function ne(){var e=p.iteratee||Za;return e=e===Za?Pu:e,arguments.length?e(arguments[0],arguments[1]):e}function Xn(e,i){var o=e.__data__;return dg(i)?o[typeof i=="string"?"string":"hash"]:o.map}function qa(e){for(var i=zt(e),o=i.length;o--;){var c=i[o],l=e[c];i[o]=[c,l,ah(l)]}return i}function Ui(e,i){var o=vp(e,i);return Su(o)?o:r}function ag(e){var i=Me.call(e,$i),o=e[$i];try{e[$i]=r;var c=!0}catch{}var l=Nn.call(e);return c&&(i?e[$i]=o:delete e[$i]),l}var Ua=ha?function(e){return e==null?[]:(e=Ge(e),di(ha(e),function(i){return hu.call(e,i)}))}:tc,sh=ha?function(e){for(var i=[];e;)gi(i,Ua(e)),e=Cn(e);return i}:tc,Wt=Xt;(la&&Wt(new la(new ArrayBuffer(1)))!=Ke||Ps&&Wt(new Ps)!=we||fa&&Wt(fa.resolve())!=St||ns&&Wt(new ns)!=De||Os&&Wt(new Os)!=ze)&&(Wt=function(e){var i=Xt(e),o=i==Se?e.constructor:r,c=o?Mi(o):"";if(c)switch(c){case Kp:return Ke;case Vp:return we;case Bp:return St;case Fp:return De;case Gp:return ze}return i});function cg(e,i,o){for(var c=-1,l=o.length;++c<l;){var d=o[c],m=d.size;switch(d.type){case"drop":e+=m;break;case"dropRight":i-=m;break;case"take":i=Gt(i,e+m);break;case"takeRight":e=Ut(e,i-m);break}}return{start:e,end:i}}function ug(e){var i=e.match(We);return i?i[1].split(Nt):[]}function nh(e,i,o){i=bi(i,e);for(var c=-1,l=i.length,d=!1;++c<l;){var m=Wr(i[c]);if(!(d=e!=null&&o(e,m)))break;e=e[m]}return d||++c!=l?d:(l=e==null?0:e.length,!!l&&oo(l)&&si(m,l)&&(ge(e)||Li(e)))}function hg(e){var i=e.length,o=new e.constructor(i);return i&&typeof e[0]=="string"&&Me.call(e,"index")&&(o.index=e.index,o.input=e.input),o}function oh(e){return typeof e.constructor=="function"&&!qs(e)?as(Cn(e)):{}}function lg(e,i,o){var c=e.constructor;switch(i){case $e:return Na(e);case A:case R:return new c(+e);case Ke:return Wd(e,o);case ht:case Ue:case Pt:case Dt:case Kt:case Vt:case Mt:case Qt:case sr:return Hu(e,o);case we:return new c;case Ae:case Je:return new c(e);case nt:return Jd(e);case De:return new c;case Qe:return Qd(e)}}function fg(e,i){var o=i.length;if(!o)return e;var c=o-1;return i[c]=(o>1?"& ":"")+i[c],i=i.join(o>2?", ":" "),e.replace(yt,`{
/* [wrapped with `+i+`] */
`)}function pg(e){return ge(e)||Li(e)||!!(lu&&e&&e[lu])}function si(e,i){var o=typeof e;return i=i??Y,!!i&&(o=="number"||o!="symbol"&&zo.test(e))&&e>-1&&e%1==0&&e<i}function er(e,i,o){if(!ct(o))return!1;var c=typeof i;return(c=="number"?ar(o)&&si(i,o.length):c=="string"&&i in o)?Ur(o[i],e):!1}function Ma(e,i){if(ge(e))return!1;var o=typeof e;return o=="number"||o=="symbol"||o=="boolean"||e==null||mr(e)?!0:Ot.test(e)||!rt.test(e)||i!=null&&e in Ge(i)}function dg(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function La(e){var i=Zn(e),o=p[i];if(typeof o!="function"||!(i in Pe.prototype))return!1;if(e===o)return!0;var c=Da(o);return!!c&&e===c[0]}function gg(e){return!!au&&au in e}var yg=Rn?ni:rc;function qs(e){var i=e&&e.constructor,o=typeof i=="function"&&i.prototype||ss;return e===o}function ah(e){return e===e&&!ct(e)}function ch(e,i){return function(o){return o==null?!1:o[e]===i&&(i!==r||e in Ge(o))}}function vg(e){var i=so(e,function(c){return o.size===g&&o.clear(),c}),o=i.cache;return i}function mg(e,i){var o=e[1],c=i[1],l=o|c,d=l<(ie|ye|K),m=c==K&&o==he||c==K&&o==Q&&e[7].length<=i[8]||c==(K|Q)&&i[7].length<=i[8]&&o==he;if(!(d||m))return e;c&ie&&(e[2]=i[2],l|=o&ie?0:ue);var _=i[3];if(_){var P=e[3];e[3]=P?Vu(P,_,i[4]):_,e[4]=P?yi(e[3],b):i[4]}return _=i[5],_&&(P=e[5],e[5]=P?Bu(P,_,i[6]):_,e[6]=P?yi(e[5],b):i[6]),_=i[7],_&&(e[7]=_),c&K&&(e[8]=e[8]==null?i[8]:Gt(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=l,e}function wg(e){var i=[];if(e!=null)for(var o in Ge(e))i.push(o);return i}function bg(e){return Nn.call(e)}function uh(e,i,o){return i=Ut(i===r?e.length-1:i,0),function(){for(var c=arguments,l=-1,d=Ut(c.length-i,0),m=T(d);++l<d;)m[l]=c[i+l];l=-1;for(var _=T(i+1);++l<i;)_[l]=c[l];return _[i]=o(m),Lt(e,this,_)}}function hh(e,i){return i.length<2?e:qi(e,Rr(i,0,-1))}function _g(e,i){for(var o=e.length,c=Gt(i.length,o),l=or(e);c--;){var d=i[c];e[c]=si(d,o)?l[d]:r}return e}function za(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var lh=ph(ju),Us=qp||function(e,i){return Oe.setTimeout(e,i)},ka=ph(Vd);function fh(e,i,o){var c=i+"";return ka(e,fg(c,Eg(ug(c),o)))}function ph(e){var i=0,o=0;return function(){var c=zp(),l=et-(c-o);if(o=c,l>0){if(++i>=Te)return arguments[0]}else i=0;return e.apply(r,arguments)}}function eo(e,i){var o=-1,c=e.length,l=c-1;for(i=i===r?c:i;++o<i;){var d=Ia(o,l),m=e[d];e[d]=e[o],e[o]=m}return e.length=i,e}var dh=vg(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Rt,function(o,c,l,d){i.push(l?d.replace(jo,"$1"):c||o)}),i});function Wr(e){if(typeof e=="string"||mr(e))return e;var i=e+"";return i=="0"&&1/e==-Ne?"-0":i}function Mi(e){if(e!=null){try{return Tn.call(e)}catch{}try{return e+""}catch{}}return""}function Eg(e,i){return xr(Hr,function(o){var c="_."+o[0];i&o[1]&&!xn(e,c)&&e.push(c)}),e.sort()}function gh(e){if(e instanceof Pe)return e.clone();var i=new Pr(e.__wrapped__,e.__chain__);return i.__actions__=or(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function Ig(e,i,o){(o?er(e,i,o):i===r)?i=1:i=Ut(me(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var l=0,d=0,m=T(qn(c/i));l<c;)m[d++]=Rr(e,l,l+=i);return m}function xg(e){for(var i=-1,o=e==null?0:e.length,c=0,l=[];++i<o;){var d=e[i];d&&(l[c++]=d)}return l}function Sg(){var e=arguments.length;if(!e)return[];for(var i=T(e-1),o=arguments[0],c=e;c--;)i[c-1]=arguments[c];return gi(ge(o)?or(o):[o],Bt(i,1))}var Pg=Ee(function(e,i){return _t(e)?As(e,Bt(i,1,_t,!0)):[]}),Og=Ee(function(e,i){var o=Tr(i);return _t(o)&&(o=r),_t(e)?As(e,Bt(i,1,_t,!0),ne(o,2)):[]}),Rg=Ee(function(e,i){var o=Tr(i);return _t(o)&&(o=r),_t(e)?As(e,Bt(i,1,_t,!0),r,o):[]});function Tg(e,i,o){var c=e==null?0:e.length;return c?(i=o||i===r?1:me(i),Rr(e,i<0?0:i,c)):[]}function Ng(e,i,o){var c=e==null?0:e.length;return c?(i=o||i===r?1:me(i),i=c-i,Rr(e,0,i<0?0:i)):[]}function Ag(e,i){return e&&e.length?Fn(e,ne(i,3),!0,!0):[]}function $g(e,i){return e&&e.length?Fn(e,ne(i,3),!0):[]}function Cg(e,i,o,c){var l=e==null?0:e.length;return l?(o&&typeof o!="number"&&er(e,i,o)&&(o=0,c=l),Sd(e,i,o,c)):[]}function yh(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var l=o==null?0:me(o);return l<0&&(l=Ut(c+l,0)),Sn(e,ne(i,3),l)}function vh(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var l=c-1;return o!==r&&(l=me(o),l=o<0?Ut(c+l,0):Gt(l,c-1)),Sn(e,ne(i,3),l,!0)}function mh(e){var i=e==null?0:e.length;return i?Bt(e,1):[]}function jg(e){var i=e==null?0:e.length;return i?Bt(e,Ne):[]}function Dg(e,i){var o=e==null?0:e.length;return o?(i=i===r?1:me(i),Bt(e,i)):[]}function qg(e){for(var i=-1,o=e==null?0:e.length,c={};++i<o;){var l=e[i];c[l[0]]=l[1]}return c}function wh(e){return e&&e.length?e[0]:r}function Ug(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var l=o==null?0:me(o);return l<0&&(l=Ut(c+l,0)),es(e,i,l)}function Mg(e){var i=e==null?0:e.length;return i?Rr(e,0,-1):[]}var Lg=Ee(function(e){var i=it(e,Ra);return i.length&&i[0]===e[0]?ma(i):[]}),zg=Ee(function(e){var i=Tr(e),o=it(e,Ra);return i===Tr(o)?i=r:o.pop(),o.length&&o[0]===e[0]?ma(o,ne(i,2)):[]}),kg=Ee(function(e){var i=Tr(e),o=it(e,Ra);return i=typeof i=="function"?i:r,i&&o.pop(),o.length&&o[0]===e[0]?ma(o,r,i):[]});function Hg(e,i){return e==null?"":Mp.call(e,i)}function Tr(e){var i=e==null?0:e.length;return i?e[i-1]:r}function Kg(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var l=c;return o!==r&&(l=me(o),l=l<0?Ut(c+l,0):Gt(l,c-1)),i===i?Ep(e,i,l):Sn(e,Xc,l,!0)}function Vg(e,i){return e&&e.length?Nu(e,me(i)):r}var Bg=Ee(bh);function bh(e,i){return e&&e.length&&i&&i.length?Ea(e,i):e}function Fg(e,i,o){return e&&e.length&&i&&i.length?Ea(e,i,ne(o,2)):e}function Gg(e,i,o){return e&&e.length&&i&&i.length?Ea(e,i,r,o):e}var Wg=ii(function(e,i){var o=e==null?0:e.length,c=da(e,i);return Cu(e,it(i,function(l){return si(l,o)?+l:l}).sort(Ku)),c});function Jg(e,i){var o=[];if(!(e&&e.length))return o;var c=-1,l=[],d=e.length;for(i=ne(i,3);++c<d;){var m=e[c];i(m,c,e)&&(o.push(m),l.push(c))}return Cu(e,l),o}function Ha(e){return e==null?e:Hp.call(e)}function Qg(e,i,o){var c=e==null?0:e.length;return c?(o&&typeof o!="number"&&er(e,i,o)?(i=0,o=c):(i=i==null?0:me(i),o=o===r?c:me(o)),Rr(e,i,o)):[]}function Yg(e,i){return Bn(e,i)}function Zg(e,i,o){return Sa(e,i,ne(o,2))}function Xg(e,i){var o=e==null?0:e.length;if(o){var c=Bn(e,i);if(c<o&&Ur(e[c],i))return c}return-1}function ey(e,i){return Bn(e,i,!0)}function ty(e,i,o){return Sa(e,i,ne(o,2),!0)}function ry(e,i){var o=e==null?0:e.length;if(o){var c=Bn(e,i,!0)-1;if(Ur(e[c],i))return c}return-1}function iy(e){return e&&e.length?Du(e):[]}function sy(e,i){return e&&e.length?Du(e,ne(i,2)):[]}function ny(e){var i=e==null?0:e.length;return i?Rr(e,1,i):[]}function oy(e,i,o){return e&&e.length?(i=o||i===r?1:me(i),Rr(e,0,i<0?0:i)):[]}function ay(e,i,o){var c=e==null?0:e.length;return c?(i=o||i===r?1:me(i),i=c-i,Rr(e,i<0?0:i,c)):[]}function cy(e,i){return e&&e.length?Fn(e,ne(i,3),!1,!0):[]}function uy(e,i){return e&&e.length?Fn(e,ne(i,3)):[]}var hy=Ee(function(e){return wi(Bt(e,1,_t,!0))}),ly=Ee(function(e){var i=Tr(e);return _t(i)&&(i=r),wi(Bt(e,1,_t,!0),ne(i,2))}),fy=Ee(function(e){var i=Tr(e);return i=typeof i=="function"?i:r,wi(Bt(e,1,_t,!0),r,i)});function py(e){return e&&e.length?wi(e):[]}function dy(e,i){return e&&e.length?wi(e,ne(i,2)):[]}function gy(e,i){return i=typeof i=="function"?i:r,e&&e.length?wi(e,r,i):[]}function Ka(e){if(!(e&&e.length))return[];var i=0;return e=di(e,function(o){if(_t(o))return i=Ut(o.length,i),!0}),oa(i,function(o){return it(e,ia(o))})}function _h(e,i){if(!(e&&e.length))return[];var o=Ka(e);return i==null?o:it(o,function(c){return Lt(i,r,c)})}var yy=Ee(function(e,i){return _t(e)?As(e,i):[]}),vy=Ee(function(e){return Oa(di(e,_t))}),my=Ee(function(e){var i=Tr(e);return _t(i)&&(i=r),Oa(di(e,_t),ne(i,2))}),wy=Ee(function(e){var i=Tr(e);return i=typeof i=="function"?i:r,Oa(di(e,_t),r,i)}),by=Ee(Ka);function _y(e,i){return Lu(e||[],i||[],Ns)}function Ey(e,i){return Lu(e||[],i||[],js)}var Iy=Ee(function(e){var i=e.length,o=i>1?e[i-1]:r;return o=typeof o=="function"?(e.pop(),o):r,_h(e,o)});function Eh(e){var i=p(e);return i.__chain__=!0,i}function xy(e,i){return i(e),e}function to(e,i){return i(e)}var Sy=ii(function(e){var i=e.length,o=i?e[0]:0,c=this.__wrapped__,l=function(d){return da(d,e)};return i>1||this.__actions__.length||!(c instanceof Pe)||!si(o)?this.thru(l):(c=c.slice(o,+o+(i?1:0)),c.__actions__.push({func:to,args:[l],thisArg:r}),new Pr(c,this.__chain__).thru(function(d){return i&&!d.length&&d.push(r),d}))});function Py(){return Eh(this)}function Oy(){return new Pr(this.value(),this.__chain__)}function Ry(){this.__values__===r&&(this.__values__=qh(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function Ty(){return this}function Ny(e){for(var i,o=this;o instanceof zn;){var c=gh(o);c.__index__=0,c.__values__=r,i?l.__wrapped__=c:i=c;var l=c;o=o.__wrapped__}return l.__wrapped__=e,i}function Ay(){var e=this.__wrapped__;if(e instanceof Pe){var i=e;return this.__actions__.length&&(i=new Pe(this)),i=i.reverse(),i.__actions__.push({func:to,args:[Ha],thisArg:r}),new Pr(i,this.__chain__)}return this.thru(Ha)}function $y(){return Mu(this.__wrapped__,this.__actions__)}var Cy=Gn(function(e,i,o){Me.call(e,o)?++e[o]:ti(e,o,1)});function jy(e,i,o){var c=ge(e)?Yc:xd;return o&&er(e,i,o)&&(i=r),c(e,ne(i,3))}function Dy(e,i){var o=ge(e)?di:_u;return o(e,ne(i,3))}var qy=Ju(yh),Uy=Ju(vh);function My(e,i){return Bt(ro(e,i),1)}function Ly(e,i){return Bt(ro(e,i),Ne)}function zy(e,i,o){return o=o===r?1:me(o),Bt(ro(e,i),o)}function Ih(e,i){var o=ge(e)?xr:mi;return o(e,ne(i,3))}function xh(e,i){var o=ge(e)?np:bu;return o(e,ne(i,3))}var ky=Gn(function(e,i,o){Me.call(e,o)?e[o].push(i):ti(e,o,[i])});function Hy(e,i,o,c){e=ar(e)?e:fs(e),o=o&&!c?me(o):0;var l=e.length;return o<0&&(o=Ut(l+o,0)),ao(e)?o<=l&&e.indexOf(i,o)>-1:!!l&&es(e,i,o)>-1}var Ky=Ee(function(e,i,o){var c=-1,l=typeof i=="function",d=ar(e)?T(e.length):[];return mi(e,function(m){d[++c]=l?Lt(i,m,o):$s(m,i,o)}),d}),Vy=Gn(function(e,i,o){ti(e,o,i)});function ro(e,i){var o=ge(e)?it:Ou;return o(e,ne(i,3))}function By(e,i,o,c){return e==null?[]:(ge(i)||(i=i==null?[]:[i]),o=c?r:o,ge(o)||(o=o==null?[]:[o]),Au(e,i,o))}var Fy=Gn(function(e,i,o){e[o?0:1].push(i)},function(){return[[],[]]});function Gy(e,i,o){var c=ge(e)?ta:tu,l=arguments.length<3;return c(e,ne(i,4),o,l,mi)}function Wy(e,i,o){var c=ge(e)?op:tu,l=arguments.length<3;return c(e,ne(i,4),o,l,bu)}function Jy(e,i){var o=ge(e)?di:_u;return o(e,no(ne(i,3)))}function Qy(e){var i=ge(e)?yu:Hd;return i(e)}function Yy(e,i,o){(o?er(e,i,o):i===r)?i=1:i=me(i);var c=ge(e)?wd:Kd;return c(e,i)}function Zy(e){var i=ge(e)?bd:Bd;return i(e)}function Xy(e){if(e==null)return 0;if(ar(e))return ao(e)?rs(e):e.length;var i=Wt(e);return i==we||i==De?e.size:ba(e).length}function ev(e,i,o){var c=ge(e)?ra:Fd;return o&&er(e,i,o)&&(i=r),c(e,ne(i,3))}var tv=Ee(function(e,i){if(e==null)return[];var o=i.length;return o>1&&er(e,i[0],i[1])?i=[]:o>2&&er(i[0],i[1],i[2])&&(i=[i[0]]),Au(e,Bt(i,1),[])}),io=Dp||function(){return Oe.Date.now()};function rv(e,i){if(typeof i!="function")throw new Sr(f);return e=me(e),function(){if(--e<1)return i.apply(this,arguments)}}function Sh(e,i,o){return i=o?r:i,i=e&&i==null?e.length:i,ri(e,K,r,r,r,r,i)}function Ph(e,i){var o;if(typeof i!="function")throw new Sr(f);return e=me(e),function(){return--e>0&&(o=i.apply(this,arguments)),e<=1&&(i=r),o}}var Va=Ee(function(e,i,o){var c=ie;if(o.length){var l=yi(o,hs(Va));c|=pe}return ri(e,c,i,o,l)}),Oh=Ee(function(e,i,o){var c=ie|ye;if(o.length){var l=yi(o,hs(Oh));c|=pe}return ri(i,c,e,o,l)});function Rh(e,i,o){i=o?r:i;var c=ri(e,he,r,r,r,r,r,i);return c.placeholder=Rh.placeholder,c}function Th(e,i,o){i=o?r:i;var c=ri(e,fe,r,r,r,r,r,i);return c.placeholder=Th.placeholder,c}function Nh(e,i,o){var c,l,d,m,_,P,M=0,L=!1,H=!1,J=!0;if(typeof e!="function")throw new Sr(f);i=Nr(i)||0,ct(o)&&(L=!!o.leading,H="maxWait"in o,d=H?Ut(Nr(o.maxWait)||0,i):d,J="trailing"in o?!!o.trailing:J);function re(Et){var Mr=c,ai=l;return c=l=r,M=Et,m=e.apply(ai,Mr),m}function oe(Et){return M=Et,_=Us(xe,i),L?re(Et):m}function be(Et){var Mr=Et-P,ai=Et-M,Jh=i-Mr;return H?Gt(Jh,d-ai):Jh}function ae(Et){var Mr=Et-P,ai=Et-M;return P===r||Mr>=i||Mr<0||H&&ai>=d}function xe(){var Et=io();if(ae(Et))return Re(Et);_=Us(xe,be(Et))}function Re(Et){return _=r,J&&c?re(Et):(c=l=r,m)}function wr(){_!==r&&zu(_),M=0,c=P=l=_=r}function tr(){return _===r?m:Re(io())}function br(){var Et=io(),Mr=ae(Et);if(c=arguments,l=this,P=Et,Mr){if(_===r)return oe(P);if(H)return zu(_),_=Us(xe,i),re(P)}return _===r&&(_=Us(xe,i)),m}return br.cancel=wr,br.flush=tr,br}var iv=Ee(function(e,i){return wu(e,1,i)}),sv=Ee(function(e,i,o){return wu(e,Nr(i)||0,o)});function nv(e){return ri(e,ve)}function so(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new Sr(f);var o=function(){var c=arguments,l=i?i.apply(this,c):c[0],d=o.cache;if(d.has(l))return d.get(l);var m=e.apply(this,c);return o.cache=d.set(l,m)||d,m};return o.cache=new(so.Cache||ei),o}so.Cache=ei;function no(e){if(typeof e!="function")throw new Sr(f);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function ov(e){return Ph(2,e)}var av=Gd(function(e,i){i=i.length==1&&ge(i[0])?it(i[0],yr(ne())):it(Bt(i,1),yr(ne()));var o=i.length;return Ee(function(c){for(var l=-1,d=Gt(c.length,o);++l<d;)c[l]=i[l].call(this,c[l]);return Lt(e,this,c)})}),Ba=Ee(function(e,i){var o=yi(i,hs(Ba));return ri(e,pe,r,i,o)}),Ah=Ee(function(e,i){var o=yi(i,hs(Ah));return ri(e,j,r,i,o)}),cv=ii(function(e,i){return ri(e,Q,r,r,r,i)});function uv(e,i){if(typeof e!="function")throw new Sr(f);return i=i===r?i:me(i),Ee(e,i)}function hv(e,i){if(typeof e!="function")throw new Sr(f);return i=i==null?0:Ut(me(i),0),Ee(function(o){var c=o[i],l=_i(o,0,i);return c&&gi(l,c),Lt(e,this,l)})}function lv(e,i,o){var c=!0,l=!0;if(typeof e!="function")throw new Sr(f);return ct(o)&&(c="leading"in o?!!o.leading:c,l="trailing"in o?!!o.trailing:l),Nh(e,i,{leading:c,maxWait:i,trailing:l})}function fv(e){return Sh(e,1)}function pv(e,i){return Ba(Ta(i),e)}function dv(){if(!arguments.length)return[];var e=arguments[0];return ge(e)?e:[e]}function gv(e){return Or(e,U)}function yv(e,i){return i=typeof i=="function"?i:r,Or(e,U,i)}function vv(e){return Or(e,S|U)}function mv(e,i){return i=typeof i=="function"?i:r,Or(e,S|U,i)}function wv(e,i){return i==null||mu(e,i,zt(i))}function Ur(e,i){return e===i||e!==e&&i!==i}var bv=Yn(va),_v=Yn(function(e,i){return e>=i}),Li=xu(function(){return arguments}())?xu:function(e){return vt(e)&&Me.call(e,"callee")&&!hu.call(e,"callee")},ge=T.isArray,Ev=Zt?yr(Zt):Nd;function ar(e){return e!=null&&oo(e.length)&&!ni(e)}function _t(e){return vt(e)&&ar(e)}function Iv(e){return e===!0||e===!1||vt(e)&&Xt(e)==A}var Ei=Up||rc,xv=jr?yr(jr):Ad;function Sv(e){return vt(e)&&e.nodeType===1&&!Ms(e)}function Pv(e){if(e==null)return!0;if(ar(e)&&(ge(e)||typeof e=="string"||typeof e.splice=="function"||Ei(e)||ls(e)||Li(e)))return!e.length;var i=Wt(e);if(i==we||i==De)return!e.size;if(qs(e))return!ba(e).length;for(var o in e)if(Me.call(e,o))return!1;return!0}function Ov(e,i){return Cs(e,i)}function Rv(e,i,o){o=typeof o=="function"?o:r;var c=o?o(e,i):r;return c===r?Cs(e,i,r,o):!!c}function Fa(e){if(!vt(e))return!1;var i=Xt(e);return i==E||i==h||typeof e.message=="string"&&typeof e.name=="string"&&!Ms(e)}function Tv(e){return typeof e=="number"&&fu(e)}function ni(e){if(!ct(e))return!1;var i=Xt(e);return i==te||i==ce||i==C||i==mt}function $h(e){return typeof e=="number"&&e==me(e)}function oo(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Y}function ct(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function vt(e){return e!=null&&typeof e=="object"}var Ch=Ir?yr(Ir):Cd;function Nv(e,i){return e===i||wa(e,i,qa(i))}function Av(e,i,o){return o=typeof o=="function"?o:r,wa(e,i,qa(i),o)}function $v(e){return jh(e)&&e!=+e}function Cv(e){if(yg(e))throw new le(u);return Su(e)}function jv(e){return e===null}function Dv(e){return e==null}function jh(e){return typeof e=="number"||vt(e)&&Xt(e)==Ae}function Ms(e){if(!vt(e)||Xt(e)!=Se)return!1;var i=Cn(e);if(i===null)return!0;var o=Me.call(i,"constructor")&&i.constructor;return typeof o=="function"&&o instanceof o&&Tn.call(o)==Ap}var Ga=Br?yr(Br):jd;function qv(e){return $h(e)&&e>=-Y&&e<=Y}var Dh=Is?yr(Is):Dd;function ao(e){return typeof e=="string"||!ge(e)&&vt(e)&&Xt(e)==Je}function mr(e){return typeof e=="symbol"||vt(e)&&Xt(e)==Qe}var ls=Ai?yr(Ai):qd;function Uv(e){return e===r}function Mv(e){return vt(e)&&Wt(e)==ze}function Lv(e){return vt(e)&&Xt(e)==Ye}var zv=Yn(_a),kv=Yn(function(e,i){return e<=i});function qh(e){if(!e)return[];if(ar(e))return ao(e)?Dr(e):or(e);if(Ss&&e[Ss])return wp(e[Ss]());var i=Wt(e),o=i==we?ca:i==De?Pn:fs;return o(e)}function oi(e){if(!e)return e===0?e:0;if(e=Nr(e),e===Ne||e===-Ne){var i=e<0?-1:1;return i*F}return e===e?e:0}function me(e){var i=oi(e),o=i%1;return i===i?o?i-o:i:0}function Uh(e){return e?Di(me(e),0,G):0}function Nr(e){if(typeof e=="number")return e;if(mr(e))return V;if(ct(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=ct(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=ru(e);var o=Uo.test(e);return o||Lo.test(e)?de(e.slice(2),o?2:8):qo.test(e)?V:+e}function Mh(e){return Gr(e,cr(e))}function Hv(e){return e?Di(me(e),-Y,Y):e===0?e:0}function qe(e){return e==null?"":vr(e)}var Kv=cs(function(e,i){if(qs(i)||ar(i)){Gr(i,zt(i),e);return}for(var o in i)Me.call(i,o)&&Ns(e,o,i[o])}),Lh=cs(function(e,i){Gr(i,cr(i),e)}),co=cs(function(e,i,o,c){Gr(i,cr(i),e,c)}),Vv=cs(function(e,i,o,c){Gr(i,zt(i),e,c)}),Bv=ii(da);function Fv(e,i){var o=as(e);return i==null?o:vu(o,i)}var Gv=Ee(function(e,i){e=Ge(e);var o=-1,c=i.length,l=c>2?i[2]:r;for(l&&er(i[0],i[1],l)&&(c=1);++o<c;)for(var d=i[o],m=cr(d),_=-1,P=m.length;++_<P;){var M=m[_],L=e[M];(L===r||Ur(L,ss[M])&&!Me.call(e,M))&&(e[M]=d[M])}return e}),Wv=Ee(function(e){return e.push(r,rh),Lt(zh,r,e)});function Jv(e,i){return Zc(e,ne(i,3),Fr)}function Qv(e,i){return Zc(e,ne(i,3),ya)}function Yv(e,i){return e==null?e:ga(e,ne(i,3),cr)}function Zv(e,i){return e==null?e:Eu(e,ne(i,3),cr)}function Xv(e,i){return e&&Fr(e,ne(i,3))}function em(e,i){return e&&ya(e,ne(i,3))}function tm(e){return e==null?[]:Kn(e,zt(e))}function rm(e){return e==null?[]:Kn(e,cr(e))}function Wa(e,i,o){var c=e==null?r:qi(e,i);return c===r?o:c}function im(e,i){return e!=null&&nh(e,i,Pd)}function Ja(e,i){return e!=null&&nh(e,i,Od)}var sm=Yu(function(e,i,o){i!=null&&typeof i.toString!="function"&&(i=Nn.call(i)),e[i]=o},Ya(ur)),nm=Yu(function(e,i,o){i!=null&&typeof i.toString!="function"&&(i=Nn.call(i)),Me.call(e,i)?e[i].push(o):e[i]=[o]},ne),om=Ee($s);function zt(e){return ar(e)?gu(e):ba(e)}function cr(e){return ar(e)?gu(e,!0):Ud(e)}function am(e,i){var o={};return i=ne(i,3),Fr(e,function(c,l,d){ti(o,i(c,l,d),c)}),o}function cm(e,i){var o={};return i=ne(i,3),Fr(e,function(c,l,d){ti(o,l,i(c,l,d))}),o}var um=cs(function(e,i,o){Vn(e,i,o)}),zh=cs(function(e,i,o,c){Vn(e,i,o,c)}),hm=ii(function(e,i){var o={};if(e==null)return o;var c=!1;i=it(i,function(d){return d=bi(d,e),c||(c=d.length>1),d}),Gr(e,ja(e),o),c&&(o=Or(o,S|O|U,sg));for(var l=i.length;l--;)Pa(o,i[l]);return o});function lm(e,i){return kh(e,no(ne(i)))}var fm=ii(function(e,i){return e==null?{}:Ld(e,i)});function kh(e,i){if(e==null)return{};var o=it(ja(e),function(c){return[c]});return i=ne(i),$u(e,o,function(c,l){return i(c,l[0])})}function pm(e,i,o){i=bi(i,e);var c=-1,l=i.length;for(l||(l=1,e=r);++c<l;){var d=e==null?r:e[Wr(i[c])];d===r&&(c=l,d=o),e=ni(d)?d.call(e):d}return e}function dm(e,i,o){return e==null?e:js(e,i,o)}function gm(e,i,o,c){return c=typeof c=="function"?c:r,e==null?e:js(e,i,o,c)}var Hh=eh(zt),Kh=eh(cr);function ym(e,i,o){var c=ge(e),l=c||Ei(e)||ls(e);if(i=ne(i,4),o==null){var d=e&&e.constructor;l?o=c?new d:[]:ct(e)?o=ni(d)?as(Cn(e)):{}:o={}}return(l?xr:Fr)(e,function(m,_,P){return i(o,m,_,P)}),o}function vm(e,i){return e==null?!0:Pa(e,i)}function mm(e,i,o){return e==null?e:Uu(e,i,Ta(o))}function wm(e,i,o,c){return c=typeof c=="function"?c:r,e==null?e:Uu(e,i,Ta(o),c)}function fs(e){return e==null?[]:aa(e,zt(e))}function bm(e){return e==null?[]:aa(e,cr(e))}function _m(e,i,o){return o===r&&(o=i,i=r),o!==r&&(o=Nr(o),o=o===o?o:0),i!==r&&(i=Nr(i),i=i===i?i:0),Di(Nr(e),i,o)}function Em(e,i,o){return i=oi(i),o===r?(o=i,i=0):o=oi(o),e=Nr(e),Rd(e,i,o)}function Im(e,i,o){if(o&&typeof o!="boolean"&&er(e,i,o)&&(i=o=r),o===r&&(typeof i=="boolean"?(o=i,i=r):typeof e=="boolean"&&(o=e,e=r)),e===r&&i===r?(e=0,i=1):(e=oi(e),i===r?(i=e,e=0):i=oi(i)),e>i){var c=e;e=i,i=c}if(o||e%1||i%1){var l=pu();return Gt(e+l*(i-e+Be("1e-"+((l+"").length-1))),i)}return Ia(e,i)}var xm=us(function(e,i,o){return i=i.toLowerCase(),e+(o?Vh(i):i)});function Vh(e){return Qa(qe(e).toLowerCase())}function Bh(e){return e=qe(e),e&&e.replace(Yr,dp).replace(Zo,"")}function Sm(e,i,o){e=qe(e),i=vr(i);var c=e.length;o=o===r?c:Di(me(o),0,c);var l=o;return o-=i.length,o>=0&&e.slice(o,l)==i}function Pm(e){return e=qe(e),e&&tt.test(e)?e.replace(Pi,gp):e}function Om(e){return e=qe(e),e&&Tt.test(e)?e.replace(dt,"\\$&"):e}var Rm=us(function(e,i,o){return e+(o?"-":"")+i.toLowerCase()}),Tm=us(function(e,i,o){return e+(o?" ":"")+i.toLowerCase()}),Nm=Wu("toLowerCase");function Am(e,i,o){e=qe(e),i=me(i);var c=i?rs(e):0;if(!i||c>=i)return e;var l=(i-c)/2;return Qn(Un(l),o)+e+Qn(qn(l),o)}function $m(e,i,o){e=qe(e),i=me(i);var c=i?rs(e):0;return i&&c<i?e+Qn(i-c,o):e}function Cm(e,i,o){e=qe(e),i=me(i);var c=i?rs(e):0;return i&&c<i?Qn(i-c,o)+e:e}function jm(e,i,o){return o||i==null?i=0:i&&(i=+i),kp(qe(e).replace(gt,""),i||0)}function Dm(e,i,o){return(o?er(e,i,o):i===r)?i=1:i=me(i),xa(qe(e),i)}function qm(){var e=arguments,i=qe(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var Um=us(function(e,i,o){return e+(o?"_":"")+i.toLowerCase()});function Mm(e,i,o){return o&&typeof o!="number"&&er(e,i,o)&&(i=o=r),o=o===r?G:o>>>0,o?(e=qe(e),e&&(typeof i=="string"||i!=null&&!Ga(i))&&(i=vr(i),!i&&ts(e))?_i(Dr(e),0,o):e.split(i,o)):[]}var Lm=us(function(e,i,o){return e+(o?" ":"")+Qa(i)});function zm(e,i,o){return e=qe(e),o=o==null?0:Di(me(o),0,e.length),i=vr(i),e.slice(o,o+i.length)==i}function km(e,i,o){var c=p.templateSettings;o&&er(e,i,o)&&(i=r),e=qe(e),i=co({},i,c,th);var l=co({},i.imports,c.imports,th),d=zt(l),m=aa(l,d),_,P,M=0,L=i.interpolate||Gi,H="__p += '",J=ua((i.escape||Gi).source+"|"+L.source+"|"+(L===at?Do:Gi).source+"|"+(i.evaluate||Gi).source+"|$","g"),re="//# sourceURL="+(Me.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Xo+"]")+`
`;e.replace(J,function(ae,xe,Re,wr,tr,br){return Re||(Re=wr),H+=e.slice(M,br).replace(ko,yp),xe&&(_=!0,H+=`' +
__e(`+xe+`) +
'`),tr&&(P=!0,H+=`';
`+tr+`;
__p += '`),Re&&(H+=`' +
((__t = (`+Re+`)) == null ? '' : __t) +
'`),M=br+ae.length,ae}),H+=`';
`;var oe=Me.call(i,"variable")&&i.variable;if(!oe)H=`with (obj) {
`+H+`
}
`;else if(Co.test(oe))throw new le(y);H=(P?H.replace(Kr,""):H).replace(Yt,"$1").replace(Qr,"$1;"),H="function("+(oe||"obj")+`) {
`+(oe?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(_?", __e = _.escape":"")+(P?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+H+`return __p
}`;var be=Gh(function(){return je(d,re+"return "+H).apply(r,m)});if(be.source=H,Fa(be))throw be;return be}function Hm(e){return qe(e).toLowerCase()}function Km(e){return qe(e).toUpperCase()}function Vm(e,i,o){if(e=qe(e),e&&(o||i===r))return ru(e);if(!e||!(i=vr(i)))return e;var c=Dr(e),l=Dr(i),d=iu(c,l),m=su(c,l)+1;return _i(c,d,m).join("")}function Bm(e,i,o){if(e=qe(e),e&&(o||i===r))return e.slice(0,ou(e)+1);if(!e||!(i=vr(i)))return e;var c=Dr(e),l=su(c,Dr(i))+1;return _i(c,0,l).join("")}function Fm(e,i,o){if(e=qe(e),e&&(o||i===r))return e.replace(gt,"");if(!e||!(i=vr(i)))return e;var c=Dr(e),l=iu(c,Dr(i));return _i(c,l).join("")}function Gm(e,i){var o=se,c=Ie;if(ct(i)){var l="separator"in i?i.separator:l;o="length"in i?me(i.length):o,c="omission"in i?vr(i.omission):c}e=qe(e);var d=e.length;if(ts(e)){var m=Dr(e);d=m.length}if(o>=d)return e;var _=o-rs(c);if(_<1)return c;var P=m?_i(m,0,_).join(""):e.slice(0,_);if(l===r)return P+c;if(m&&(_+=P.length-_),Ga(l)){if(e.slice(_).search(l)){var M,L=P;for(l.global||(l=ua(l.source,qe(Er.exec(l))+"g")),l.lastIndex=0;M=l.exec(L);)var H=M.index;P=P.slice(0,H===r?_:H)}}else if(e.indexOf(vr(l),_)!=_){var J=P.lastIndexOf(l);J>-1&&(P=P.slice(0,J))}return P+c}function Wm(e){return e=qe(e),e&&lt.test(e)?e.replace(fi,Ip):e}var Jm=us(function(e,i,o){return e+(o?" ":"")+i.toUpperCase()}),Qa=Wu("toUpperCase");function Fh(e,i,o){return e=qe(e),i=o?r:i,i===r?mp(e)?Pp(e):up(e):e.match(i)||[]}var Gh=Ee(function(e,i){try{return Lt(e,r,i)}catch(o){return Fa(o)?o:new le(o)}}),Qm=ii(function(e,i){return xr(i,function(o){o=Wr(o),ti(e,o,Va(e[o],e))}),e});function Ym(e){var i=e==null?0:e.length,o=ne();return e=i?it(e,function(c){if(typeof c[1]!="function")throw new Sr(f);return[o(c[0]),c[1]]}):[],Ee(function(c){for(var l=-1;++l<i;){var d=e[l];if(Lt(d[0],this,c))return Lt(d[1],this,c)}})}function Zm(e){return Id(Or(e,S))}function Ya(e){return function(){return e}}function Xm(e,i){return e==null||e!==e?i:e}var ew=Qu(),tw=Qu(!0);function ur(e){return e}function Za(e){return Pu(typeof e=="function"?e:Or(e,S))}function rw(e){return Ru(Or(e,S))}function iw(e,i){return Tu(e,Or(i,S))}var sw=Ee(function(e,i){return function(o){return $s(o,e,i)}}),nw=Ee(function(e,i){return function(o){return $s(e,o,i)}});function Xa(e,i,o){var c=zt(i),l=Kn(i,c);o==null&&!(ct(i)&&(l.length||!c.length))&&(o=i,i=e,e=this,l=Kn(i,zt(i)));var d=!(ct(o)&&"chain"in o)||!!o.chain,m=ni(e);return xr(l,function(_){var P=i[_];e[_]=P,m&&(e.prototype[_]=function(){var M=this.__chain__;if(d||M){var L=e(this.__wrapped__),H=L.__actions__=or(this.__actions__);return H.push({func:P,args:arguments,thisArg:e}),L.__chain__=M,L}return P.apply(e,gi([this.value()],arguments))})}),e}function ow(){return Oe._===this&&(Oe._=$p),this}function ec(){}function aw(e){return e=me(e),Ee(function(i){return Nu(i,e)})}var cw=Aa(it),uw=Aa(Yc),hw=Aa(ra);function Wh(e){return Ma(e)?ia(Wr(e)):zd(e)}function lw(e){return function(i){return e==null?r:qi(e,i)}}var fw=Zu(),pw=Zu(!0);function tc(){return[]}function rc(){return!1}function dw(){return{}}function gw(){return""}function yw(){return!0}function vw(e,i){if(e=me(e),e<1||e>Y)return[];var o=G,c=Gt(e,G);i=ne(i),e-=G;for(var l=oa(c,i);++o<e;)i(o);return l}function mw(e){return ge(e)?it(e,Wr):mr(e)?[e]:or(dh(qe(e)))}function ww(e){var i=++Np;return qe(e)+i}var bw=Jn(function(e,i){return e+i},0),_w=$a("ceil"),Ew=Jn(function(e,i){return e/i},1),Iw=$a("floor");function xw(e){return e&&e.length?Hn(e,ur,va):r}function Sw(e,i){return e&&e.length?Hn(e,ne(i,2),va):r}function Pw(e){return eu(e,ur)}function Ow(e,i){return eu(e,ne(i,2))}function Rw(e){return e&&e.length?Hn(e,ur,_a):r}function Tw(e,i){return e&&e.length?Hn(e,ne(i,2),_a):r}var Nw=Jn(function(e,i){return e*i},1),Aw=$a("round"),$w=Jn(function(e,i){return e-i},0);function Cw(e){return e&&e.length?na(e,ur):0}function jw(e,i){return e&&e.length?na(e,ne(i,2)):0}return p.after=rv,p.ary=Sh,p.assign=Kv,p.assignIn=Lh,p.assignInWith=co,p.assignWith=Vv,p.at=Bv,p.before=Ph,p.bind=Va,p.bindAll=Qm,p.bindKey=Oh,p.castArray=dv,p.chain=Eh,p.chunk=Ig,p.compact=xg,p.concat=Sg,p.cond=Ym,p.conforms=Zm,p.constant=Ya,p.countBy=Cy,p.create=Fv,p.curry=Rh,p.curryRight=Th,p.debounce=Nh,p.defaults=Gv,p.defaultsDeep=Wv,p.defer=iv,p.delay=sv,p.difference=Pg,p.differenceBy=Og,p.differenceWith=Rg,p.drop=Tg,p.dropRight=Ng,p.dropRightWhile=Ag,p.dropWhile=$g,p.fill=Cg,p.filter=Dy,p.flatMap=My,p.flatMapDeep=Ly,p.flatMapDepth=zy,p.flatten=mh,p.flattenDeep=jg,p.flattenDepth=Dg,p.flip=nv,p.flow=ew,p.flowRight=tw,p.fromPairs=qg,p.functions=tm,p.functionsIn=rm,p.groupBy=ky,p.initial=Mg,p.intersection=Lg,p.intersectionBy=zg,p.intersectionWith=kg,p.invert=sm,p.invertBy=nm,p.invokeMap=Ky,p.iteratee=Za,p.keyBy=Vy,p.keys=zt,p.keysIn=cr,p.map=ro,p.mapKeys=am,p.mapValues=cm,p.matches=rw,p.matchesProperty=iw,p.memoize=so,p.merge=um,p.mergeWith=zh,p.method=sw,p.methodOf=nw,p.mixin=Xa,p.negate=no,p.nthArg=aw,p.omit=hm,p.omitBy=lm,p.once=ov,p.orderBy=By,p.over=cw,p.overArgs=av,p.overEvery=uw,p.overSome=hw,p.partial=Ba,p.partialRight=Ah,p.partition=Fy,p.pick=fm,p.pickBy=kh,p.property=Wh,p.propertyOf=lw,p.pull=Bg,p.pullAll=bh,p.pullAllBy=Fg,p.pullAllWith=Gg,p.pullAt=Wg,p.range=fw,p.rangeRight=pw,p.rearg=cv,p.reject=Jy,p.remove=Jg,p.rest=uv,p.reverse=Ha,p.sampleSize=Yy,p.set=dm,p.setWith=gm,p.shuffle=Zy,p.slice=Qg,p.sortBy=tv,p.sortedUniq=iy,p.sortedUniqBy=sy,p.split=Mm,p.spread=hv,p.tail=ny,p.take=oy,p.takeRight=ay,p.takeRightWhile=cy,p.takeWhile=uy,p.tap=xy,p.throttle=lv,p.thru=to,p.toArray=qh,p.toPairs=Hh,p.toPairsIn=Kh,p.toPath=mw,p.toPlainObject=Mh,p.transform=ym,p.unary=fv,p.union=hy,p.unionBy=ly,p.unionWith=fy,p.uniq=py,p.uniqBy=dy,p.uniqWith=gy,p.unset=vm,p.unzip=Ka,p.unzipWith=_h,p.update=mm,p.updateWith=wm,p.values=fs,p.valuesIn=bm,p.without=yy,p.words=Fh,p.wrap=pv,p.xor=vy,p.xorBy=my,p.xorWith=wy,p.zip=by,p.zipObject=_y,p.zipObjectDeep=Ey,p.zipWith=Iy,p.entries=Hh,p.entriesIn=Kh,p.extend=Lh,p.extendWith=co,Xa(p,p),p.add=bw,p.attempt=Gh,p.camelCase=xm,p.capitalize=Vh,p.ceil=_w,p.clamp=_m,p.clone=gv,p.cloneDeep=vv,p.cloneDeepWith=mv,p.cloneWith=yv,p.conformsTo=wv,p.deburr=Bh,p.defaultTo=Xm,p.divide=Ew,p.endsWith=Sm,p.eq=Ur,p.escape=Pm,p.escapeRegExp=Om,p.every=jy,p.find=qy,p.findIndex=yh,p.findKey=Jv,p.findLast=Uy,p.findLastIndex=vh,p.findLastKey=Qv,p.floor=Iw,p.forEach=Ih,p.forEachRight=xh,p.forIn=Yv,p.forInRight=Zv,p.forOwn=Xv,p.forOwnRight=em,p.get=Wa,p.gt=bv,p.gte=_v,p.has=im,p.hasIn=Ja,p.head=wh,p.identity=ur,p.includes=Hy,p.indexOf=Ug,p.inRange=Em,p.invoke=om,p.isArguments=Li,p.isArray=ge,p.isArrayBuffer=Ev,p.isArrayLike=ar,p.isArrayLikeObject=_t,p.isBoolean=Iv,p.isBuffer=Ei,p.isDate=xv,p.isElement=Sv,p.isEmpty=Pv,p.isEqual=Ov,p.isEqualWith=Rv,p.isError=Fa,p.isFinite=Tv,p.isFunction=ni,p.isInteger=$h,p.isLength=oo,p.isMap=Ch,p.isMatch=Nv,p.isMatchWith=Av,p.isNaN=$v,p.isNative=Cv,p.isNil=Dv,p.isNull=jv,p.isNumber=jh,p.isObject=ct,p.isObjectLike=vt,p.isPlainObject=Ms,p.isRegExp=Ga,p.isSafeInteger=qv,p.isSet=Dh,p.isString=ao,p.isSymbol=mr,p.isTypedArray=ls,p.isUndefined=Uv,p.isWeakMap=Mv,p.isWeakSet=Lv,p.join=Hg,p.kebabCase=Rm,p.last=Tr,p.lastIndexOf=Kg,p.lowerCase=Tm,p.lowerFirst=Nm,p.lt=zv,p.lte=kv,p.max=xw,p.maxBy=Sw,p.mean=Pw,p.meanBy=Ow,p.min=Rw,p.minBy=Tw,p.stubArray=tc,p.stubFalse=rc,p.stubObject=dw,p.stubString=gw,p.stubTrue=yw,p.multiply=Nw,p.nth=Vg,p.noConflict=ow,p.noop=ec,p.now=io,p.pad=Am,p.padEnd=$m,p.padStart=Cm,p.parseInt=jm,p.random=Im,p.reduce=Gy,p.reduceRight=Wy,p.repeat=Dm,p.replace=qm,p.result=pm,p.round=Aw,p.runInContext=x,p.sample=Qy,p.size=Xy,p.snakeCase=Um,p.some=ev,p.sortedIndex=Yg,p.sortedIndexBy=Zg,p.sortedIndexOf=Xg,p.sortedLastIndex=ey,p.sortedLastIndexBy=ty,p.sortedLastIndexOf=ry,p.startCase=Lm,p.startsWith=zm,p.subtract=$w,p.sum=Cw,p.sumBy=jw,p.template=km,p.times=vw,p.toFinite=oi,p.toInteger=me,p.toLength=Uh,p.toLower=Hm,p.toNumber=Nr,p.toSafeInteger=Hv,p.toString=qe,p.toUpper=Km,p.trim=Vm,p.trimEnd=Bm,p.trimStart=Fm,p.truncate=Gm,p.unescape=Wm,p.uniqueId=ww,p.upperCase=Jm,p.upperFirst=Qa,p.each=Ih,p.eachRight=xh,p.first=wh,Xa(p,function(){var e={};return Fr(p,function(i,o){Me.call(p.prototype,o)||(e[o]=i)}),e}(),{chain:!1}),p.VERSION=s,xr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),xr(["drop","take"],function(e,i){Pe.prototype[e]=function(o){o=o===r?1:Ut(me(o),0);var c=this.__filtered__&&!i?new Pe(this):this.clone();return c.__filtered__?c.__takeCount__=Gt(o,c.__takeCount__):c.__views__.push({size:Gt(o,G),type:e+(c.__dir__<0?"Right":"")}),c},Pe.prototype[e+"Right"]=function(o){return this.reverse()[e](o).reverse()}}),xr(["filter","map","takeWhile"],function(e,i){var o=i+1,c=o==N||o==Le;Pe.prototype[e]=function(l){var d=this.clone();return d.__iteratees__.push({iteratee:ne(l,3),type:o}),d.__filtered__=d.__filtered__||c,d}}),xr(["head","last"],function(e,i){var o="take"+(i?"Right":"");Pe.prototype[e]=function(){return this[o](1).value()[0]}}),xr(["initial","tail"],function(e,i){var o="drop"+(i?"":"Right");Pe.prototype[e]=function(){return this.__filtered__?new Pe(this):this[o](1)}}),Pe.prototype.compact=function(){return this.filter(ur)},Pe.prototype.find=function(e){return this.filter(e).head()},Pe.prototype.findLast=function(e){return this.reverse().find(e)},Pe.prototype.invokeMap=Ee(function(e,i){return typeof e=="function"?new Pe(this):this.map(function(o){return $s(o,e,i)})}),Pe.prototype.reject=function(e){return this.filter(no(ne(e)))},Pe.prototype.slice=function(e,i){e=me(e);var o=this;return o.__filtered__&&(e>0||i<0)?new Pe(o):(e<0?o=o.takeRight(-e):e&&(o=o.drop(e)),i!==r&&(i=me(i),o=i<0?o.dropRight(-i):o.take(i-e)),o)},Pe.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Pe.prototype.toArray=function(){return this.take(G)},Fr(Pe.prototype,function(e,i){var o=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),l=p[c?"take"+(i=="last"?"Right":""):i],d=c||/^find/.test(i);l&&(p.prototype[i]=function(){var m=this.__wrapped__,_=c?[1]:arguments,P=m instanceof Pe,M=_[0],L=P||ge(m),H=function(xe){var Re=l.apply(p,gi([xe],_));return c&&J?Re[0]:Re};L&&o&&typeof M=="function"&&M.length!=1&&(P=L=!1);var J=this.__chain__,re=!!this.__actions__.length,oe=d&&!J,be=P&&!re;if(!d&&L){m=be?m:new Pe(this);var ae=e.apply(m,_);return ae.__actions__.push({func:to,args:[H],thisArg:r}),new Pr(ae,J)}return oe&&be?e.apply(this,_):(ae=this.thru(H),oe?c?ae.value()[0]:ae.value():ae)})}),xr(["pop","push","shift","sort","splice","unshift"],function(e){var i=On[e],o=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var l=arguments;if(c&&!this.__chain__){var d=this.value();return i.apply(ge(d)?d:[],l)}return this[o](function(m){return i.apply(ge(m)?m:[],l)})}}),Fr(Pe.prototype,function(e,i){var o=p[i];if(o){var c=o.name+"";Me.call(os,c)||(os[c]=[]),os[c].push({name:i,func:o})}}),os[Wn(r,ye).name]=[{name:"wrapper",func:r}],Pe.prototype.clone=Wp,Pe.prototype.reverse=Jp,Pe.prototype.value=Qp,p.prototype.at=Sy,p.prototype.chain=Py,p.prototype.commit=Oy,p.prototype.next=Ry,p.prototype.plant=Ny,p.prototype.reverse=Ay,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=$y,p.prototype.first=p.prototype.head,Ss&&(p.prototype[Ss]=Ty),p},is=Op();bt?((bt.exports=is)._=is,Fe._=is):Oe._=is}).call(Bs)})(Uc,Uc.exports);var XI=Object.defineProperty,ex=Object.defineProperties,tx=Object.getOwnPropertyDescriptors,rf=Object.getOwnPropertySymbols,rx=Object.prototype.hasOwnProperty,ix=Object.prototype.propertyIsEnumerable,sf=(n,t,r)=>t in n?XI(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,po=(n,t)=>{for(var r in t||(t={}))rx.call(t,r)&&sf(n,r,t[r]);if(rf)for(var r of rf(t))ix.call(t,r)&&sf(n,r,t[r]);return n},sx=(n,t)=>ex(n,tx(t));function Si(n,t,r){var s;const a=C0(n);return((s=t.rpcMap)==null?void 0:s[a.reference])||`${ZI}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function Fi(n){return n.includes(":")?n.split(":")[1]:n}function ep(n){return n.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function nx(n,t){const r=Object.keys(t.namespaces).filter(a=>a.includes(n));if(!r.length)return[];const s=[];return r.forEach(a=>{const u=t.namespaces[a].accounts;s.push(...u)}),s}function ox(n={},t={}){const r=nf(n),s=nf(t);return Uc.exports.merge(r,s)}function nf(n){var t,r,s,a;const u={};if(!ys(n))return u;for(const[f,y]of Object.entries(n)){const w=Bc(f)?[f]:y.chains,g=y.methods||[],b=y.events||[],S=y.rpcMap||{},O=Fs(f);u[O]=sx(po(po({},u[O]),y),{chains:dc(w,(t=u[O])==null?void 0:t.chains),methods:dc(g,(r=u[O])==null?void 0:r.methods),events:dc(b,(s=u[O])==null?void 0:s.events),rpcMap:po(po({},S),(a=u[O])==null?void 0:a.rpcMap)})}return u}function ax(n){return n.includes(":")?n.split(":")[2]:n}function cx(n){const t={};for(const[r,s]of Object.entries(n)){const a=s.methods||[],u=s.events||[],f=s.accounts||[],y=Bc(r)?[r]:s.chains?s.chains:ep(s.accounts);t[r]={chains:y,methods:a,events:u,accounts:f}}return t}function _c(n){return typeof n=="number"?n:n.includes("0x")?parseInt(n,16):n.includes(":")?Number(n.split(":")[1]):Number(n)}const tp={},st=n=>tp[n],Ec=(n,t)=>{tp[n]=t};class ux{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Fi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Si(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new ee.f(s,st("disableProviderPing")))}}class hx{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const s=r||Si(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new ee.f(s,st("disableProviderPing")))}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=parseInt(Fi(r));t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,s;let a=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const u=parseInt(a,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class lx{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Fi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Si(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new ee.f(s,st("disableProviderPing")))}}class fx{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Fi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Si(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new ee.f(s,st("disableProviderPing")))}}class px{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r),a=Fi(r);t[a]=this.createHttpProvider(a,s)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||this.getCardanoRPCUrl(t);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new ee.f(s,st("disableProviderPing")))}}class dx{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Fi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Si(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new ee.f(s,st("disableProviderPing")))}}class gx{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Fi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Si(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new ee.f(s,st("disableProviderPing")))}}class yx{constructor(t){this.name="near",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||Si(`${this.name}:${t}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Si(t,this.namespace);return typeof s>"u"?void 0:new hi(new ee.f(s,st("disableProviderPing")))}}var vx=Object.defineProperty,mx=Object.defineProperties,wx=Object.getOwnPropertyDescriptors,of=Object.getOwnPropertySymbols,bx=Object.prototype.hasOwnProperty,_x=Object.prototype.propertyIsEnumerable,af=(n,t,r)=>t in n?vx(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,go=(n,t)=>{for(var r in t||(t={}))bx.call(t,r)&&af(n,r,t[r]);if(of)for(var r of of(t))_x.call(t,r)&&af(n,r,t[r]);return n},Ic=(n,t)=>mx(n,wx(t));class Qc{constructor(t){this.events=new q.ss,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ro(To({level:(t==null?void 0:t.logger)||ef})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new Qc(t);return await r.initialize(),r}async request(t,r){const[s,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:go({},t),chainId:`${s}:${a}`,topic:this.session.topic})}sendAsync(t,r,s){const a=new Date().getTime();this.request(t,s).then(u=>r(null,ee.formatJsonRpcResult(a,u))).catch(u=>r(u,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:It("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:a}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await a().then(u=>{this.session=u,this.namespaces||(this.namespaces=cx(u.namespaces),this.persist("namespaces",this.namespaces))}).catch(u=>{if(u.message!==Zf)throw u;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[s,a]=this.validateChain(t);this.getProvider(s).setDefaultChain(a,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(Hi(r)){for(const s of r)t.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await WI.init({logger:this.providerOpts.logger||ef,relayUrl:this.providerOpts.relayUrl||JI,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>Fs(r)))];Ec("client",this.client),Ec("events",this.events),Ec("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const s=nx(r,this.session),a=ep(s),u=ox(this.namespaces,this.optionalNamespaces),f=Ic(go({},u[r]),{accounts:s,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new hx({namespace:f});break;case"solana":this.rpcProviders[r]=new lx({namespace:f});break;case"cosmos":this.rpcProviders[r]=new fx({namespace:f});break;case"polkadot":this.rpcProviders[r]=new ux({namespace:f});break;case"cip34":this.rpcProviders[r]=new px({namespace:f});break;case"elrond":this.rpcProviders[r]=new dx({namespace:f});break;case"multiversx":this.rpcProviders[r]=new gx({namespace:f});break;case"near":this.rpcProviders[r]=new yx({namespace:f});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:s}=r;if(s.name==="accountsChanged"){const a=s.data;a&&Hi(a)&&this.events.emit("accountsChanged",a.map(ax))}else if(s.name==="chainChanged"){const a=r.chainId,u=r.event.data,f=Fs(a),y=_c(a)!==_c(u)?`${f}:${_c(u)}`:a;this.onChainChanged(y)}else this.events.emit(s.name,s.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var s;const{namespaces:a}=r,u=(s=this.client)==null?void 0:s.session.get(t);this.session=Ic(go({},u),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",Ic(go({},It("USER_DISCONNECTED")),{data:t.topic}))}),this.on(li.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:s,sessionProperties:a}=t;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(t){const[r,s]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(f=>Fs(f)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const a=Fs(Object.keys(this.namespaces)[0]),u=this.rpcProviders[a].getDefaultChain();return[a,u]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var s;if(!this.namespaces)return;const[a,u]=this.validateChain(t);r||this.getProvider(a).setDefaultChain(u),((s=this.namespaces[a])!=null?s:this.namespaces[`${a}:${u}`]).defaultChain=u,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",u)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${tf}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${tf}/${t}`)}}const Ex=Qc,Ix="wc",xx="ethereum_provider",Sx=`${Ix}@2:${xx}:`,Px="https://rpc.walletconnect.com/v1/",xo=["eth_sendTransaction","personal_sign"],rp=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],So=["chainChanged","accountsChanged"],ip=["chainChanged","accountsChanged","message","disconnect","connect"];var Ox=Object.defineProperty,Rx=Object.defineProperties,Tx=Object.getOwnPropertyDescriptors,cf=Object.getOwnPropertySymbols,Nx=Object.prototype.hasOwnProperty,Ax=Object.prototype.propertyIsEnumerable,uf=(n,t,r)=>t in n?Ox(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Js=(n,t)=>{for(var r in t||(t={}))Nx.call(t,r)&&uf(n,r,t[r]);if(cf)for(var r of cf(t))Ax.call(t,r)&&uf(n,r,t[r]);return n},hf=(n,t)=>Rx(n,Tx(t));function Po(n){return Number(n[0].split(":")[1])}function xc(n){return`0x${n.toString(16)}`}function $x(n){const{chains:t,optionalChains:r,methods:s,optionalMethods:a,events:u,optionalEvents:f,rpcMap:y}=n;if(!Sc(t))throw new Error("Invalid chains");const w={chains:t,methods:s||xo,events:u||So,rpcMap:Js({},t.length?{[Po(t)]:y[Po(t)]}:{})},g=u==null?void 0:u.filter(U=>!So.includes(U)),b=s==null?void 0:s.filter(U=>!xo.includes(U));if(!r&&!f&&!a&&!(g!=null&&g.length)&&!(b!=null&&b.length))return{required:t.length?w:void 0};const S=(g==null?void 0:g.length)&&(b==null?void 0:b.length)||!r,O={chains:[...new Set(S?w.chains.concat(r||[]):r)],methods:[...new Set(w.methods.concat(a!=null&&a.length?a:rp))],events:[...new Set(w.events.concat(f!=null&&f.length?f:ip))],rpcMap:y};return{required:t.length?w:void 0,optional:r.length?O:void 0}}class $o{constructor(){this.events=new q.eventsExports.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=Sx,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new $o;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:s}=$x(this.rpc);try{const a=await new Promise(async(f,y)=>{var w;this.rpc.showQrModal&&((w=this.modal)==null||w.subscribeModal(g=>{!g.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),y(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(hf(Js({namespaces:Js({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(g=>{f(g)}).catch(g=>{y(new Error(g.message))})});if(!a)return;const u=qw(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:xc(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",xc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",hf(Js({},Mw("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",xc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,s,a]=t.split(":");return{chainId:`${r}:${s}`,address:a}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,s;const a=(r=t==null?void 0:t.chains)!=null?r:[],u=(s=t==null?void 0:t.optionalChains)!=null?s:[],f=a.concat(u);if(!f.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const y=a.length?(t==null?void 0:t.methods)||xo:[],w=a.length?(t==null?void 0:t.events)||So:[],g=(t==null?void 0:t.optionalMethods)||[],b=(t==null?void 0:t.optionalEvents)||[],S=(t==null?void 0:t.rpcMap)||this.buildRpcMap(f,t.projectId),O=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(U=>this.formatChainId(U)),optionalChains:u.map(U=>this.formatChainId(U)),methods:y,events:w,optionalMethods:g,optionalEvents:b,rpcMap:S,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:O,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const s={};return t.forEach(a=>{s[a]=this.getRpcUrl(a,r)}),s}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?Po(this.rpc.chains):Po(this.rpc.optionalChains),this.signer=await Ex.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await Promise.resolve().then(()=>require("./index-n3YtVyjc.cjs")).then(a=>a.index);r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Js({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:s,rpcMap:a}=t;r&&Sc(r)&&(this.rpc.chains=r.map(u=>this.formatChainId(u)),r.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)})),s&&Sc(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(u=>this.formatChainId(u)),s.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)}))}getRpcUrl(t,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[t])||`${Px}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const Cx=$o;exports.EthereumProvider=Cx;exports.OPTIONAL_EVENTS=ip;exports.OPTIONAL_METHODS=rp;exports.REQUIRED_EVENTS=So;exports.REQUIRED_METHODS=xo;exports.default=$o;
